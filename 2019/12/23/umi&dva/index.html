<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Umi&amp;dva | So Love</title><meta name="description" content="1. Umi介绍1.1 Umi是什么https:&#x2F;&#x2F;umijs.org&#x2F;zh-CN&#x2F;docs    一套可插拔的企业级 react 应用框架，由dva作者 sorrycc 完成，它既是一个框架也是一个工具。 Umi 以路由为基础的，同时支持配置式路由和约定式路由，保证路由的功能完备，并以此进行功能扩展。然后配以生命周期完善的插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求。"><meta name="author" content="Wang su"><meta name="copyright" content="Wang su"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://ehbhgh.github.io/2019/12/23/umi&amp;dva/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Umi&amp;dva"><meta property="og:url" content="https://ehbhgh.github.io/2019/12/23/umi&amp;dva/"><meta property="og:site_name" content="So Love"><meta property="og:description" content="1. Umi介绍1.1 Umi是什么https:&#x2F;&#x2F;umijs.org&#x2F;zh-CN&#x2F;docs    一套可插拔的企业级 react 应用框架，由dva作者 sorrycc 完成，它既是一个框架也是一个工具。 Umi 以路由为基础的，同时支持配置式路由和约定式路由，保证路由的功能完备，并以此进行功能扩展。然后配以生命周期完善的插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求。"><meta property="og:image" content="https://i.loli.net/2020/07/23/XARfSvl9oB6MKYm.jpg"><meta property="article:published_time" content="2019-12-23T00:55:13.000Z"><meta property="article:modified_time" content="2020-11-04T12:58:22.424Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="Ant Design Pro V5" href="https://ehbhgh.github.io/2020/03/23/ant-design-pro/"><link rel="next" title="Uniapp实现多端开发(ts)" href="https://ehbhgh.github.io/2019/11/29/%E5%88%9D%E5%A7%8Buniapp/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-11-04 20:58:22'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">12</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 关键字</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa-fw fa fa-book"></i><span> 找文章</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-link"></i><span> 链接</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/link/"><i class="fa-fw fa fa-users"></i><span> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Umi介绍"><span class="toc-number">1.</span> <span class="toc-text">1. Umi介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-Umi是什么"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 Umi是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-Umi-如何工作"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 Umi 如何工作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-技术收敛"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 技术收敛</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-插件和插件集"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2 插件和插件集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-3-配置式路由和约定式路由"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3 配置式路由和约定式路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-4-umi-临时文件"><span class="toc-number">1.2.4.</span> <span class="toc-text">1.2.4 .umi 临时文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Umi3的使用"><span class="toc-number">2.</span> <span class="toc-text">2. Umi3的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-安装Umi创建项目"><span class="toc-number">2.1.</span> <span class="toc-text">2.1  安装Umi创建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-升级到Umi3"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 升级到Umi3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-运行项目"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 运行项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-目录结构介绍"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 目录结构介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-配置文件介绍"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 配置文件介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-1-editorconfig"><span class="toc-number">2.5.1.</span> <span class="toc-text">2.5.1 .editorconfig</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-2-env"><span class="toc-number">2.5.2.</span> <span class="toc-text">2.5.2 .env</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-3-eslintrc"><span class="toc-number">2.5.3.</span> <span class="toc-text">2.5.3 .eslintrc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-3-umirc"><span class="toc-number">2.5.4.</span> <span class="toc-text">2.5.3 .umirc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-4-tsconfig-json"><span class="toc-number">2.5.5.</span> <span class="toc-text">2.5.4 tsconfig.json</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-6-路由和页面跳转"><span class="toc-number">2.6.</span> <span class="toc-text">2.6 路由和页面跳转</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-1-新建路由"><span class="toc-number">2.6.1.</span> <span class="toc-text">2.6.1 新建路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-2-约定式路由"><span class="toc-number">2.6.2.</span> <span class="toc-text">2.6.2 约定式路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-3-路由配置"><span class="toc-number">2.6.3.</span> <span class="toc-text">2.6.3 路由配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-4-路由跳转和传参"><span class="toc-number">2.6.4.</span> <span class="toc-text">2.6.4 路由跳转和传参</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-5-动态路由参数"><span class="toc-number">2.6.5.</span> <span class="toc-text">2.6.5 动态路由参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-7-样式和资源文件"><span class="toc-number">2.7.</span> <span class="toc-text">2.7 样式和资源文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-1-全局样式"><span class="toc-number">2.7.1.</span> <span class="toc-text">2.7.1 全局样式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-2-CSS-Modules"><span class="toc-number">2.7.2.</span> <span class="toc-text">2.7.2 CSS Modules</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-3-CSS-预处理器"><span class="toc-number">2.7.3.</span> <span class="toc-text">2.7.3 CSS 预处理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-4-ts中使用图片"><span class="toc-number">2.7.4.</span> <span class="toc-text">2.7.4 ts中使用图片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-5-CSS-里使用图片"><span class="toc-number">2.7.5.</span> <span class="toc-text">2.7.5 CSS 里使用图片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-6-Base64-编译"><span class="toc-number">2.7.6.</span> <span class="toc-text">2.7.6 Base64 编译</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-8-国际化"><span class="toc-number">2.8.</span> <span class="toc-text">2.8 国际化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-1-开启国际化"><span class="toc-number">2.8.1.</span> <span class="toc-text">2.8.1 开启国际化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-2-约定式多语言支持"><span class="toc-number">2.8.2.</span> <span class="toc-text">2.8.2 约定式多语言支持</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-3-主要API"><span class="toc-number">2.8.3.</span> <span class="toc-text">2.8.3 主要API</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-flux和redux"><span class="toc-number">3.</span> <span class="toc-text">3.flux和redux</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-Flux"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 Flux</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-Redux"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 Redux</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-dva"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 dva</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-dva介绍"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1 dva介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-dva的数据流"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2 dva的数据流</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-3-dva核心概念"><span class="toc-number">3.3.3.</span> <span class="toc-text">3.3.3 dva核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-model"><span class="toc-number">3.3.3.1.</span> <span class="toc-text">a) model</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-connect"><span class="toc-number">3.3.3.2.</span> <span class="toc-text">b) connect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-dispatch"><span class="toc-number">3.3.3.3.</span> <span class="toc-text">c) dispatch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d-action"><span class="toc-number">3.3.3.4.</span> <span class="toc-text">d) action</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-dva实战"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 dva实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-改造项目结构"><span class="toc-number">3.4.1.</span> <span class="toc-text">3.4.1 改造项目结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-mock"><span class="toc-number">3.4.2.</span> <span class="toc-text">3.4.2 mock</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-mock介绍"><span class="toc-number">3.4.2.1.</span> <span class="toc-text">a) mock介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-mock-user-js使用mock提供接口数据"><span class="toc-number">3.4.2.2.</span> <span class="toc-text">b) mock&#x2F;user.js使用mock提供接口数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-3-请求的封装"><span class="toc-number">3.4.3.</span> <span class="toc-text">3.4.3 请求的封装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-fetch和umi-request"><span class="toc-number">3.4.3.1.</span> <span class="toc-text">a) fetch和umi-request</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-app-ts运行时配置"><span class="toc-number">3.4.3.2.</span> <span class="toc-text">b) app.ts运行时配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-封装service"><span class="toc-number">3.4.3.3.</span> <span class="toc-text">c) 封装service</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-4-新建页面-发送请求"><span class="toc-number">3.4.4.</span> <span class="toc-text">3.4.4 新建页面 发送请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-5-编写dva-model"><span class="toc-number">3.4.5.</span> <span class="toc-text">3.4.5 编写dva model</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-6-编写页面"><span class="toc-number">3.4.6.</span> <span class="toc-text">3.4.6 编写页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-7-使用订阅更新设置dva数据"><span class="toc-number">3.4.7.</span> <span class="toc-text">3.4.7 使用订阅更新设置dva数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-8-使用ant-design编写页面"><span class="toc-number">3.4.8.</span> <span class="toc-text">3.4.8 使用ant design编写页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-9-完成删除功能"><span class="toc-number">3.4.9.</span> <span class="toc-text">3.4.9 完成删除功能</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><header class="post-bg" id="page-header" style="background-image: url(https://i.loli.net/2020/07/23/XARfSvl9oB6MKYm.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">So Love</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 关键字</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa-fw fa fa-book"></i><span> 找文章</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-link"></i><span> 链接</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/link/"><i class="fa-fw fa fa-users"></i><span> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Umi&amp;dva</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2019-12-23 08:55:13"><i class="far fa-calendar-alt fa-fw"></i> Created 2019-12-23</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2020-11-04 20:58:22"><i class="fas fa-history fa-fw"></i> Updated 2020-11-04</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="1-Umi介绍"><a href="#1-Umi介绍" class="headerlink" title="1. Umi介绍"></a>1. Umi介绍</h1><h2 id="1-1-Umi是什么"><a href="#1-1-Umi是什么" class="headerlink" title="1.1 Umi是什么"></a>1.1 Umi是什么</h2><p><a href="https://umijs.org/zh-CN/docs" target="_blank" rel="noopener">https://umijs.org/zh-CN/docs</a>   </p>
<p>一套可插拔的企业级 react 应用框架，由dva作者 sorrycc 完成，它既是一个框架也是一个工具。</p>
<p>Umi 以路由为基础的，同时支持配置式路由和约定式路由，保证路由的功能完备，并以此进行功能扩展。然后配以生命周期完善的插件体系，覆盖从源码到构建产物的每个生命周期，支持各种功能扩展和业务需求。</p>
<p>他在Umi中引入了 UI 工具 antd，打包工具 roadhog，路由 react-router和状态管理器 dva，做到了可插拔机制。通过约定、自动生成和解析代码等方式来辅助开发，减少开发者要写的代码量。</p>
<blockquote>
<p><strong>它主要具备以下功能：</strong></p>
</blockquote>
<ul>
<li><strong>可扩展</strong>，Umi 实现了完整的生命周期，并使其插件化，Umi 内部功能也全由插件完成。此外还支持插件和插件集，以满足功能和垂直域的分层需求。</li>
<li><strong>开箱即用</strong>，Umi 内置了路由、构建、部署、测试等，仅需一个依赖即可上手开发。并且还提供针对 React 的集成插件集，内涵丰富的功能，可满足日常 80% 的开发需求。</li>
<li><strong>企业级</strong>，经蚂蚁内部 3000+ 项目以及阿里、优酷、网易、飞猪、口碑等公司项目的验证，值得信赖。</li>
<li><strong>大量自研</strong>，包含微前端、组件打包、文档工具、请求库、hooks 库、数据流等，满足日常项目的周边需求。</li>
<li><strong>完备路由</strong>，同时支持配置式路由和约定式路由，同时保持功能的完备性，比如动态路由、嵌套路由、权限路由等等。</li>
<li><strong>面向未来</strong>，在满足需求的同时，我们也不会停止对新技术的探索。比如 dll 提速、modern mode、webpack@5、自动化 external、bundler less 等等。</li>
</ul>
<blockquote>
<p><strong>为什么不是？<a href="https://github.com/facebook/create-react-app" target="_blank" rel="noopener">create-react-app</a></strong></p>
</blockquote>
<p>create-react-app 是基于 webpack 的打包层方案，包含 build、dev、lint 等，他在打包层把体验做到了极致，但是不包含路由，不是框架，也不支持配置。所以，如果大家想基于他修改部分配置，或者希望在打包层之外也做技术收敛时，就会遇到困难。</p>
<blockquote>
<p><strong>什么时候不用 umi？</strong></p>
</blockquote>
<p>如果你，</p>
<ul>
<li>需要支持 IE 8 或更低版本的浏览器</li>
<li>需要支持 React 16.8.0 以下的 React</li>
<li>需要跑在 Node 10 以下的环境中</li>
<li>有很强的 webpack 自定义需求和主观意愿</li>
<li>需要选择不同的路由方案</li>
</ul>
<p>Umi 可能不适合你。</p>
<h2 id="1-2-Umi-如何工作"><a href="#1-2-Umi-如何工作" class="headerlink" title="1.2 Umi 如何工作"></a>1.2 Umi 如何工作</h2><p>写写 Umi 背后的思考和重要概念。</p>
<h3 id="1-2-1-技术收敛"><a href="#1-2-1-技术收敛" class="headerlink" title="1.2.1 技术收敛"></a>1.2.1 技术收敛</h3><p><img src= "/img/loading.gif" data-src="D:%5C%E5%89%8D%E7%AB%AF%E5%A4%87%E8%AF%BE%5C17.REACT%5Creadme%5Cassets%5C1601014995473.png" alt="1601014995473"></p>
<p>这张图是给内部框架 Bigfish 画的，套到 Umi 上同样合适。他把大家常用的技术栈进行整理，收敛到一起，让大家只用 Umi 就可以完成 80% 的日常工作。</p>
<h3 id="1-2-2-插件和插件集"><a href="#1-2-2-插件和插件集" class="headerlink" title="1.2.2 插件和插件集"></a>1.2.2 插件和插件集</h3><p><img src= "/img/loading.gif" data-src="D:%5C%E5%89%8D%E7%AB%AF%E5%A4%87%E8%AF%BE%5C17.REACT%5Creadme%5Cassets%5C1601015019180.png" alt="1601015019180"></p>
<p>Umi 支持插件和插件集，通过这张图应该很好理解到他们的关系，通过插件集我们把插件收敛依赖然后支持不同的业务类型。</p>
<p>比如@umijs/preset-react就是一个Umi的插件集，里面整合了一些常用功能。</p>
<ul>
<li><a href="https://umijs.org/zh-CN/plugins/plugin-access" target="_blank" rel="noopener">plugin-access</a>，权限管理</li>
<li><a href="https://umijs.org/zh-CN/plugins/plugin-analytics" target="_blank" rel="noopener">plugin-analytics</a>，统计管理</li>
<li><a href="https://umijs.org/zh-CN/plugins/plugin-antd" target="_blank" rel="noopener">plugin-antd</a>，整合 antd UI 组件</li>
<li><a href="https://umijs.org/zh-CN/plugins/plugin-crossorigin" target="_blank" rel="noopener">plugin-crossorigin</a>，通常用于 JS 出错统计</li>
<li><a href="https://umijs.org/zh-CN/plugins/plugin-dva" target="_blank" rel="noopener">plugin-dva</a>，整合 dva</li>
<li><a href="https://umijs.org/zh-CN/plugins/plugin-helmet" target="_blank" rel="noopener">plugin-helmet</a>，整合 <a href="https://github.com/nfl/react-helmet" target="_blank" rel="noopener">react-helmet</a>，管理 HTML 文档标签（如标题、描述等）</li>
<li><a href="https://umijs.org/zh-CN/plugins/plugin-initial-state" target="_blank" rel="noopener">plugin-initial-state</a>，初始化数据管理</li>
<li><a href="https://umijs.org/zh-CN/plugins/plugin-layout" target="_blank" rel="noopener">plugin-layout</a>，配置启用 ant-design-pro 的布局</li>
<li><a href="https://umijs.org/zh-CN/plugins/plugin-locale" target="_blank" rel="noopener">plugin-locale</a>，国际化能力</li>
<li><a href="https://umijs.org/zh-CN/plugins/plugin-model" target="_blank" rel="noopener">plugin-model</a>，基于 hooks 的简易数据流</li>
<li><a href="https://umijs.org/zh-CN/plugins/plugin-request" target="_blank" rel="noopener">plugin-request</a>，基于 umi-request 和 umi-hooks 的请求方案&gt;</li>
</ul>
<h3 id="1-2-3-配置式路由和约定式路由"><a href="#1-2-3-配置式路由和约定式路由" class="headerlink" title="1.2.3 配置式路由和约定式路由"></a>1.2.3 配置式路由和约定式路由</h3><p>Umi 的路由既支持配置式，又支持约定式。配置式是对于现实的低头，也是大部分用户在用的，因为他功能强大；约定式是我们希望走去的方向，因为他简洁优雅。</p>
<h3 id="1-2-4-umi-临时文件"><a href="#1-2-4-umi-临时文件" class="headerlink" title="1.2.4 .umi 临时文件"></a>1.2.4 .umi 临时文件</h3><p>.umi 临时目录是整个 Umi 项目的发动机，你的入口文件、路由等等都在这里，这些是由 </p>
<p>umi 内部插件及三方插件生成的。</p>
<p>你通常会在 .umi 下看到以下目录，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ .umi</span><br><span class="line">  + core     # 内部插件生成</span><br><span class="line">  + pluginA  # 外部插件生成</span><br><span class="line">  + presetB  # 外部插件生成</span><br><span class="line">  + umi.ts   # 入口文件</span><br></pre></td></tr></table></figure>

<p>临时文件是 Umi 框架中非常重要的一部分，框架或插件会根据你的代码生成临时文件，这些原来需要放在项目里的脏乱差的部分都被藏在了这里。</p>
<p>你可以在这里调试代码，但不要在 .git 仓库里提交他，因为他的临时性，每次启动 umi 时都会被删除并重新生成。</p>
<h1 id="2-Umi3的使用"><a href="#2-Umi3的使用" class="headerlink" title="2. Umi3的使用"></a>2. Umi3的使用</h1><h2 id="2-1-安装Umi创建项目"><a href="#2-1-安装Umi创建项目" class="headerlink" title="2.1  安装Umi创建项目"></a>2.1  安装Umi创建项目</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ yarn global add umi</span><br><span class="line">$ umi -v</span><br><span class="line"><span class="number">3.2</span><span class="number">.22</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir myapp &amp;&amp; cd myapp</span><br><span class="line">$ yarn create umi</span><br></pre></td></tr></table></figure>

<p><img src= "/img/loading.gif" data-src="assets%5C1573453772780.png" alt="1573453772780"></p>
<p><img src= "/img/loading.gif" data-src="assets%5C1573453795170.png" alt="1573453795170"></p>
<p><img src= "/img/loading.gif" data-src="D:%5C%E5%89%8D%E7%AB%AF%E5%A4%87%E8%AF%BE%5C17.REACT%5Creadme%5Cassets%5C1601014079199.png" alt="1601014079199"></p>
<h2 id="2-2-升级到Umi3"><a href="#2-2-升级到Umi3" class="headerlink" title="2.2 升级到Umi3"></a>2.2 升级到Umi3</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 删除package.json中 dva 和 antd 的依赖 (Umi3中已经包含这两个依赖)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 删除package.json中 umi-plugin-react 依赖，新增umijs/preset-react 依赖</span><br><span class="line">   <span class="string">"@umijs/preset-react"</span>: <span class="string">"^1"</span>,</span><br><span class="line">       </span><br><span class="line"><span class="number">3.</span> 修改package.json中的node环境要求</span><br><span class="line">   <span class="string">"node"</span>: <span class="string">"&gt;=10.13.0"</span></span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> tsconfig.json中的paths新增如下：</span><br><span class="line">   <span class="string">"@@/*"</span>: [<span class="string">"src/.umi/*"</span>]</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> 修改 .umirc.ts文件</span><br><span class="line">    <span class="comment">//引入umi中的配置文件的类型 ts中要用</span></span><br><span class="line">    <span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line">	<span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ref: https://umijs.org/config/</span></span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">      <span class="comment">//路由配置</span></span><br><span class="line">      routes: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">'/'</span>,</span><br><span class="line">          <span class="comment">//注意：这边文件的路径是相对于src/.mui中来确定的</span></span><br><span class="line">          component: <span class="string">'../layouts/index'</span>,</span><br><span class="line">          routes: [</span><br><span class="line">            &#123; </span><br><span class="line">              path: <span class="string">'/'</span>, </span><br><span class="line">              component: <span class="string">'../pages/index'</span> </span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="comment">//启用antd插件</span></span><br><span class="line">      <span class="comment">//每个插件都会对应一个 id 和一个 key，id 是路径的简写，key 是进一步简化后用于配置的唯一值。</span></span><br><span class="line">      <span class="comment">//比如插件 /node_modules/@umijs/plugin-antd ,id 为 @umijs/plugin-antd，key 为 antd。</span></span><br><span class="line">      antd: &#123; &#125;,</span><br><span class="line">      <span class="comment">//启用dva插件</span></span><br><span class="line">      dva: &#123;</span><br><span class="line">        hmr: <span class="literal">true</span>,  <span class="comment">//启用dva model的热更新</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">//启用loacle插件  配置之后才可以使用useIntl </span></span><br><span class="line">      locale: &#123;</span><br><span class="line">        <span class="comment">//默认的语言环境</span></span><br><span class="line">        <span class="keyword">default</span>: <span class="string">'zh-CN'</span>,</span><br><span class="line">        <span class="comment">//antd开启国际化</span></span><br><span class="line">        antd: <span class="literal">true</span>, </span><br><span class="line">        <span class="comment">// default true, when it is true, will use `navigator.language` overwrite default</span></span><br><span class="line">        baseNavigator: <span class="literal">false</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 浏览器兼容</span></span><br><span class="line">      targets: &#123;</span><br><span class="line">        ie: <span class="number">11</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 开启文件hash后缀</span></span><br><span class="line">      hash: <span class="literal">true</span>,</span><br><span class="line">      <span class="comment">// 启用 Hash 路由</span></span><br><span class="line">      history: &#123;</span><br><span class="line">        type: <span class="string">'hash'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// Theme for antd: https://ant.design/docs/react/customize-theme-cn</span></span><br><span class="line">      theme: &#123;</span><br><span class="line">        <span class="comment">// ...darkTheme,</span></span><br><span class="line">        <span class="comment">// 主要颜色,</span></span><br><span class="line">        <span class="string">'font-size-base'</span>: <span class="string">'34px'</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">//配置按需加载   即是否把构建产物进行拆分，在需要的时候下载额外的 JS 再执行。</span></span><br><span class="line">      dynamicImport: &#123;&#125;,</span><br><span class="line">      <span class="comment">// 指定react-router的base，部署到根目录时需要配置</span></span><br><span class="line">      base:<span class="string">'/'</span>,</span><br><span class="line">      <span class="comment">// 指定webpack的publicPath，指向静态资源文件所在的路径</span></span><br><span class="line">      publicPath:<span class="string">'./'</span>,</span><br><span class="line">      <span class="comment">// DefinePlugin 全局常量定义</span></span><br><span class="line">      define: &#123; &#125;,</span><br><span class="line">      <span class="comment">// 代理配置</span></span><br><span class="line">      proxy: &#123;</span><br><span class="line">        <span class="comment">// '/api': &#123;</span></span><br><span class="line">        <span class="comment">//   target: 'http://127.0.0.1:10000/',</span></span><br><span class="line">        <span class="comment">//   changeOrigin: true,</span></span><br><span class="line">        <span class="comment">//   pathRewrite: &#123; '^/api': '' &#125;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// 别名</span></span><br><span class="line">      alias: &#123;</span><br><span class="line">        <span class="string">'@'</span>: path.resolve(__dirname, <span class="string">'src'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span> 注释掉 app.ts中的<span class="keyword">const</span> dva 代码</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    export const dva = &#123;</span></span><br><span class="line"><span class="comment">      config: &#123;</span></span><br><span class="line"><span class="comment">        onError(err: ErrorEvent) &#123;</span></span><br><span class="line"><span class="comment">          err.preventDefault();</span></span><br><span class="line"><span class="comment">          console.error(err.message);</span></span><br><span class="line"><span class="comment">        &#125;,</span></span><br><span class="line"><span class="comment">      &#125;,</span></span><br><span class="line"><span class="comment">    &#125;;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line"><span class="number">7.</span> 修改pages/index.tsx</span><br><span class="line">    <span class="comment">//useIntl 国际化的api</span></span><br><span class="line">    <span class="keyword">import</span> &#123; useIntl &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line"></span><br><span class="line">    &lt;a href=<span class="string">"https://umijs.org/guide/getting-started.html"</span>&gt;</span><br><span class="line">        &#123;useIntl().formatMessage(&#123; <span class="attr">id</span>: <span class="string">'index.start'</span> &#125;)&#125;</span><br><span class="line">    &lt;<span class="regexp">/a&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2-3-运行项目"><a href="#2-3-运行项目" class="headerlink" title="2.3 运行项目"></a>2.3 运行项目</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//然后安装依赖</span></span><br><span class="line">$ yarn</span><br><span class="line"></span><br><span class="line"><span class="comment">//然后启动应用</span></span><br><span class="line">$ yarn start</span><br></pre></td></tr></table></figure>

<p>几秒钟后，你会看到以下输出，</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DONE  Compiled successfully <span class="keyword">in</span> <span class="number">212</span>ms</span><br><span class="line"></span><br><span class="line"> App running at:</span><br><span class="line"> - Local:   http:<span class="comment">//localhost:8000/</span></span><br><span class="line"> - Network: http:<span class="comment">//&#123;&#123; YourIP &#125;&#125;:8000/</span></span><br></pre></td></tr></table></figure>

<p>在浏览器里打开 <a href="http://localhost:8000/" target="_blank" rel="noopener">http://localhost:8000</a>，你会看到 umi 的欢迎界面。</p>
<p><img src= "/img/loading.gif" data-src="assets%5C1573453872519.png" alt="img"></p>
<h2 id="2-4-目录结构介绍"><a href="#2-4-目录结构介绍" class="headerlink" title="2.4 目录结构介绍"></a>2.4 目录结构介绍</h2><p><img src= "/img/loading.gif" data-src="D:%5C%E5%89%8D%E7%AB%AF%E5%A4%87%E8%AF%BE%5C17.REACT%5Creadme%5Cassets%5C1601020141915.png" alt="1601020141915"></p>
<h2 id="2-5-配置文件介绍"><a href="#2-5-配置文件介绍" class="headerlink" title="2.5 配置文件介绍"></a>2.5 配置文件介绍</h2><h3 id="2-5-1-editorconfig"><a href="#2-5-1-editorconfig" class="headerlink" title="2.5.1 .editorconfig"></a>2.5.1 .editorconfig</h3><p>该文件是配置编辑器的一些设置，这里我修改了一个缩进，indent_size = 4。因为个人比较喜欢4个缩进，看着舒服。</p>
<h3 id="2-5-2-env"><a href="#2-5-2-env" class="headerlink" title="2.5.2 .env"></a>2.5.2 .env</h3><p>该文件是项目环境配置文件，默认的是BROWSER=none，这时候项目启动后，浏览器不会自动打开。</p>
<h3 id="2-5-3-eslintrc"><a href="#2-5-3-eslintrc" class="headerlink" title="2.5.3 .eslintrc"></a>2.5.3 .eslintrc</h3><p>多人开发时候，一套良好的代码规范是非常必要的。这里配置了一份基础eslint文件，供参考。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"env"</span>: &#123;</span><br><span class="line">    <span class="string">"es6"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"node"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"browser"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">"mocha"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">"extends"</span>: [</span><br><span class="line">    <span class="string">"eslint:recommended"</span>,</span><br><span class="line">    <span class="string">"react-app"</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"rules"</span>: &#123;</span><br><span class="line">    <span class="string">"strict"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="comment">//"indent": ["error", 4, &#123; "SwitchCase": 1 &#125;],</span></span><br><span class="line">    <span class="string">"eqeqeq"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-lone-blocks"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-lonely-if"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-multi-spaces"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-multiple-empty-lines"</span>: [</span><br><span class="line">      <span class="string">"error"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"max"</span>: <span class="number">2</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"no-param-reassign"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-spaced-func"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"no-use-before-define"</span>: <span class="string">"warn"</span>,</span><br><span class="line">    <span class="string">"no-unused-vars"</span>: <span class="string">"warn"</span>,</span><br><span class="line">    <span class="string">"no-with"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"default-case"</span>: <span class="string">"error"</span>,</span><br><span class="line">    <span class="string">"key-spacing"</span>: [</span><br><span class="line">      <span class="string">"error"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"beforeColon"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"afterColon"</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"comma-spacing"</span>: [</span><br><span class="line">      <span class="string">"error"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"before"</span>: <span class="literal">false</span>,</span><br><span class="line">        <span class="string">"after"</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"generator-star-spacing"</span>: [</span><br><span class="line">      <span class="string">"error"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"before"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"after"</span>: <span class="literal">false</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"semi"</span>: [</span><br><span class="line">      <span class="string">"warn"</span>,</span><br><span class="line">      <span class="string">"always"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"omitLastInOneLineBlock"</span>: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"no-restricted-globals"</span>: <span class="string">"off"</span>,</span><br><span class="line">    <span class="string">"array-callback-return"</span>: <span class="string">"off"</span>,</span><br><span class="line">    <span class="string">"no-console"</span>: [</span><br><span class="line">      <span class="string">"warn"</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">"allow"</span>: [</span><br><span class="line">          <span class="string">"info"</span>,</span><br><span class="line">          <span class="string">"warn"</span>,</span><br><span class="line">          <span class="string">"error"</span>,</span><br><span class="line">          <span class="string">"time"</span>,</span><br><span class="line">          <span class="string">"timeEnd"</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">"react/react-in-jsx-scope"</span>: <span class="string">"warn"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-3-umirc"><a href="#2-5-3-umirc" class="headerlink" title="2.5.3 .umirc"></a>2.5.3 .umirc</h3><p>.umirc为Umi项目的配置文件，.umirc.js 和 config/config.js二选一</p>
<h3 id="2-5-4-tsconfig-json"><a href="#2-5-4-tsconfig-json" class="headerlink" title="2.5.4 tsconfig.json"></a>2.5.4 tsconfig.json</h3><p>typescript的配置文件，可以配置ts编译的一些特征</p>
<p><a href="https://www.jianshu.com/p/78dcb09dac2c" target="_blank" rel="noopener">https://www.jianshu.com/p/78dcb09dac2c</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//tsconfig.json 对象类型的索引签名隐式具有"any"类型 报错</span></span><br><span class="line"><span class="string">"suppressImplicitAnyIndexErrors"</span>:<span class="literal">true</span>,</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="comment">/* Basic Options */</span></span><br><span class="line">    <span class="string">"target"</span>: <span class="string">"es5"</span> <span class="comment">/* target用于指定编译之后的版本目标: 'ES3' (default), 'ES5', 'ES2015', 'ES2016', 'ES2017', 'ES2018', 'ES2019' or 'ESNEXT'. */</span>,</span><br><span class="line">    <span class="string">"module"</span>: <span class="string">"commonjs"</span> <span class="comment">/* 用来指定要使用的模块标准: 'none', 'commonjs', 'amd', 'system', 'umd', 'es2015', or 'ESNext'. */</span>,</span><br><span class="line">    <span class="string">"lib"</span>: [<span class="string">"es6"</span>, <span class="string">"dom"</span>] <span class="comment">/* lib用于指定要包含在编译中的库文件 */</span>,</span><br><span class="line">    <span class="string">"allowJs"</span>: <span class="literal">true</span>,                       <span class="comment">/* allowJs设置的值为true或false，用来指定是否允许编译js文件，默认是false，即不编译js文件 */</span></span><br><span class="line">    <span class="string">"checkJs"</span>: <span class="literal">true</span>,                       <span class="comment">/* checkJs的值为true或false，用来指定是否检查和报告js文件中的错误，默认是false */</span></span><br><span class="line">    <span class="string">"jsx"</span>: <span class="string">"preserve"</span>,                     <span class="comment">/* 指定jsx代码用于的开发环境: 'preserve', 'react-native', or 'react'. */</span></span><br><span class="line">    <span class="string">"declaration"</span>: <span class="literal">true</span>,                   <span class="comment">/* declaration的值为true或false，用来指定是否在编译的时候生成相应的".d.ts"声明文件。如果设为true，编译每个ts文件之后会生成一个js文件和一个声明文件。但是declaration和allowJs不能同时设为true */</span></span><br><span class="line">    <span class="string">"declarationMap"</span>: <span class="literal">true</span>,                <span class="comment">/* 值为true或false，指定是否为声明文件.d.ts生成map文件 */</span></span><br><span class="line">    <span class="string">"sourceMap"</span>: <span class="literal">true</span>,                     <span class="comment">/* sourceMap的值为true或false，用来指定编译时是否生成.map文件 */</span></span><br><span class="line">    <span class="string">"outFile"</span>: <span class="string">"./"</span>,                       <span class="comment">/* outFile用于指定将输出文件合并为一个文件，它的值为一个文件路径名。比如设置为"./dist/main.js"，则输出的文件为一个main.js文件。但是要注意，只有设置module的值为amd和system模块时才支持这个配置 */</span></span><br><span class="line">    <span class="string">"outDir"</span>: <span class="string">"./"</span>,                        <span class="comment">/* outDir用来指定输出文件夹，值为一个文件夹路径字符串，输出的文件都将放置在这个文件夹 */</span></span><br><span class="line">    <span class="string">"rootDir"</span>: <span class="string">"./"</span>,                       <span class="comment">/* 用来指定编译文件的根目录，编译器会在根目录查找入口文件，如果编译器发现以rootDir的值作为根目录查找入口文件并不会把所有文件加载进去的话会报错，但是不会停止编译 */</span></span><br><span class="line">    <span class="string">"composite"</span>: <span class="literal">true</span>,                     <span class="comment">/* 是否编译构建引用项目  */</span></span><br><span class="line">    <span class="string">"incremental"</span>: <span class="literal">true</span>,                   <span class="comment">/* Enable incremental compilation */</span></span><br><span class="line">    <span class="string">"tsBuildInfoFile"</span>: <span class="string">"./"</span>,               <span class="comment">/* Specify file to store incremental compilation information */</span></span><br><span class="line">    <span class="string">"removeComments"</span>: <span class="literal">true</span>,                <span class="comment">/* removeComments的值为true或false，用于指定是否将编译后的文件中的注释删掉，设为true的话即删掉注释，默认为false */</span></span><br><span class="line">    <span class="string">"noEmit"</span>: <span class="literal">true</span>,                        <span class="comment">/* 不生成编译文件，这个一般比较少用 */</span></span><br><span class="line">    <span class="string">"importHelpers"</span>: <span class="literal">true</span>,                 <span class="comment">/* importHelpers的值为true或false，指定是否引入tslib里的辅助工具函数，默认为false */</span></span><br><span class="line">    <span class="string">"downlevelIteration"</span>: <span class="literal">true</span>,            <span class="comment">/* 当target为'ES5' or 'ES3'时，为'for-of', spread, and destructuring'中的迭代器提供完全支持 */</span></span><br><span class="line">    <span class="string">"isolatedModules"</span>: <span class="literal">true</span>,               <span class="comment">/* isolatedModules的值为true或false，指定是否将每个文件作为单独的模块，默认为true，它不可以和declaration同时设定 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Strict Type-Checking Options */</span></span><br><span class="line">    <span class="string">"strict"</span>: <span class="literal">true</span> <span class="comment">/* strict的值为true或false，用于指定是否启动所有类型检查，如果设为true则会同时开启下面这几个严格类型检查，默认为false */</span>,</span><br><span class="line">    <span class="string">"noImplicitAny"</span>: <span class="literal">true</span>,                 <span class="comment">/* noImplicitAny的值为true或false，如果我们没有为一些值设置明确的类型，编译器会默认认为这个值为any，如果noImplicitAny的值为true的话。则没有明确的类型会报错。默认值为false */</span></span><br><span class="line">    <span class="string">"strictNullChecks"</span>: <span class="literal">true</span>,              <span class="comment">/* strictNullChecks为true时，null和undefined值不能赋给非这两种类型的值，别的类型也不能赋给他们，除了any类型。还有个例外就是undefined可以赋值给void类型 */</span></span><br><span class="line">    <span class="string">"strictFunctionTypes"</span>: <span class="literal">true</span>,           <span class="comment">/* strictFunctionTypes的值为true或false，用于指定是否使用函数参数双向协变检查 */</span></span><br><span class="line">    <span class="string">"strictBindCallApply"</span>: <span class="literal">true</span>,           <span class="comment">/* 设为true后会对bind、call和apply绑定的方法的参数的检测是严格检测的 */</span></span><br><span class="line">    <span class="string">"strictPropertyInitialization"</span>: <span class="literal">true</span>,  <span class="comment">/* 设为true后会检查类的非undefined属性是否已经在构造函数里初始化，如果要开启这项，需要同时开启strictNullChecks，默认为false */</span></span><br><span class="line">   <span class="string">"noImplicitThis"</span>: <span class="literal">true</span>,                <span class="comment">/* 当this表达式的值为any类型的时候，生成一个错误 */</span></span><br><span class="line">    <span class="string">"alwaysStrict"</span>: <span class="literal">true</span>,                  <span class="comment">/* alwaysStrict的值为true或false，指定始终以严格模式检查每个模块，并且在编译之后的js文件中加入"use strict"字符串，用来告诉浏览器该js为严格模式 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Additional Checks */</span></span><br><span class="line">    <span class="string">"noUnusedLocals"</span>: <span class="literal">true</span>,                <span class="comment">/* 用于检查是否有定义了但是没有使用的变量，对于这一点的检测，使用eslint可以在你书写代码的时候做提示，你可以配合使用。它的默认值为false */</span></span><br><span class="line">    <span class="string">"noUnusedParameters"</span>: <span class="literal">true</span>,            <span class="comment">/* 用于检查是否有在函数体中没有使用的参数，这个也可以配合eslint来做检查，默认为false */</span></span><br><span class="line">    <span class="string">"noImplicitReturns"</span>: <span class="literal">true</span>,             <span class="comment">/* 用于检查函数是否有返回值，设为true后，如果函数没有返回值则会提示，默认为false */</span></span><br><span class="line">    <span class="string">"noFallthroughCasesInSwitch"</span>: <span class="literal">true</span>,    <span class="comment">/* 用于检查switch中是否有case没有使用break跳出switch，默认为false */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Module Resolution Options */</span></span><br><span class="line">    <span class="string">"moduleResolution"</span>: <span class="string">"node"</span>,            <span class="comment">/* 用于选择模块解析策略，有'node'和'classic'两种类型' */</span></span><br><span class="line">    <span class="string">"baseUrl"</span>: <span class="string">"./"</span>,                       <span class="comment">/* baseUrl用于设置解析非相对模块名称的基本目录，相对模块不会受baseUrl的影响 */</span></span><br><span class="line">    <span class="string">"paths"</span>: &#123;&#125;,                           <span class="comment">/* 用于设置模块名称到基于baseUrl的路径映射 */</span></span><br><span class="line">    <span class="string">"rootDirs"</span>: [],                        <span class="comment">/* rootDirs可以指定一个路径列表，在构建时编译器会将这个路径列表中的路径的内容都放到一个文件夹中 */</span></span><br><span class="line">    <span class="string">"typeRoots"</span>: [],                       <span class="comment">/* typeRoots用来指定声明文件或文件夹的路径列表，如果指定了此项，则只有在这里列出的声明文件才会被加载 */</span></span><br><span class="line">    <span class="string">"types"</span>: [],                           <span class="comment">/* types用来指定需要包含的模块，只有在这里列出的模块的声明文件才会被加载进来 */</span></span><br><span class="line">    <span class="string">"allowSyntheticDefaultImports"</span>: <span class="literal">true</span>,  <span class="comment">/* 用来指定允许从没有默认导出的模块中默认导入 */</span></span><br><span class="line">    <span class="string">"esModuleInterop"</span>: <span class="literal">true</span> <span class="comment">/* 通过为导入内容创建命名空间，实现CommonJS和ES模块之间的互操作性 */</span>,</span><br><span class="line">    <span class="string">"preserveSymlinks"</span>: <span class="literal">true</span>,              <span class="comment">/* 不把符号链接解析为其真实路径，具体可以了解下webpack和nodejs的symlink相关知识 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Source Map Options */</span></span><br><span class="line">    <span class="string">"sourceRoot"</span>: <span class="string">""</span>,                      <span class="comment">/* sourceRoot用于指定调试器应该找到TypeScript文件而不是源文件位置，这个值会被写进.map文件里 */</span></span><br><span class="line">    <span class="string">"mapRoot"</span>: <span class="string">""</span>,                         <span class="comment">/* mapRoot用于指定调试器找到映射文件而非生成文件的位置，指定map文件的根路径，该选项会影响.map文件中的sources属性 */</span></span><br><span class="line">    <span class="string">"inlineSourceMap"</span>: <span class="literal">true</span>,               <span class="comment">/* 指定是否将map文件的内容和js文件编译在同一个js文件中，如果设为true，则map的内容会以//# sourceMappingURL=然后拼接base64字符串的形式插入在js文件底部 */</span></span><br><span class="line">    <span class="string">"inlineSources"</span>: <span class="literal">true</span>,                 <span class="comment">/* 用于指定是否进一步将.ts文件的内容也包含到输入文件中 */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Experimental Options */</span></span><br><span class="line">    <span class="string">"experimentalDecorators"</span>: <span class="literal">true</span> <span class="comment">/* 用于指定是否启用实验性的装饰器特性 */</span></span><br><span class="line">    <span class="string">"emitDecoratorMetadata"</span>: <span class="literal">true</span>,         <span class="comment">/* 用于指定是否为装饰器提供元数据支持，关于元数据，也是ES6的新标准，可以通过Reflect提供的静态方法获取元数据，如果需要使用Reflect的一些方法，需要引入ES2015.Reflect这个库 */</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="string">"files"</span>: [], <span class="comment">// files可以配置一个数组列表，里面包含指定文件的相对或绝对路径，编译器在编译的时候只会编译包含在files中列出的文件，如果不指定，则取决于有没有设置include选项，如果没有include选项，则默认会编译根目录以及所有子目录中的文件。这里列出的路径必须是指定文件，而不是某个文件夹，而且不能使用* ? **/ 等通配符</span></span><br><span class="line">  <span class="string">"include"</span>: [],  <span class="comment">// include也可以指定要编译的路径列表，但是和files的区别在于，这里的路径可以是文件夹，也可以是文件，可以使用相对和绝对路径，而且可以使用通配符，比如"./src"即表示要编译src文件夹下的所有文件以及子文件夹的文件</span></span><br><span class="line">  <span class="string">"exclude"</span>: [],  <span class="comment">// exclude表示要排除的、不编译的文件，它也可以指定一个列表，规则和include一样，可以是文件或文件夹，可以是相对路径或绝对路径，可以使用通配符</span></span><br><span class="line">  <span class="string">"extends"</span>: <span class="string">""</span>,   <span class="comment">// extends可以通过指定一个其他的tsconfig.json文件路径，来继承这个配置文件里的配置，继承来的文件的配置会覆盖当前文件定义的配置。TS在3.2版本开始，支持继承一个来自Node.js包的tsconfig.json配置文件</span></span><br><span class="line">  <span class="string">"compileOnSave"</span>: <span class="literal">true</span>,  <span class="comment">// compileOnSave的值是true或false，如果设为true，在我们编辑了项目中的文件保存的时候，编辑器会根据tsconfig.json中的配置重新生成文件，不过这个要编辑器支持</span></span><br><span class="line">  <span class="string">"references"</span>: [],  <span class="comment">// 一个对象数组，指定要引用的项目</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-6-路由和页面跳转"><a href="#2-6-路由和页面跳转" class="headerlink" title="2.6 路由和页面跳转"></a>2.6 路由和页面跳转</h2><h3 id="2-6-1-新建路由"><a href="#2-6-1-新建路由" class="headerlink" title="2.6.1 新建路由"></a>2.6.1 新建路由</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.敲入命令如下</span></span><br><span class="line">$   umi g page product/index --typescript --less</span><br><span class="line"></span><br><span class="line">   create src/pages/product/index.js</span><br><span class="line">   create src/pages/product/index.css</span><br><span class="line">✔  success</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.修改 .umirc.ts文件中路由配置</span></span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/'</span>,</span><br><span class="line">      <span class="comment">//注意：这边文件的路径是相对于src/.mui中来确定的</span></span><br><span class="line">      component: <span class="string">'../layouts/index'</span>,</span><br><span class="line">      routes: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">'/product/index'</span>,</span><br><span class="line">          component: <span class="string">'../pages/product/index'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123; </span><br><span class="line">          path: <span class="string">'/'</span>, </span><br><span class="line">          component: <span class="string">'../pages/index'</span> </span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.在src目录下创建typings.d.ts 文件 </span></span><br><span class="line"><span class="comment">//模块声明文件：不写在引入less的时候ts会警告</span></span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'slash2'</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'*.css'</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'*.less'</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'*.scss'</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'*.sass'</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'*.svg'</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'*.png'</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'*.jpg'</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'*.jpeg'</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'*.gif'</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'*.bmp'</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'*.tiff'</span>;</span><br><span class="line">declare <span class="built_in">module</span> <span class="string">'omit.js'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-6-2-约定式路由"><a href="#2-6-2-约定式路由" class="headerlink" title="2.6.2 约定式路由"></a>2.6.2 约定式路由</h3><p>除配置式路由外，Umi 也支持约定式路由。约定式路由也叫文件路由，就是不需要手写配置，文件系统即路由，通过目录和文件及其命名分析出路由配置。</p>
<p><strong>如果没有 routes 配置，Umi 会进入约定式路由模式</strong>，然后分析 <code>src/pages</code> 目录拿到路由配置。</p>
<p>比如以下文件结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">  └── pages</span><br><span class="line">    ├── index.tsx</span><br><span class="line">    └── users.tsx</span><br></pre></td></tr></table></figure>

<p>会得到以下路由配置，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123; exact: true, path: &#39;&#x2F;&#39;, component: &#39;@&#x2F;pages&#x2F;index&#39; &#125;,</span><br><span class="line">  &#123; exact: true, path: &#39;&#x2F;users&#39;, component: &#39;@&#x2F;pages&#x2F;users&#39; &#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>需要注意的是，满足以下任意规则的文件不会被注册为路由，</p>
<ul>
<li>以 <code>.</code> 或 <code>_</code> 开头的文件或目录</li>
<li>以 <code>d.ts</code> 结尾的类型定义文件</li>
<li>以 <code>test.ts</code>、<code>spec.ts</code>、<code>e2e.ts</code> 结尾的测试文件（适用于 <code>.js</code>、<code>.jsx</code> 和 <code>.tsx</code> 文件）</li>
<li><code>components</code> 和 <code>component</code> 目录</li>
<li><code>utils</code> 和 <code>util</code> 目录</li>
<li>不是 <code>.js</code>、<code>.jsx</code>、<code>.ts</code> 或 <code>.tsx</code> 文件</li>
<li>文件内容不包含 JSX 元素</li>
</ul>
<p><strong>所以当我们把.umirc.js中的routes配置注释掉的时候，访问路径<a href="http://localhost:8000/#/product" target="_blank" rel="noopener">http://localhost:8000/#/product</a>能够正常展示页面。</strong></p>
<h3 id="2-6-3-路由配置"><a href="#2-6-3-路由配置" class="headerlink" title="2.6.3 路由配置"></a>2.6.3 路由配置</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">component: <span class="string">'@/layouts/index'</span>         <span class="comment">//配置页面模板，不同的路由可以配置不同的layout</span></span><br><span class="line">&#123; <span class="attr">path</span>: <span class="string">'/one'</span>, <span class="attr">exact</span>: <span class="literal">true</span> &#125;        <span class="comment">//严格匹配，location 是否和 path 完全对应上</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置子路由</span></span><br><span class="line">routes: [</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">'/list'</span>, <span class="attr">component</span>: <span class="string">'list'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">path</span>: <span class="string">'/admin'</span>, <span class="attr">component</span>: <span class="string">'admin'</span> &#125;,</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line"><span class="comment">//重定向</span></span><br><span class="line">&#123; <span class="attr">exact</span>: <span class="literal">true</span>, <span class="attr">path</span>: <span class="string">'/'</span>, <span class="attr">redirect</span>: <span class="string">'/list'</span> &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="2-6-4-路由跳转和传参"><a href="#2-6-4-路由跳转和传参" class="headerlink" title="2.6.4 路由跳转和传参"></a>2.6.4 路由跳转和传参</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;Link to=<span class="string">"/users"</span>&gt;Users Page&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; history &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line"><span class="comment">// 跳转到指定路由</span></span><br><span class="line">history.push(<span class="string">'/list'</span>);</span><br><span class="line"><span class="comment">// 带参数跳转到指定路由</span></span><br><span class="line">history.push(<span class="string">'/list?a=b'</span>);</span><br><span class="line">history.push(&#123;</span><br><span class="line">  pathname: <span class="string">'/list'</span>,</span><br><span class="line">  query: &#123;</span><br><span class="line">    a: <span class="string">'b'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 跳转到上一个路由</span></span><br><span class="line">history.goBack();</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//路由组件可通过 props 获取到以下属性，</span></span><br><span class="line"></span><br><span class="line">match，当前路由和 url match 后的对象，包含 params、path、url 和 isExact 属性</span><br><span class="line">location，表示应用当前出于哪个位置，包含 pathname、search、query 等属性</span><br><span class="line">history，同 api history 接口</span><br><span class="line">route，当前路由配置，包含 path、exact、component、routes 等</span><br><span class="line">routes，全部路由信息</span><br></pre></td></tr></table></figure>

<h3 id="2-6-5-动态路由参数"><a href="#2-6-5-动态路由参数" class="headerlink" title="2.6.5 动态路由参数"></a>2.6.5 动态路由参数</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.新建productDetail/index/[id].tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./productDetail.less'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//要从props中获取location history match等参数，需要引入RouteComponentProps类型</span></span><br><span class="line"><span class="keyword">import</span> &#123; RouteComponentProps &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> RouterInfo &#123;</span><br><span class="line">  id: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (props: RouteComponentProps&lt;RouterInfo&gt;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1 className=&#123;styles.title&#125;&gt;Page productDetail/index ---&#123;props.match.params.id&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.修改.umirc.ts</span></span><br><span class="line">routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/'</span>,</span><br><span class="line">      <span class="comment">//注意：这边文件的路径是相对于src/.mui中来确定的</span></span><br><span class="line">      component: <span class="string">'../layouts/index'</span>,</span><br><span class="line">      routes: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">'/product/index'</span>,</span><br><span class="line">          component: <span class="string">'../pages/product/index'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123; </span><br><span class="line">          path: <span class="string">'/productDetail/:id'</span>, </span><br><span class="line">          component: <span class="string">'../pages/productDetail/index/[id]'</span> </span><br><span class="line">        &#125;,</span><br><span class="line">        &#123; </span><br><span class="line">          path: <span class="string">'/'</span>, </span><br><span class="line">          component: <span class="string">'../pages/index'</span> </span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure>

<h2 id="2-7-样式和资源文件"><a href="#2-7-样式和资源文件" class="headerlink" title="2.7 样式和资源文件"></a>2.7 样式和资源文件</h2><h3 id="2-7-1-全局样式"><a href="#2-7-1-全局样式" class="headerlink" title="2.7.1 全局样式"></a>2.7.1 全局样式</h3><p>Umi 中约定 <code>src/global.css</code> 为全局样式，如果存在此文件，会被自动引入到入口文件最前面。</p>
<p>比如用于覆盖样式，</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.ant-select-selection</span> &#123;</span><br><span class="line">  <span class="attribute">max-height</span>: <span class="number">51px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-7-2-CSS-Modules"><a href="#2-7-2-CSS-Modules" class="headerlink" title="2.7.2 CSS Modules"></a>2.7.2 CSS Modules</h3><p>Umi 会自动识别 CSS Modules 的使用，你把他当做 CSS Modules 用时才是 CSS Modules。</p>
<p>比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// CSS Modules</span></span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./foo.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非 CSS Modules</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./foo.css'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-7-3-CSS-预处理器"><a href="#2-7-3-CSS-预处理器" class="headerlink" title="2.7.3 CSS 预处理器"></a>2.7.3 CSS 预处理器</h3><p>Umi 内置支持 less，不支持 sass 和 stylus，但如果有需求，可以通过 chainWebpack 配置或者 Umi 插件的形式支持。</p>
<h3 id="2-7-4-ts中使用图片"><a href="#2-7-4-ts中使用图片" class="headerlink" title="2.7.4 ts中使用图片"></a>2.7.4 ts中使用图片</h3><p>通过 require 引用相对路径的图片。</p>
<p>比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; <span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;require(</span>'<span class="attr">.</span>/<span class="attr">foo.png</span>')&#125; /&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>支持别名，比如通过 <code>@</code> 指向 src 目录：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; <span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;require(</span>'@/<span class="attr">foo.png</span>')&#125; /&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="2-7-5-CSS-里使用图片"><a href="#2-7-5-CSS-里使用图片" class="headerlink" title="2.7.5 CSS 里使用图片"></a>2.7.5 CSS 里使用图片</h3><p>通过相对路径引用。</p>
<p>比如，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.logo &#123;</span><br><span class="line">  background: url(./foo.png);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CSS 里也支持别名，但需要在前面加 <code>~</code> 前缀，</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.logo &#123;</span><br><span class="line">  background: url(~@/foo.png);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>这是 webpack 的规则，如果切到其他打包工具，可能会有变化</li>
<li>less 中同样适用</li>
</ol>
<h3 id="2-7-6-Base64-编译"><a href="#2-7-6-Base64-编译" class="headerlink" title="2.7.6 Base64 编译"></a>2.7.6 Base64 编译</h3><p>通过相对路径引入图片的时候，如果图片小于 10K，会被编译为 Base64，否则会被构建为独立的图片文件。</p>
<p>10K 这个阈值可以通过 <a href="https://umijs.org/zh-CN/config#inlinelimit" target="_blank" rel="noopener">inlineLimit 配置</a>修改。</p>
<h2 id="2-8-国际化"><a href="#2-8-国际化" class="headerlink" title="2.8 国际化"></a>2.8 国际化</h2><p>@umijs/plugin-locale是umi中的一个国际化插件，用于解决 i18n 问题。</p>
<h3 id="2-8-1-开启国际化"><a href="#2-8-1-开启国际化" class="headerlink" title="2.8.1 开启国际化"></a>2.8.1 开启国际化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在.umirc.ts中配置locale之后即开启该插件</span></span><br><span class="line">  locale: &#123;</span><br><span class="line">    <span class="comment">//默认的语言环境</span></span><br><span class="line">    <span class="keyword">default</span>: <span class="string">'zh-CN'</span>,</span><br><span class="line">    <span class="comment">//antd开启国际化</span></span><br><span class="line">    antd: <span class="literal">true</span>, </span><br><span class="line">    <span class="comment">// default true, when it is true, will use `navigator.language` overwrite default</span></span><br><span class="line">    baseNavigator: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<h3 id="2-8-2-约定式多语言支持"><a href="#2-8-2-约定式多语言支持" class="headerlink" title="2.8.2 约定式多语言支持"></a>2.8.2 约定式多语言支持</h3><p>比如以下目录，项目就拥有了 <code>zh-CN</code> 与 <code>en-US</code> 国际化语言切换(文件名必须要符合规范)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+ src</span><br><span class="line">  + locales</span><br><span class="line">    - zh-CN.ts</span><br><span class="line">    - en-US.ts</span><br><span class="line">  + pages</span><br></pre></td></tr></table></figure>

<h3 id="2-8-3-主要API"><a href="#2-8-3-主要API" class="headerlink" title="2.8.3 主要API"></a>2.8.3 主要API</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># getAllLocales 获取当前获得所有国际化文件的列表，默认会在 locales 文件夹下寻找类似 en-US.(js|json|ts) 文件。</span><br><span class="line"><span class="keyword">import</span> &#123; getAllLocales &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(getAllLocales()); <span class="comment">// [en-US,zh-CN,...]</span></span><br><span class="line"></span><br><span class="line"># getLocale 将获得当前选择的语言。</span><br><span class="line"><span class="keyword">import</span> &#123; getLocale &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line"><span class="built_in">console</span>.log(getLocale()); <span class="comment">// en-US | zh-CN</span></span><br><span class="line"></span><br><span class="line"># useIntl 是最常用的 api,它可以获得 formatMessage 等 api 来进行具体的值绑定。</span><br><span class="line"><span class="keyword">import</span> &#123; useIntl &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line">&lt;a&gt;</span><br><span class="line">	&#123;useIntl().formatMessage(&#123; id: <span class="string">'index.start'</span> &#125;)&#125;</span><br><span class="line">&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"># setLocale 设置切换语言，默认会刷新页面，可以通过设置第二个参数为 false ，来实现无刷新动态切换。</span></span><br><span class="line"><span class="regexp">import &#123; setLocale &#125; from 'umi';</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 刷新页面</span></span><br><span class="line"><span class="regexp">setLocale('zh-TW', true);</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 不刷新页面</span></span><br><span class="line"><span class="regexp">setLocale('zh-TW', false);</span></span><br></pre></td></tr></table></figure>

<h1 id="3-flux和redux"><a href="#3-flux和redux" class="headerlink" title="3.flux和redux"></a>3.flux和redux</h1><h2 id="3-1-Flux"><a href="#3-1-Flux" class="headerlink" title="3.1 Flux"></a>3.1 Flux</h2><p>Flux 是一种架构思想，专门解决软件的结构问题。它跟<a href="http://www.ruanyifeng.com/blog/2007/11/mvc.html" target="_blank" rel="noopener">MVC 架构</a>是同一类东西，但是更加<a href="http://www.infoq.com/news/2014/05/facebook-mvc-flux" target="_blank" rel="noopener">简单和清晰</a>。</p>
<p>首先，Flux将一个应用分成四个部分。</p>
<blockquote>
<ul>
<li><strong>View</strong>： 视图层</li>
<li><strong>Action</strong>（动作）：表示数据从应用程序发送到store的有效信息负载。它是 store 数据的<strong>唯一</strong>来源。一般来说你会通过 Dispatcher派发器将 action 传到 store。</li>
<li><strong>Dispatcher</strong>（派发器）：用来接收Actions、执行回调函数</li>
<li><strong>Store</strong>（数据层）：用来存放应用的状态，一旦发生变动，就提醒Views要更新页面</li>
</ul>
</blockquote>
<p><strong>Flux 的最大特点，就是数据的”单向流动”。</strong></p>
<blockquote>
<ol>
<li>用户访问 View</li>
<li>用户在View中Dispatcher一个Action，要求 Store 进行相应的更新</li>
<li>Store 更新后，发出一个”change”事件</li>
<li>View 收到”change”事件后，更新页面</li>
</ol>
</blockquote>
<p><img src= "/img/loading.gif" data-src="D:/%E5%89%8D%E7%AB%AF%E5%A4%87%E8%AF%BE/17.REACT/readme/assets/1553222968163.png" alt="1553222968163"></p>
<p><img src= "/img/loading.gif" data-src="D:/%E5%89%8D%E7%AB%AF%E5%A4%87%E8%AF%BE/17.REACT/readme/assets/1553223019430.png" alt="1553223019430"></p>
<h2 id="3-2-Redux"><a href="#3-2-Redux" class="headerlink" title="3.2 Redux"></a>3.2 Redux</h2><p><a href="http://cn.redux.js.org/" target="_blank" rel="noopener">http://cn.redux.js.org/</a></p>
<p>我们把Flux看做一个框架的理念的话，Redux是Flux的一种实现。Redux是SPA单页面应用程序中多个组件之间共享数据的一种方式。</p>
<p>Flux的基本原则是“单向数据流”，Redux在此基础上强调三个基本原则：</p>
<blockquote>
<p>1.唯一数据源 ：唯一数据源指的是应用的状态数据应该只存储在唯一的一个Store上。<br>2.保持状态只读 ： 保持状态只读，就是说不能去直接修改状态，要修改Store的状态，必须要通过派发一个action对象完成。<br>3.数据改变只能通过纯函数完成 ：这里所说的纯函数就是把Reducer，Reducer描述了state状态如何修改。Redux这个名字的前三个字母Red代表的就是Reducer，其实Redux名字的含义就是Reducer+Flux。</p>
</blockquote>
<p><img src= "/img/loading.gif" data-src="D:%5C%E5%89%8D%E7%AB%AF%E5%A4%87%E8%AF%BE%5C17.REACT%5Creadme%5Cassets/u=241910270,3281944895&fm=26&gp=0.png" alt="u=241910270,3281944895&amp;fm=26&amp;gp=0"></p>
<h2 id="3-3-dva"><a href="#3-3-dva" class="headerlink" title="3.3 dva"></a>3.3 dva</h2><h3 id="3-3-1-dva介绍"><a href="#3-3-1-dva介绍" class="headerlink" title="3.3.1 dva介绍"></a>3.3.1 dva介绍</h3><p>dva由阿里架构师 sorrycc 带领 team 完成的一套前端框架，dva 是一个基于 <a href="https://github.com/reduxjs/redux" target="_blank" rel="noopener">redux</a> 和 <a href="https://github.com/redux-saga/redux-saga" target="_blank" rel="noopener">redux-saga</a> (异步处理)的数据流方案，然后为了简化开发体验，dva 还额外内置了 <a href="https://github.com/ReactTraining/react-router" target="_blank" rel="noopener">react-router</a> 和 <a href="https://github.com/github/fetch" target="_blank" rel="noopener">fetch</a>，所以也可以理解为一个轻量级的应用框架。</p>
<blockquote>
<p><strong>特性</strong></p>
</blockquote>
<ul>
<li><strong>易学易用</strong>，仅有 6 个 api，对 redux 用户尤其友好，<a href="https://umijs.org/guide/with-dva.html" target="_blank" rel="noopener">配合 umi 使用</a>后更是降低为 0 API</li>
<li><strong>elm 概念</strong>，通过 reducers, effects 和 subscriptions 组织 model。elm是专注web前端的纯函数式语言。</li>
<li><strong>插件机制</strong>，比如 <a href="https://github.com/dvajs/dva/tree/master/packages/dva-loading" target="_blank" rel="noopener">dva-loading</a> 可以自动处理 loading 状态，不用一遍遍地写 showLoading 和 hideLoading</li>
<li><strong>支持 HMR</strong>，基于 <a href="https://github.com/dvajs/babel-plugin-dva-hmr" target="_blank" rel="noopener">babel-plugin-dva-hmr</a> 实现 components、routes 和 models 的 HMR</li>
</ul>
<h3 id="3-3-2-dva的数据流"><a href="#3-3-2-dva的数据流" class="headerlink" title="3.3.2 dva的数据流"></a>3.3.2 dva的数据流</h3><p><img src= "/img/loading.gif" data-src="D:%5C%E5%89%8D%E7%AB%AF%E5%A4%87%E8%AF%BE%5C17.REACT%5Creadme%5Cassets%5C1601034916207.png" alt="1601034916207"></p>
<p>用户在 <strong>视图层</strong> 会触发(dispatch)一些动作(action)，这些动作会传递到我们的Model.js 这个文件当中，根据action的名字，找到对用的方法(effect 或者 reducer) ，然后更新state，视图重新渲染。</p>
<h3 id="3-3-3-dva核心概念"><a href="#3-3-3-dva核心概念" class="headerlink" title="3.3.3 dva核心概念"></a>3.3.3 dva核心概念</h3><h4 id="a-model"><a href="#a-model" class="headerlink" title="a) model"></a>a) model</h4><p>其中，model 是 DVA 中最重要的概念，基本的属性如下：</p>
<ul>
<li>namespace：model 的命名空间，只能用字符串。一个大型应用可能包含多个 model，通过namespace区分。</li>
<li>state：当前 model 状态的初始值，表示当前状态。</li>
<li>reducers：用于处理同步操作，可以修改 state，由 action 触发。</li>
<li>effects：用于处理异步操作（例如：与服务端交互）和业务逻辑，也是由 action 触发。但是，它不可以修改 state，要通过触发 action 调用 reducer 实现对 state 的间接操作。</li>
</ul>
<h4 id="b-connect"><a href="#b-connect" class="headerlink" title="b) connect"></a>b) connect</h4><p>连接dva model和react组件，目的是为了让组件获取model中的数据和驱动model改变的方法。</p>
<h4 id="c-dispatch"><a href="#c-dispatch" class="headerlink" title="c) dispatch"></a>c) dispatch</h4><p>dispatch 函数就是和 dva model 打交道的唯一途径， dispatch 函数接受一个 action对象 作为入参。action对象需要有type字段</p>
<h4 id="d-action"><a href="#d-action" class="headerlink" title="d) action"></a>d) action</h4><p>action：一个对象，是 reducers 及 effects 的触发器，通过dispatch来触发，action对象需要有type字段</p>
<h2 id="3-4-dva实战"><a href="#3-4-dva实战" class="headerlink" title="3.4 dva实战"></a>3.4 dva实战</h2><h3 id="3-4-1-改造项目结构"><a href="#3-4-1-改造项目结构" class="headerlink" title="3.4.1 改造项目结构"></a>3.4.1 改造项目结构</h3><p><img src= "/img/loading.gif" data-src="D:%5C%E5%89%8D%E7%AB%AF%E5%A4%87%E8%AF%BE%5C17.REACT%5Creadme%5Cassets%5C1601195437274.png" alt="1601195437274"></p>
<h3 id="3-4-2-mock"><a href="#3-4-2-mock" class="headerlink" title="3.4.2 mock"></a>3.4.2 mock</h3><h4 id="a-mock介绍"><a href="#a-mock介绍" class="headerlink" title="a) mock介绍"></a>a) mock介绍</h4><p>Mock 是高效、易用、功能强大的 api 管理平台,旨在为开发、产品、测试人员提供更优雅的接口管理服务。可以帮助开发者轻松创建、发布、维护 API。主要用于项目的开发测试阶段。</p>
<p><a href="https://github.com/nuysoft/Mock/wiki" target="_blank" rel="noopener">https://github.com/nuysoft/Mock/wiki</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#1. 安装mockjs</span><br><span class="line">yarn add mockjs --dev</span><br><span class="line"></span><br><span class="line">#2. 修改.umirc.ts  开启mock</span><br><span class="line">  mock: &#123;&#125;</span><br><span class="line"></span><br><span class="line">#3. mock基本使用  </span><br><span class="line"><span class="comment">// 在项目mock文件夹下新建user.ts  代码如下</span></span><br><span class="line"><span class="keyword">import</span> &#123; Request, Response &#125; <span class="keyword">from</span> <span class="string">'express'</span>;</span><br><span class="line"><span class="keyword">import</span> Mock <span class="keyword">from</span> <span class="string">'mockjs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//测试mock   mock语法介绍 todos.....</span></span><br><span class="line">  <span class="string">'/api/test'</span>: &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">username</span>: <span class="string">'kenny'</span>, <span class="attr">sex</span>: <span class="number">6</span> &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="string">'GET /api/hi'</span>: <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;</span><br><span class="line">    res.json(&#123;</span><br><span class="line">      id: <span class="number">1</span>,</span><br><span class="line">      username: <span class="string">'jaja'</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">    </span><br><span class="line">  <span class="string">'GET /api/mock'</span>: Mock.mock(&#123;</span><br><span class="line">    success: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">//随机生成一段中文</span></span><br><span class="line">    message: <span class="string">'@cparagraph'</span>,</span><br><span class="line">    <span class="comment">// 属性 list 的值是一个数组，其中含有 1 到 5 个元素</span></span><br><span class="line">    <span class="string">'list|1-5'</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 属性 sid 是一个自增数，起始值为 1，每次增 1</span></span><br><span class="line">        <span class="string">'sid|+1'</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="comment">// 属性 userId 是一个5位的随机码</span></span><br><span class="line">        <span class="string">'userId|5'</span>: <span class="string">''</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="b-mock-user-js使用mock提供接口数据"><a href="#b-mock-user-js使用mock提供接口数据" class="headerlink" title="b) mock/user.js使用mock提供接口数据"></a>b) mock/user.js使用mock提供接口数据</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Request, Response &#125; <span class="keyword">from</span> <span class="string">'express'</span>;</span><br><span class="line"><span class="keyword">import</span> Mock <span class="keyword">from</span> <span class="string">'mockjs'</span>;</span><br><span class="line"></span><br><span class="line">interface UserType &#123;</span><br><span class="line">  id: number;</span><br><span class="line">  name: string;</span><br><span class="line">  email: string;</span><br><span class="line">  website: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> users: UserType[] = [</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">'zhangsan'</span>, <span class="attr">email</span>: <span class="string">'zhangsan@qq.com'</span>, <span class="attr">website</span>: <span class="string">'xx.com'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">'lisi'</span>, <span class="attr">email</span>: <span class="string">'lisi@qq.com'</span>, <span class="attr">website</span>: <span class="string">'ll.com'</span> &#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">//查询所有用户</span></span><br><span class="line">  <span class="string">'GET /api/users'</span>: <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取参数信息</span></span><br><span class="line">    <span class="keyword">var</span> page = req.query.page;</span><br><span class="line">    <span class="keyword">var</span> data = &#123; <span class="attr">list</span>: users, <span class="attr">total</span>: <span class="number">105</span>, <span class="attr">page</span>: page &#125;;</span><br><span class="line">    res.json(data);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// GET POST 可省略</span></span><br><span class="line">  <span class="string">'/api/users/:id'</span>: <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">parseInt</span>(req.params.id);</span><br><span class="line">    <span class="keyword">const</span> u = users.find(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (item.id === id) &#123;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    res.json(u);</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//根据id删除用户</span></span><br><span class="line">  <span class="string">'/api/users/delete/:id'</span>: <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> id = <span class="built_in">parseInt</span>(req.params.id);</span><br><span class="line">    <span class="keyword">const</span> index = users.findIndex(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (item.id == id) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    users.splice(index, <span class="number">1</span>);</span><br><span class="line">    res.json(&#123;</span><br><span class="line">      status: <span class="number">200</span>,</span><br><span class="line">      message: <span class="string">'删除成功'</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 支持自定义函数，API 参考 express@4</span></span><br><span class="line">  <span class="string">'POST /api/users/create'</span>: <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> &#123;</span><br><span class="line">    res.end(<span class="string">'OK'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-3-请求的封装"><a href="#3-4-3-请求的封装" class="headerlink" title="3.4.3 请求的封装"></a>3.4.3 请求的封装</h3><h4 id="a-fetch和umi-request"><a href="#a-fetch和umi-request" class="headerlink" title="a) fetch和umi-request"></a>a) fetch和umi-request</h4><p><strong>fetch</strong>是es6中推出的一种可替代ajax获取/提交数据的技术，有些高级浏览器已经可以使用window.fecth使用了。相比于使用jQuery.ajax更轻量，而且它支持Promise，更加符合现在的编程习惯。但是，一定记住fetch不是ajax的进一步封装，而是原生js，没有使用XMLHttpRequest对象。</p>
<p><strong><a href="https://link.zhihu.com/?target=https%3A//github.com/umijs/umi-request">umi-request</a></strong> 是基于 fetch 封装的开源 http 请求库，旨在为开发者提供一个统一的 API 调用方式，同时简化使用方式，提供了请求层常用的功能：</p>
<ul>
<li>URL 参数自动序列化</li>
<li>POST 数据提交方式简化</li>
<li>Response 返回处理简化</li>
<li>请求超时处理</li>
<li>请求缓存支持</li>
<li>GBK 编码处理</li>
<li>统一的错误处理方式</li>
<li>请求取消支持</li>
<li>Node 环境 http 请求</li>
<li>拦截器机制</li>
<li>洋葱中间件机制</li>
</ul>
<p><strong>umi-request和fetch和axios区别</strong></p>
<p><img src= "/img/loading.gif" data-src="D:%5C%E5%89%8D%E7%AB%AF%E5%A4%87%E8%AF%BE%5C17.REACT%5Creadme%5Cassets/Snipaste_2020-09-27_10-41-42.png" alt="Snipaste_2020-09-27_10-41-42"></p>
<h4 id="b-app-ts运行时配置"><a href="#b-app-ts运行时配置" class="headerlink" title="b) app.ts运行时配置"></a>b) app.ts运行时配置</h4><p>运行时配置文件，可以在这里扩展运行时的能力，比如修改路由、修改 render 方法等。</p>
<p>Umi约定 <code>src/app.tsx</code> 为运行时配置。比如我们可以再在 <code>src/app.ts</code> 中配置一些运行时的配置项来实现部分自定义需求。示例配置如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通知组件</span></span><br><span class="line"><span class="keyword">import</span> &#123; notification &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="comment">//RequestConfig 请求的配置类型</span></span><br><span class="line"><span class="keyword">import</span> &#123; RequestConfig &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ResponseError &#125; <span class="keyword">from</span> <span class="string">'umi-request'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求出错后的异常处理程序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> errorHandler = <span class="function">(<span class="params">error: ResponseError</span>) =&gt;</span> &#123;</span><br><span class="line">  notification.error(&#123;</span><br><span class="line">    description: <span class="string">'您的网络发生异常，无法连接服务器'</span>,</span><br><span class="line">    message: <span class="string">'网络异常'</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">throw</span> error;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出请求对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> request: RequestConfig = &#123;</span><br><span class="line">  errorHandler,</span><br><span class="line">  requestInterceptors: [</span><br><span class="line">    (url, options) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'请求拦截器'</span>);</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        url,</span><br><span class="line">        options,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  responseInterceptors: [</span><br><span class="line">    (response, options) =&gt; &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'响应拦截器'</span>)</span><br><span class="line">      <span class="keyword">return</span> response;</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="c-封装service"><a href="#c-封装service" class="headerlink" title="c) 封装service"></a>c) 封装service</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pages/user/services/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; request &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">queryUserList</span>(<span class="params">&#123; page = <span class="number">1</span> &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(<span class="string">`/api/users?page=<span class="subst">$&#123;page&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-4-新建页面-发送请求"><a href="#3-4-4-新建页面-发送请求" class="headerlink" title="3.4.4 新建页面 发送请求"></a>3.4.4 新建页面 发送请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.创建页面</span></span><br><span class="line">umi g page user/index --typescript --less</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.配置路由  .umirc.ts</span></span><br><span class="line">routes: [</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">'/'</span>,</span><br><span class="line">        <span class="comment">//注意：这边文件的路径是相对于src/.mui中来确定的</span></span><br><span class="line">        component: <span class="string">'../layouts/index'</span>,</span><br><span class="line">        routes: [</span><br><span class="line">            &#123; </span><br><span class="line">                path: <span class="string">'/'</span>, </span><br><span class="line">                component: <span class="string">'../pages/index'</span> </span><br><span class="line">            &#125;,</span><br><span class="line">            &#123; </span><br><span class="line">                path: <span class="string">'/user'</span>, </span><br><span class="line">                component: <span class="string">'../pages/user/index'</span> </span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line"><span class="comment">//3.pages/user/index.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> styles <span class="keyword">from</span> <span class="string">'./index.less'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; queryUserList &#125; <span class="keyword">from</span> <span class="string">'./services'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="comment">//componentDidMount</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    getUsers();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//发送请求获取数据</span></span><br><span class="line">  <span class="keyword">const</span> getUsers = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> result = <span class="keyword">await</span> queryUserList(&#123; <span class="attr">page</span>: <span class="number">1</span> &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1 className=&#123;styles.title&#125;&gt;Page user/index&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-5-编写dva-model"><a href="#3-4-5-编写dva-model" class="headerlink" title="3.4.5 编写dva model"></a>3.4.5 编写dva model</h3><p>dva 通过 <code>model</code> 的概念把一个领域的模型管理起来，包含同步更新 state 的 reducers，处理异步逻辑的 effects，订阅数据源的 subscriptions 。</p>
<p>好处在于可以统一管理模型数据和把模型数据共享到组件中。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// user/models/index.ts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Effect 异步操作     Reducer  纯函数      Subscription 订阅更新</span></span><br><span class="line"><span class="keyword">import</span> &#123; Effect, Reducer, Subscription, Action &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line"><span class="comment">//查询用户的接口</span></span><br><span class="line"><span class="keyword">import</span> &#123; queryUserList &#125; <span class="keyword">from</span> <span class="string">'../services'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface UserItem &#123;</span><br><span class="line">  id: number;</span><br><span class="line">  name: string;</span><br><span class="line">  email: string;</span><br><span class="line">  website: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明用户模块state的数据类型  ?表示可有可无</span></span><br><span class="line"><span class="keyword">export</span> interface UserModelState &#123;</span><br><span class="line">  list?: UserItem[];</span><br><span class="line">  total?: number;</span><br><span class="line">  page?: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明用户model的数据类型</span></span><br><span class="line"><span class="keyword">export</span> interface UserModelType &#123;</span><br><span class="line">  <span class="comment">//名称空间</span></span><br><span class="line">  namespace: <span class="string">'user'</span>;</span><br><span class="line">  <span class="comment">//state数据</span></span><br><span class="line">  state: UserModelState;</span><br><span class="line">  <span class="comment">//异步方法</span></span><br><span class="line">  effects: &#123;</span><br><span class="line">    fetchUserList: Effect;</span><br><span class="line">    removeUserById?: Effect;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//纯函数</span></span><br><span class="line">  reducers: &#123;</span><br><span class="line">    save: Reducer&lt;UserModelState&gt;;</span><br><span class="line">    removeById?: Reducer&lt;UserModelState&gt;;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//订阅更新</span></span><br><span class="line">  subscriptions?: &#123; <span class="attr">setup</span>: Subscription &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明UserModel</span></span><br><span class="line"><span class="keyword">const</span> UserModel: UserModelType = &#123;</span><br><span class="line">  namespace: <span class="string">'user'</span>,</span><br><span class="line">  state: &#123;</span><br><span class="line">    list: [], <span class="comment">//所有用户信息的数组</span></span><br><span class="line">    total: <span class="number">0</span>, <span class="comment">//总用户个数</span></span><br><span class="line">    page: <span class="number">0</span>, <span class="comment">//当前页码</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//纯函数  操作state</span></span><br><span class="line">  reducers: &#123;</span><br><span class="line">    save(state, &#123; payload &#125;) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; list, total, page &#125; = payload;</span><br><span class="line">      <span class="comment">// 复制数组，将list, total, page内容放到到state</span></span><br><span class="line">      <span class="keyword">return</span> &#123; ...state, list, total, page &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//用于处理异步操作和业务逻辑，不直接修改 state，简单的来说，就是获取从服务端获取数据，并且发起一个 action 交给 reducer。其中它用到了redux-saga，里面有几个常用的函数</span></span><br><span class="line">  effects: &#123;</span><br><span class="line">    <span class="comment">// * 表示生成器函数，该函数会返回一个迭代器</span></span><br><span class="line">    <span class="comment">// 参数 payload 表示有效负载的数据，在外部通过dispatch传递</span></span><br><span class="line">    <span class="comment">// put:  用于触发action  yield put(&#123; type: 'todos/add', payload: 'Learn Dva'&#125;);</span></span><br><span class="line">    <span class="comment">// call:用于调用异步逻辑，支持Promise，第一个参数是你要调用的函数，第二个参数开始是你要传递的参。const result = yield call(fetch, '/todos');</span></span><br><span class="line">    <span class="comment">// select:用于从state里获取数据。const todos = yield select(state =&gt; state.todos);</span></span><br><span class="line">    *fetchUserList(&#123; <span class="attr">payload</span>: &#123; page = <span class="number">1</span> &#125; &#125;, &#123; call, put &#125;) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; list, total &#125; = <span class="keyword">yield</span> call(queryUserList, &#123; page &#125;);</span><br><span class="line">      <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        type: <span class="string">'save'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">          list: list,</span><br><span class="line">          total: <span class="built_in">parseInt</span>(total, <span class="number">10</span>),</span><br><span class="line">          page: <span class="built_in">parseInt</span>(page, <span class="number">10</span>),</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> UserModel;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-6-编写页面"><a href="#3-4-6-编写页面" class="headerlink" title="3.4.6 编写页面"></a>3.4.6 编写页面</h3><p>到这里，我们已经单独完成了 model 和 页面，那么他们如何串联起来呢?</p>
<p>dva 提供了 <code>connect</code> 方法。如果你熟悉 redux，这个 connect 来自 react-redux。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pages/user/index.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ConnectProps connect高阶函数的属性类型</span></span><br><span class="line"><span class="comment">//Loading 数据加载状态类型</span></span><br><span class="line"><span class="comment">//connect 高阶函数，主要作用将model和当前组件连接起来</span></span><br><span class="line"><span class="keyword">import</span> &#123; ConnectProps, Loading, connect &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line"><span class="comment">//users这个namespace的数据类型</span></span><br><span class="line"><span class="keyword">import</span> &#123; UserModelState &#125; <span class="keyword">from</span> <span class="string">'./models'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明当前页面的属性类型</span></span><br><span class="line"><span class="keyword">interface</span> PageProps <span class="keyword">extends</span> ConnectProps &#123;</span><br><span class="line">  user: UserModelState;</span><br><span class="line">  loading: <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//当前组件对象</span></span><br><span class="line"><span class="comment">//参数users表示模型层数据</span></span><br><span class="line"><span class="comment">//参数dispatch表示redux派发器</span></span><br><span class="line"><span class="comment">//参数loading表示数据加载状态</span></span><br><span class="line"><span class="keyword">const</span> UserPage: FC&lt;PageProps&gt; = <span class="function">(<span class="params">&#123; user, dispatch, loading &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; list,total &#125; = user;</span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//dispatch一个action来触发对应的reducer</span></span><br><span class="line">    dispatch &amp;&amp;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        <span class="keyword">type</span>: <span class="string">'user/fetchUserList'</span>,</span><br><span class="line">        <span class="comment">//payload 有效负载 ，dispatch传递参数的时候</span></span><br><span class="line">        payload: &#123;</span><br><span class="line">          page: <span class="number">1</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;, []);</span><br><span class="line">  <span class="keyword">return</span> &lt;div&gt;Hello &#123;<span class="built_in">JSON</span>.stringify(list)&#125;&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/connect 作用：将model和当前组件连接起来</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/参数 users 表示users这个namespace中的数据</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/参数 loading 表示users namespace中的数据是否加载完毕</span></span><br><span class="line"><span class="regexp">export default connect((&#123; user, loading &#125;: &#123; user: UserModelState; loading: Loading &#125;) =&gt; (&#123;</span></span><br><span class="line"><span class="regexp">  user,</span></span><br><span class="line"><span class="regexp">  loading: loading.models.user, /</span><span class="regexp">/表示users这个namespace的数据是否已经加载完毕</span></span><br><span class="line"><span class="regexp">&#125;))(UserPage);</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-7-使用订阅更新设置dva数据"><a href="#3-4-7-使用订阅更新设置dva数据" class="headerlink" title="3.4.7 使用订阅更新设置dva数据"></a>3.4.7 使用订阅更新设置dva数据</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pages/user/models/index.ts</span></span><br><span class="line"></span><br><span class="line">.........</span><br><span class="line"><span class="comment">//订阅更新</span></span><br><span class="line">subscriptions: &#123;</span><br><span class="line">    setup(&#123; dispatch, history &#125;) &#123;</span><br><span class="line">        <span class="comment">//监听url的变化，当访问路径是/user的时候触发fetchUserList这个effects</span></span><br><span class="line">        <span class="keyword">return</span> history.listen(<span class="function">(<span class="params">&#123; pathname &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (pathname === <span class="string">'/user'</span>) &#123;</span><br><span class="line">                dispatch(&#123;</span><br><span class="line">                    type: <span class="string">'fetchUserList'</span>,</span><br><span class="line">                    payload: &#123;</span><br><span class="line">                        page: <span class="number">1</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//注释掉pages/user/index.tsx    发送请求的代码</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-8-使用ant-design编写页面"><a href="#3-4-8-使用ant-design编写页面" class="headerlink" title="3.4.8 使用ant design编写页面"></a>3.4.8 使用ant design编写页面</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC,useEffect,useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Table, Pagination, Popconfirm, Button &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ConnectProps, Loading, connect &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; UserModelState,UserItem &#125; <span class="keyword">from</span> <span class="string">'./models'</span>;</span><br><span class="line"></span><br><span class="line">interface PageProps extends ConnectProps &#123;</span><br><span class="line">  user: UserModelState;</span><br><span class="line">  loading: boolean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> UserPage: FC&lt;PageProps&gt; = <span class="function">(<span class="params">&#123; user, dispatch, loading &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; list, total, page &#125; = user;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">onChangeUserPagination</span>(<span class="params">page: number</span>) </span>&#123;</span><br><span class="line">    dispatch &amp;&amp;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: <span class="string">'user/fetchUserList'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">          page: page,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//dispatch一个action来触发对应的reducer</span></span><br><span class="line">    dispatch &amp;&amp;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: <span class="string">'user/fetchUserList'</span>,</span><br><span class="line">        <span class="comment">//payload 有效负载 ，dispatch传递参数的时候</span></span><br><span class="line">        payload: &#123;</span><br><span class="line">          page: <span class="number">1</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> toggle = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    setPopShow(<span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> columns = [</span><br><span class="line">    &#123;</span><br><span class="line">      title: <span class="string">'用户名'</span>,</span><br><span class="line">      dataIndex: <span class="string">'name'</span>,</span><br><span class="line">      key: <span class="string">'name'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: <span class="string">'电子邮件'</span>,</span><br><span class="line">      dataIndex: <span class="string">'email'</span>,</span><br><span class="line">      key: <span class="string">'email'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: <span class="string">'个人网站'</span>,</span><br><span class="line">      dataIndex: <span class="string">'website'</span>,</span><br><span class="line">      key: <span class="string">'website'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: <span class="string">'操作'</span>,</span><br><span class="line">      key: <span class="string">'operation'</span>,</span><br><span class="line">      render: <span class="function">(<span class="params">item: UserItem</span>) =&gt;</span> (</span><br><span class="line">        &lt;span&gt;</span><br><span class="line">          &lt;Button&gt;编辑&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Popconfirm visible=&#123;popShow&#125; title="Confirm to delete?"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Button&gt;删除&lt;/</span>Button&gt;</span><br><span class="line">          &lt;<span class="regexp">/Popconfirm&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>span&gt;</span><br><span class="line">      ),</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Table</span><br><span class="line">          loading=&#123;loading&#125;  <span class="comment">//表格的加载状态</span></span><br><span class="line">          columns=&#123;columns&#125;  <span class="comment">//表格列信息</span></span><br><span class="line">          dataSource=&#123;list&#125;  <span class="comment">//表格数据源</span></span><br><span class="line">          rowKey=&#123;(record:UserItem) =&gt; record.id&#125;  <span class="comment">//表格每一行数据的key</span></span><br><span class="line">          pagination=&#123;<span class="literal">false</span>&#125;   <span class="comment">//不显示表格默认的分页器</span></span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;Pagination</span><br><span class="line">          className=<span class="string">"ant-table-pagination"</span></span><br><span class="line">          total=&#123;total&#125; <span class="comment">// 数据总数</span></span><br><span class="line">          current=&#123;page&#125; <span class="comment">// 当前页数</span></span><br><span class="line">          onChange=&#123;onChangeUserPagination&#125;  <span class="comment">//改变页码的点击事件</span></span><br><span class="line">          pageSize=&#123;<span class="number">10</span>&#125;   <span class="comment">//每一页的数量</span></span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(<span class="function">(<span class="params">&#123; user, loading &#125;: &#123; user: UserModelState; loading: Loading &#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">  user,</span><br><span class="line">  loading: loading.models.user,</span><br><span class="line">&#125;))(UserPage);</span><br></pre></td></tr></table></figure>

<h3 id="3-4-9-完成删除功能"><a href="#3-4-9-完成删除功能" class="headerlink" title="3.4.9 完成删除功能"></a>3.4.9 完成删除功能</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pages/user/services/index.tsx 新增请求</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteUserById</span>(<span class="params">id: <span class="built_in">number</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> request(<span class="string">`/api/users/delete/<span class="subst">$&#123;id&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//pages/user/models/index.tsx reducer和effect</span></span><br><span class="line"><span class="keyword">import</span> &#123; queryUserList, deleteUserById &#125; <span class="keyword">from</span> <span class="string">'../services'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//reducer中新增下面方法</span></span><br><span class="line"><span class="comment">//state的list可能是undefined，造成类型不匹配，所以这里要 state = &#123;list:[]&#125; 给list一个默认值</span></span><br><span class="line">removeById(state, &#123; payload &#125;) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; id &#125; = payload;</span><br><span class="line">    <span class="keyword">var</span> filterList =</span><br><span class="line">        state &amp;&amp;</span><br><span class="line">        state.list &amp;&amp;</span><br><span class="line">        state.list.filter(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (item.id !== id) &#123;</span><br><span class="line">                <span class="keyword">return</span> item;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="keyword">return</span> &#123; ...state, ...&#123; list: filterList &#125; &#125;;</span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line"><span class="comment">//action中新增下面方法</span></span><br><span class="line"><span class="comment">//根据id删除指定用户  发送请求</span></span><br><span class="line">*removeUserById(&#123; payload: &#123; id &#125; &#125;, &#123; call, put &#125;) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">yield</span> call(deleteUserById, id);</span><br><span class="line">    <span class="keyword">yield</span> put(&#123;</span><br><span class="line">        <span class="keyword">type</span>: <span class="string">'removeById'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">            id: id,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"># 页面新增删除事件</span><br><span class="line">&lt;Popconfirm visible=&#123;popShow&#125; title=<span class="string">"Confirm to delete?"</span> onConfirm=&#123;<span class="function"><span class="params">()</span>=&gt;</span>deleteHandler(item.id)&#125;&gt;</span><br><span class="line">       &lt;Button onClick=&#123;<span class="function"><span class="params">()</span>=&gt;</span>&#123;toggle()&#125;&#125;&gt;删除&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Popconfirm&gt;</span><br><span class="line">                 </span><br><span class="line"><span class="comment">//控制pop弹框是否显示</span></span><br><span class="line"><span class="keyword">const</span> [popShow,setPopShow] = useState(<span class="literal">false</span>)</span><br><span class="line">   </span><br><span class="line"><span class="comment">//这边点击删除按钮后一定要将pop关闭，否则会报内存泄漏</span></span><br><span class="line"><span class="keyword">const</span> deleteHandler = <span class="function">(<span class="params">id:<span class="built_in">number</span></span>)=&gt;</span>&#123;   </span><br><span class="line">    setPopShow(<span class="literal">false</span>)</span><br><span class="line">    dispatch &amp;&amp;</span><br><span class="line">        dispatch(&#123;</span><br><span class="line">        <span class="keyword">type</span>: <span class="string">'user/removeUserById'</span>,</span><br><span class="line">        payload: &#123;</span><br><span class="line">            id,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> toggle = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    setPopShow(<span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Wang su</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://ehbhgh.github.io/2019/12/23/umi&amp;dva/">https://ehbhgh.github.io/2019/12/23/umi&amp;dva/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/07/23/Dj7mVOJLucTNYet.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/03/23/ant-design-pro/"><img class="prev-cover" data-src="https://i.loli.net/2020/07/23/XARfSvl9oB6MKYm.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Ant Design Pro V5</div></div></a></div><div class="next-post pull-right"><a href="/2019/11/29/%E5%88%9D%E5%A7%8Buniapp/"><img class="next-cover" data-src="https://i.loli.net/2020/07/23/XARfSvl9oB6MKYm.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Uniapp实现多端开发(ts)</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 <i style="color:#FF6A6A;animation: announ_animation 0.8s linear infinite;" class="fa fa-heartbeat"></i> Wang su</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">彼岸花开一千年,花开花落不相见。 若问花开叶落故,彼岸缘起缘又灭。</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="Increase Font Size"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="Decrease Font Size"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script><script src="https://cdn.jsdelivr.net/gh/lete114/CDN/Sum/sakura.js"></script><script id="xplayer" src="https://music.m0x.cn/Static/player/player.js" key="5f185cdca3357" ></script><script src="https://cdn.jsdelivr.net/gh/lete114/CDN/js/upjiang.js"></script></body></html>
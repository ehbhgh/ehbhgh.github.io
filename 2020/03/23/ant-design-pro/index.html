<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Ant Design Pro V5 | So Love</title><meta name="description" content="1.Ant Design Pro介绍Ant Design Pro 是一个企业级中后台前端&#x2F;设计解决方案  特性   优雅美观：基于 Ant Design 体系精心设计 常见设计模式：提炼自中后台应用的典型页面和场景 最新技术栈：使用 React&#x2F;dva&#x2F;antd 等前端前沿技术开发 响应式：针对不同屏幕大小设计 主题：可配置的主题满足多样化的品牌诉求 国际化：内建业界通用的国际化方案 最佳实践：良"><meta name="author" content="Wang su"><meta name="copyright" content="Wang su"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://ehbhgh.github.io/2020/03/23/ant-design-pro/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Ant Design Pro V5"><meta property="og:url" content="https://ehbhgh.github.io/2020/03/23/ant-design-pro/"><meta property="og:site_name" content="So Love"><meta property="og:description" content="1.Ant Design Pro介绍Ant Design Pro 是一个企业级中后台前端&#x2F;设计解决方案  特性   优雅美观：基于 Ant Design 体系精心设计 常见设计模式：提炼自中后台应用的典型页面和场景 最新技术栈：使用 React&#x2F;dva&#x2F;antd 等前端前沿技术开发 响应式：针对不同屏幕大小设计 主题：可配置的主题满足多样化的品牌诉求 国际化：内建业界通用的国际化方案 最佳实践：良"><meta property="og:image" content="https://i.loli.net/2020/07/23/XARfSvl9oB6MKYm.jpg"><meta property="article:published_time" content="2020-03-23T12:25:13.000Z"><meta property="article:modified_time" content="2020-11-04T13:01:00.245Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="浅谈TypeScript" href="https://ehbhgh.github.io/2020/06/23/typescript/"><link rel="next" title="Umi&amp;dva" href="https://ehbhgh.github.io/2019/12/23/umi&amp;dva/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-11-04 21:01:00'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">12</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 关键字</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa-fw fa fa-book"></i><span> 找文章</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-link"></i><span> 链接</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/link/"><i class="fa-fw fa fa-users"></i><span> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Ant-Design-Pro介绍"><span class="toc-number">1.</span> <span class="toc-text">1.Ant Design Pro介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-目录结构和配置介绍"><span class="toc-number">2.</span> <span class="toc-text">2.目录结构和配置介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-目录结构"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-配置文件"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-1-config-ts"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 config.ts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-defaultSettings-ts"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2 defaultSettings.ts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-3-proxy-ts"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.2.3 proxy.ts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-4-app-tsx"><span class="toc-number">2.2.4.</span> <span class="toc-text">2.2.4 app.tsx</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-配置详解"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 配置详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-路由和菜单"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.3.1 路由和菜单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-权限"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.3.2 权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-3-布局"><span class="toc-number">2.3.3.</span> <span class="toc-text">2.3.3 布局</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-4-InitialState"><span class="toc-number">2.3.4.</span> <span class="toc-text">2.3.4 InitialState</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-5-国际化"><span class="toc-number">2.3.5.</span> <span class="toc-text">2.3.5 国际化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-知识点介绍"><span class="toc-number">3.</span> <span class="toc-text">3.知识点介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-封装组件介绍"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 封装组件介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-procomponents"><span class="toc-number">3.2.</span> <span class="toc-text">3.2  procomponents</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-高级布局ProLayout"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 高级布局ProLayout</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-BasicLayout-amp-amp-BasicLayoutProps"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">a) BasicLayout&amp;&amp;BasicLayoutProps</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-PageContainer"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">b) PageContainer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-DefaultFooter"><span class="toc-number">3.2.1.3.</span> <span class="toc-text">c) DefaultFooter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d-PageLoading"><span class="toc-number">3.2.1.4.</span> <span class="toc-text">d) PageLoading</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#e-FooterToolbar"><span class="toc-number">3.2.1.5.</span> <span class="toc-text">e) FooterToolbar</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-高级表格ProTable"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2  高级表格ProTable</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-ProColumns"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">a) ProColumns</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-ProTable-amp-ActionType"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">b) ProTable&amp;ActionType</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-高级描述ProDescriptions"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3 高级描述ProDescriptions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-登录页面及流程"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 登录页面及流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-登录页面及子组件"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1 登录页面及子组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-登录流程"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2 登录流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-列表页流程"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 列表页流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-列表页面及子组件"><span class="toc-number">3.4.1.</span> <span class="toc-text">3.4.1 列表页面及子组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-列表流程"><span class="toc-number">3.4.2.</span> <span class="toc-text">3.4.2 列表流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-列表页面展示、查询、分页"><span class="toc-number">3.4.2.1.</span> <span class="toc-text">a) 列表页面展示、查询、分页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-规则新增"><span class="toc-number">3.4.2.2.</span> <span class="toc-text">b) 规则新增</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-规则更新"><span class="toc-number">3.4.2.3.</span> <span class="toc-text">c) 规则更新</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d-规则选中"><span class="toc-number">3.4.2.4.</span> <span class="toc-text">d) 规则选中</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#e-查看规则名称"><span class="toc-number">3.4.2.5.</span> <span class="toc-text">e) 查看规则名称</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-ant-design-pro区块"><span class="toc-number">4.</span> <span class="toc-text">4. ant design pro区块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-vue-antd-admin"><span class="toc-number">5.</span> <span class="toc-text">5.vue-antd-admin</span></a></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><header class="post-bg" id="page-header" style="background-image: url(https://i.loli.net/2020/07/23/XARfSvl9oB6MKYm.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">So Love</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 关键字</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa-fw fa fa-book"></i><span> 找文章</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-link"></i><span> 链接</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/link/"><i class="fa-fw fa fa-users"></i><span> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Ant Design Pro V5</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2020-03-23 20:25:13"><i class="far fa-calendar-alt fa-fw"></i> Created 2020-03-23</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2020-11-04 21:01:00"><i class="fas fa-history fa-fw"></i> Updated 2020-11-04</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="1-Ant-Design-Pro介绍"><a href="#1-Ant-Design-Pro介绍" class="headerlink" title="1.Ant Design Pro介绍"></a>1.Ant Design Pro介绍</h1><p>Ant Design Pro 是一个企业级中后台前端/设计解决方案</p>
<blockquote>
<p>特性</p>
</blockquote>
<ul>
<li><strong>优雅美观</strong>：基于 Ant Design 体系精心设计</li>
<li><strong>常见设计模式</strong>：提炼自中后台应用的典型页面和场景</li>
<li><strong>最新技术栈</strong>：使用 React/dva/antd 等前端前沿技术开发</li>
<li><strong>响应式</strong>：针对不同屏幕大小设计</li>
<li><strong>主题</strong>：可配置的主题满足多样化的品牌诉求</li>
<li><strong>国际化</strong>：内建业界通用的国际化方案</li>
<li><strong>最佳实践</strong>：良好的工程实践助您持续产出高质量代码</li>
<li><strong>Mock 数据</strong>：实用的本地数据调试方案</li>
<li><strong>UI 测试</strong>：自动化测试保障前端产品质量</li>
</ul>
<p><img src= "/img/loading.gif" data-src="D:%5C%E5%89%8D%E7%AB%AF%E5%A4%87%E8%AF%BE%5C17.REACT%5Creadme%5Cassets%5C1600843149045.png" alt="1600843149045"></p>
<p>创建项目：</p>
<p>yarn create umi myprotest</p>
<p>yarn install</p>
<p>yarn start</p>
<p>注意：这里创建项目的时候选择V5版本</p>
<p>​        Pro V4+antd@4 版本权限验证不好用。<strong>Pro V4+antd@4 可以查看完整版的ant design pro项目</strong>。</p>
<p>​        Pro V4+antd@3 版本有区块不好用</p>
<h1 id="2-目录结构和配置介绍"><a href="#2-目录结构和配置介绍" class="headerlink" title="2.目录结构和配置介绍"></a>2.目录结构和配置介绍</h1><h2 id="2-1-目录结构"><a href="#2-1-目录结构" class="headerlink" title="2.1 目录结构"></a>2.1 目录结构</h2><p><img src= "/img/loading.gif" data-src="D:%5C%E5%89%8D%E7%AB%AF%E5%A4%87%E8%AF%BE%5C17.REACT%5Creadme%5Cassets%5C1601258826340.png" alt="1601258826340"></p>
<h2 id="2-2-配置文件"><a href="#2-2-配置文件" class="headerlink" title="2.2 配置文件"></a>2.2 配置文件</h2><h3 id="2-2-1-config-ts"><a href="#2-2-1-config-ts" class="headerlink" title="2.2.1 config.ts"></a>2.2.1 config.ts</h3><p>该文件类似.umirc.ts文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入umi中的配置文件的类型 ts中要用</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line"><span class="comment">//引入默认的配置文件</span></span><br><span class="line"><span class="keyword">import</span> defaultSettings <span class="keyword">from</span> <span class="string">'./defaultSettings'</span>;</span><br><span class="line"><span class="comment">//代理配置文件</span></span><br><span class="line"><span class="keyword">import</span> proxy <span class="keyword">from</span> <span class="string">'./proxy'</span>;</span><br><span class="line"><span class="keyword">let</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="comment">//当前开发环境\发布环境</span></span><br><span class="line"><span class="keyword">const</span> &#123; REACT_APP_ENV &#125; = process.env;</span><br><span class="line"></span><br><span class="line"><span class="comment">//导出配置对象</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  <span class="comment">//文件名支持hash命名</span></span><br><span class="line">  hash: <span class="literal">true</span>,  </span><br><span class="line">  <span class="comment">//启用dva插件</span></span><br><span class="line">  <span class="comment">//每个插件都会对应一个 id 和一个 key，id 是路径的简写，key 是进一步简化后用于配置的唯一值。</span></span><br><span class="line">  <span class="comment">//比如插件 /node_modules/@umijs/plugin-antd ,id 为 @umijs/plugin-antd，key 为 antd。</span></span><br><span class="line">  antd: &#123;&#125;,</span><br><span class="line">  <span class="comment">//启用dva插件</span></span><br><span class="line">  dva: &#123;</span><br><span class="line">    hmr: <span class="literal">true</span>,  <span class="comment">//热更新</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//启用layout布局插件  ant design pro中需要使用</span></span><br><span class="line">  layout: &#123;</span><br><span class="line">    name: <span class="string">'Ant Design Pro'</span>,</span><br><span class="line">    locale: <span class="literal">true</span>,     <span class="comment">//国际化</span></span><br><span class="line">    siderWidth: <span class="number">208</span>,  <span class="comment">//侧边栏宽度</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//启用locale国际化插件 配置之后才可以使用useIntl </span></span><br><span class="line">  locale: &#123;</span><br><span class="line">    <span class="comment">//默认的语言环境</span></span><br><span class="line">    <span class="keyword">default</span>: <span class="string">'zh-CN'</span>,</span><br><span class="line">    <span class="comment">//antd开启国际化</span></span><br><span class="line">    antd: <span class="literal">true</span>, </span><br><span class="line">    <span class="comment">// default true, when it is true, will use `navigator.language` overwrite default</span></span><br><span class="line">    baseNavigator: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//配置按需加载   即是否把构建产物进行拆分，在需要的时候下载额外的 JS 再执行。</span></span><br><span class="line">  dynamicImport: &#123;</span><br><span class="line">    loading: <span class="string">'@/components/PageLoading/index'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//兼容ie11</span></span><br><span class="line">  targets: &#123;</span><br><span class="line">    ie: <span class="number">11</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// umi routes: https://umijs.org/docs/routing</span></span><br><span class="line">  <span class="comment">//路由配置</span></span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/user'</span>,</span><br><span class="line">      <span class="comment">//不使用默认的页面布局模板，如果此属性不写就会使用默认页面布局模板(app.tsx中声明的layout)</span></span><br><span class="line">      layout: <span class="literal">false</span>,</span><br><span class="line">      <span class="comment">//子路由</span></span><br><span class="line">      routes: [</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">'login'</span>,</span><br><span class="line">          path: <span class="string">'/user/login'</span>,</span><br><span class="line">          component: <span class="string">'./user/login'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/welcome'</span>,</span><br><span class="line">      name: <span class="string">'welcome'</span>,</span><br><span class="line">      <span class="comment">// access: 'canUser',  //只有user登录可以访问  在access.ts中有声明</span></span><br><span class="line">      icon: <span class="string">'smile'</span>,      <span class="comment">//指定icon图标  可以使用ant design中的图标</span></span><br><span class="line">      component: <span class="string">'./Welcome'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/admin'</span>,</span><br><span class="line">      name: <span class="string">'admin'</span>,</span><br><span class="line">      icon: <span class="string">'crown'</span>,</span><br><span class="line">      access: <span class="string">'canAdmin'</span>,  <span class="comment">//只有admin登录可以访问  在access.ts中有声明</span></span><br><span class="line">      component: <span class="string">'./Admin'</span>,</span><br><span class="line">      routes: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">'/admin/sub-page'</span>,</span><br><span class="line">          name: <span class="string">'sub-page'</span>,</span><br><span class="line">          icon: <span class="string">'smile'</span>,</span><br><span class="line">          component: <span class="string">'./Welcome'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">'list.table-list'</span>,</span><br><span class="line">      icon: <span class="string">'table'</span>,</span><br><span class="line">      path: <span class="string">'/list'</span>,</span><br><span class="line">      component: <span class="string">'./ListTableList'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">'/'</span>,</span><br><span class="line">      redirect: <span class="string">'/welcome'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      component: <span class="string">'./404'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// Theme for antd: https://ant.design/docs/react/customize-theme-cn</span></span><br><span class="line">  theme: &#123;</span><br><span class="line">    <span class="comment">// ...darkTheme,</span></span><br><span class="line">    <span class="comment">// 主要颜色,</span></span><br><span class="line">    <span class="string">'primary-color'</span>: defaultSettings.primaryColor,</span><br><span class="line">    <span class="comment">//主题颜色配置</span></span><br><span class="line">    <span class="comment">// 'font-size-base': '14px',</span></span><br><span class="line">    <span class="comment">// 'badge-font-size': '12px',</span></span><br><span class="line">    <span class="comment">// 'btn-font-size-lg': '@font-size-base',</span></span><br><span class="line">    <span class="comment">// 'menu-dark-bg': '#00182E',</span></span><br><span class="line">    <span class="comment">// 'menu-dark-submenu-bg': '#000B14',</span></span><br><span class="line">    <span class="comment">// 'layout-sider-background': '#00182E',</span></span><br><span class="line">    <span class="comment">// 'layout-body-background': '#f0f2f5',</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// @ts-ignore</span></span><br><span class="line">  title: <span class="literal">false</span>,</span><br><span class="line">  ignoreMomentLocale: <span class="literal">true</span>,</span><br><span class="line">  <span class="comment">//代理</span></span><br><span class="line">  proxy: proxy[REACT_APP_ENV || <span class="string">'dev'</span>],</span><br><span class="line">  manifest: &#123;</span><br><span class="line">    basePath: <span class="string">'/'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//别名</span></span><br><span class="line">  alias: &#123;</span><br><span class="line">    <span class="string">'@'</span>: path.resolve(__dirname, <span class="string">'src'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-2-defaultSettings-ts"><a href="#2-2-2-defaultSettings-ts" class="headerlink" title="2.2.2 defaultSettings.ts"></a>2.2.2 defaultSettings.ts</h3><p>页面样式的配置文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Settings <span class="keyword">as</span> LayoutSettings &#125; <span class="keyword">from</span> <span class="string">'@ant-design/pro-layout'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  navTheme: <span class="string">'dark'</span>,         <span class="comment">//主题颜色   dark light</span></span><br><span class="line">  primaryColor: <span class="string">'#1890ff'</span>,   <span class="comment">//主要颜色</span></span><br><span class="line">  layout: <span class="string">'mix'</span>,             <span class="comment">//布局方式  slide</span></span><br><span class="line">  contentWidth: <span class="string">'Fluid'</span>,     <span class="comment">//内容宽度</span></span><br><span class="line">  fixedHeader: <span class="literal">false</span>,        <span class="comment">//固定头</span></span><br><span class="line">  fixSiderbar: <span class="literal">true</span>,         <span class="comment">//固定左侧内容</span></span><br><span class="line">  colorWeak: <span class="literal">false</span>,          <span class="comment">//弱视</span></span><br><span class="line">  menu: &#123;</span><br><span class="line">    locale: <span class="literal">true</span>,            <span class="comment">//菜单国际化</span></span><br><span class="line">  &#125;,</span><br><span class="line">  title: <span class="string">'Ant Design Pro'</span>,   <span class="comment">//标题</span></span><br><span class="line">  pwa: <span class="literal">false</span>,</span><br><span class="line">  iconfontUrl: <span class="string">''</span>,           <span class="comment">//icon图标地址</span></span><br><span class="line">&#125; <span class="keyword">as</span> LayoutSettings &amp; &#123;</span><br><span class="line">  pwa: boolean;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-3-proxy-ts"><a href="#2-2-3-proxy-ts" class="headerlink" title="2.2.3 proxy.ts"></a>2.2.3 proxy.ts</h3><p>该文件主要是代理的配置文件，仅在开发环境有效</p>
<h3 id="2-2-4-app-tsx"><a href="#2-2-4-app-tsx" class="headerlink" title="2.2.4 app.tsx"></a>2.2.4 app.tsx</h3><p>app.tsx为运行时配置文件，导出的信息会使用对应的插件在运行时配置到程序中</p>
<h2 id="2-3-配置详解"><a href="#2-3-配置详解" class="headerlink" title="2.3 配置详解"></a>2.3 配置详解</h2><h3 id="2-3-1-路由和菜单"><a href="#2-3-1-路由和菜单" class="headerlink" title="2.3.1 路由和菜单"></a>2.3.1 路由和菜单</h3><p>ant design pro会根据配置的路由自动生成对应的菜单</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// umi routes: https://umijs.org/docs/routing</span></span><br><span class="line"><span class="comment">// hideChildrenInMenu 用于隐藏不需要在菜单中展示的子路由。用法可以查看 分步表单 的配置。</span></span><br><span class="line"><span class="comment">// hideInMenu 可以在菜单中不展示这个路由，包括子路由。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//路由配置</span></span><br><span class="line">routes: [</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">'/user'</span>,</span><br><span class="line">        <span class="comment">//不使用默认的页面布局模板，如果此属性不写就会使用默认页面布局模板(app.tsx中声明的layout)</span></span><br><span class="line">        layout: <span class="literal">false</span>,</span><br><span class="line">        <span class="comment">//子路由</span></span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                name: <span class="string">'login'</span>,</span><br><span class="line">                path: <span class="string">'/user/login'</span>,</span><br><span class="line">                component: <span class="string">'./user/login'</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">'/welcome'</span>,</span><br><span class="line">        name: <span class="string">'welcome'</span>,</span><br><span class="line">        <span class="comment">// access: 'canUser',  //只有user登录可以访问  在access.ts中有声明</span></span><br><span class="line">        icon: <span class="string">'smile'</span>,      <span class="comment">//指定icon图标  可以使用ant design中的图标</span></span><br><span class="line">        component: <span class="string">'./Welcome'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">'/admin'</span>,</span><br><span class="line">        name: <span class="string">'admin'</span>,</span><br><span class="line">        icon: <span class="string">'crown'</span>,</span><br><span class="line">        access: <span class="string">'canAdmin'</span>,  <span class="comment">//只有admin登录可以访问  在access.ts中有声明</span></span><br><span class="line">        component: <span class="string">'./Admin'</span>,</span><br><span class="line">        routes: [</span><br><span class="line">            &#123;</span><br><span class="line">                path: <span class="string">'/admin/sub-page'</span>,</span><br><span class="line">                name: <span class="string">'sub-page'</span>,</span><br><span class="line">                icon: <span class="string">'smile'</span>,</span><br><span class="line">                component: <span class="string">'./Welcome'</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        name: <span class="string">'list.table-list'</span>,</span><br><span class="line">        icon: <span class="string">'table'</span>,</span><br><span class="line">        path: <span class="string">'/list'</span>,</span><br><span class="line">        component: <span class="string">'./ListTableList'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        path: <span class="string">'/'</span>,</span><br><span class="line">        redirect: <span class="string">'/welcome'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        component: <span class="string">'./404'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-权限"><a href="#2-3-2-权限" class="headerlink" title="2.3.2 权限"></a>2.3.2 权限</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>当要设定某些菜单只有部分用户可见的时候，可以在菜单配置中写 access: <span class="string">'canAdmin'</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>canAdmin的信息在src/access.ts中声明，该文件中导出的access函数会用插件<span class="meta">@umijs</span>/plugin-access进行运行时配置，函数返回的结果要是下面类型</span><br><span class="line"> *  返回结果:</span><br><span class="line"> *  &#123;</span><br><span class="line"> *     canAdmin:<span class="literal">true</span>,</span><br><span class="line"> *     canUser:<span class="literal">false</span></span><br><span class="line"> *  &#125;</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>useAccess：可以在页面根据不同的登录用户显示不同的信息</span><br><span class="line">   <span class="keyword">import</span> &#123; useAccess, Access &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line">   <span class="keyword">const</span> access = useAccess();      <span class="comment">//此处为当前返回的结果数据</span></span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span> (access.canReadFoo) &#123;</span><br><span class="line">    <span class="comment">// 如果可以读取 Foo，则...</span></span><br><span class="line">   &#125; </span><br><span class="line">   &lt;Access</span><br><span class="line">     accessible=&#123;access.canReadFoo&#125;</span><br><span class="line">     fallback=&#123;&lt;div&gt;Can not read foo content.&lt;<span class="regexp">/div&gt;&#125;</span></span><br><span class="line"><span class="regexp">          &gt;</span></span><br><span class="line"><span class="regexp">          Foo content.</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Access&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-3-布局"><a href="#2-3-3-布局" class="headerlink" title="2.3.3 布局"></a>2.3.3 布局</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">当某个路由不需要布局文件的时候，只需要在config.ts的路由配置中设定layout: <span class="literal">false</span>即可，如果没有写这个，则会使用默认的布局文件</span><br><span class="line"></span><br><span class="line">默认的布局文件在app.tsx中layout中声明，会使用@umijs/plugin-layout进行运行时配置</span><br></pre></td></tr></table></figure>

<h3 id="2-3-4-InitialState"><a href="#2-3-4-InitialState" class="headerlink" title="2.3.4 InitialState"></a>2.3.4 InitialState</h3><p>在app.tsx中导出getInitialState方法，会使用@umijs/plugin-initial-state插件进行运行时配置，该方法会在整个应用最开始执行，返回值会作为全局共享的数据。(每次刷新页面的之后都会执行)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#1. app.tsx使用getInitialState提供全局共享数据</span><br><span class="line"><span class="comment">/**<span class="doctag">@umijs</span>/plugin-initial-state  会启用这个插件</span></span><br><span class="line"><span class="comment">* getInitialState会在整个应用最开始执行，返回值会作为全局共享的数据</span></span><br><span class="line"><span class="comment">* 其他组件中可以使用useModel来获取这份数据 (类似生产者消费者模式)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getInitialState</span>(<span class="params"></span>): <span class="title">Promise</span>&lt;</span>&#123;</span><br><span class="line">  currentUser?: API.CurrentUser;</span><br><span class="line">  settings?: LayoutSettings;</span><br><span class="line">&#125;&gt; &#123;</span><br><span class="line">  <span class="comment">// 如果是登录页面，不执行</span></span><br><span class="line">  <span class="keyword">if</span> (history.location.pathname !== <span class="string">'/user/login'</span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> currentUser = <span class="keyword">await</span> queryCurrent();</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        currentUser,</span><br><span class="line">        settings: defaultSettings,</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      history.push(<span class="string">'/user/login'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    settings: defaultSettings,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#2.在其他组件中可以通过useModel获取上面暴露的数据</span><br><span class="line"><span class="keyword">import</span> &#123; useModel &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line"><span class="comment">//initialState是getInitialState方法的返回值</span></span><br><span class="line"><span class="comment">//loading是数据加载状态</span></span><br><span class="line"><span class="comment">//refresh可以重新执行getInitialState方法</span></span><br><span class="line"><span class="keyword">const</span> &#123; initialState,loading,refresh &#125; = useModel(<span class="string">'@@initialState'</span>);</span><br></pre></td></tr></table></figure>

<h3 id="2-3-5-国际化"><a href="#2-3-5-国际化" class="headerlink" title="2.3.5 国际化"></a>2.3.5 国际化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#1.src/locales 是国际化的配置文件</span><br><span class="line"></span><br><span class="line">#2.SelectLang是语言选择组件</span><br><span class="line"><span class="keyword">import</span> &#123; SelectLang &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line"></span><br><span class="line">#3.useIntl国际化库</span><br><span class="line"><span class="keyword">import</span> &#123; useIntl,FormattedMessage &#125; <span class="keyword">from</span> <span class="string">'umi'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//useIntl().formatMessage  使用formatMessage这个api进行国际化</span></span><br><span class="line">useIntl().formatMessage(&#123;</span><br><span class="line">    id: <span class="string">'menu.home'</span>,</span><br><span class="line">    defaultMessage: <span class="string">'Home'</span>,</span><br><span class="line">&#125;),</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用FormattedMessage组件进行国际化</span></span><br><span class="line">&lt;button&gt;<span class="xml"><span class="tag">&lt;<span class="name">FormattedMessage</span> <span class="attr">id</span>=<span class="string">"menu.admin"</span> /&gt;</span></span>&lt;<span class="regexp">/button&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="3-知识点介绍"><a href="#3-知识点介绍" class="headerlink" title="3.知识点介绍"></a>3.知识点介绍</h1><h2 id="3-1-封装组件介绍"><a href="#3-1-封装组件介绍" class="headerlink" title="3.1 封装组件介绍"></a>3.1 封装组件介绍</h2><p>Footer 网页底部组件的封装</p>
<p>HeaderDropdown 鼠标移动的下拉组件的封装</p>
<p>PageLoading  页面加载组件的封装   需要在config.ts中配置</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//PageLoading  pro-layout封装的一个简单的加载页面</span></span><br><span class="line"><span class="keyword">import</span> &#123; PageLoading &#125; <span class="keyword">from</span> <span class="string">'@ant-design/pro-layout'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// loading components from code split</span></span><br><span class="line"><span class="comment">// https://umijs.org/plugin/umi-plugin-react.html#dynamicimport</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> PageLoading;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置按需加载   即是否把构建产物进行拆分，在需要的时候下载额外的 JS 再执行。</span></span><br><span class="line">dynamicImport: &#123;</span><br><span class="line">    loading: <span class="string">'@/components/PageLoading/index'</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>RightContent  登录后右上侧组件的封装(包含搜索、用户头像、语言选择等信息)</p>
<h2 id="3-2-procomponents"><a href="#3-2-procomponents" class="headerlink" title="3.2  procomponents"></a>3.2  procomponents</h2><p><a href="https://procomponents.ant.design/components/layout#api" target="_blank" rel="noopener">https://procomponents.ant.design/components/layout#api</a></p>
<h3 id="3-2-1-高级布局ProLayout"><a href="#3-2-1-高级布局ProLayout" class="headerlink" title="3.2.1 高级布局ProLayout"></a>3.2.1 高级布局ProLayout</h3><h4 id="a-BasicLayout-amp-amp-BasicLayoutProps"><a href="#a-BasicLayout-amp-amp-BasicLayoutProps" class="headerlink" title="a) BasicLayout&amp;&amp;BasicLayoutProps"></a>a) BasicLayout&amp;&amp;BasicLayoutProps</h4><p>BasicLayout 基础页面布局，包含了头部导航，侧边栏和通知栏等等。</p>
<p>ProLayout 与 umi 配合使用会有最好的效果，umi 会把 config.ts 中的路由帮我们自动注入到配置的 layout 中，这样我们就可以免去手写菜单的烦恼。</p>
<p>BasicLayoutProps基本页面布局的属性</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * app.tsx :  这边没有直接使用BasicLayout，而是写一个箭头函数返回BasicLayoutProps的实现，原因在于此处要根据initialState处理页面切换。</span></span><br><span class="line"><span class="comment"> * @umijs/plugin-layout</span></span><br><span class="line"><span class="comment"> * 默认登录后的页面布局模板 (此处权限验证的代码已经封装，看不到了，在老版本的项目中可以看到源代码)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> layout = (&#123;</span><br><span class="line">  initialState,</span><br><span class="line">&#125;: &#123;</span><br><span class="line">  initialState: &#123; settings?: LayoutSettings; currentUser?: API.CurrentUser &#125;;</span><br><span class="line">&#125;): <span class="function"><span class="params">BasicLayoutProps</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">//渲染顶部右侧内容</span></span><br><span class="line">    rightContentRender: <span class="function"><span class="params">()</span> =&gt;</span> &lt;RightContent /&gt;,</span><br><span class="line">    <span class="comment">//关闭 content的 margin</span></span><br><span class="line">    disableContentMargin: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">//渲染网页底部页面</span></span><br><span class="line">    footerRender: <span class="function"><span class="params">()</span> =&gt;</span> &lt;Footer /&gt;,</span><br><span class="line">    <span class="comment">//当切换页面的时候触发的事件</span></span><br><span class="line">    onPageChange: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 如果没有登录，重定向到 login</span></span><br><span class="line">      <span class="keyword">if</span> (!initialState?.currentUser?.userid &amp;&amp; history.location.pathname !== <span class="string">'/user/login'</span>) &#123;</span><br><span class="line">        history.push(<span class="string">'/user/login'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//渲染路径导航(代码为后来新增)</span></span><br><span class="line">    breadcrumbRender: <span class="function">(<span class="params">routers = []</span>) =&gt;</span> [</span><br><span class="line">      &#123;</span><br><span class="line">        path: <span class="string">'/'</span>,</span><br><span class="line">        breadcrumbName: useIntl().formatMessage(&#123;</span><br><span class="line">          id: <span class="string">'menu.home'</span>,</span><br><span class="line">          defaultMessage: <span class="string">'Home'</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">      &#125;,</span><br><span class="line">      ...routers,</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">//路径导航相关(代码为后来新增)</span></span><br><span class="line">    itemRender: <span class="function">(<span class="params">route, params, routes, paths</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> first = routes.indexOf(route) === <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> first ? (</span><br><span class="line">        &lt;Link to=&#123;paths.join(<span class="string">'/'</span>)&#125;&gt;&#123;route.breadcrumbName&#125;&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">      ) : (</span></span><br><span class="line"><span class="regexp">        &lt;span&gt;&#123;route.breadcrumbName&#125;&lt;/</span>span&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//渲染menu菜单头的方法(代码为后来新增)</span></span><br><span class="line">    menuHeaderRender: <span class="function"><span class="params">()</span> =&gt;</span> &lt;div&gt;测试菜单&lt;<span class="regexp">/div&gt;,</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/渲染菜单数据(此处可以修改返回的菜单数据从而实现渲染服务器返回的菜单信息)</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/menuData 为confit.ts中配置的菜单信息</span></span><br><span class="line"><span class="regexp">    menuDataRender: (menuData) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      return menuData;</span></span><br><span class="line"><span class="regexp">      /</span>*</span><br><span class="line">      <span class="keyword">return</span> [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">'/user'</span>,</span><br><span class="line">          layout: <span class="literal">false</span>,</span><br><span class="line">          <span class="comment">//子路由</span></span><br><span class="line">          routes: [</span><br><span class="line">            &#123;</span><br><span class="line">              name: <span class="string">'login'</span>,</span><br><span class="line">              path: <span class="string">'/user/login'</span>,</span><br><span class="line">              component: <span class="string">'./user/login'</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">'/welcome'</span>,</span><br><span class="line">          name: <span class="string">'welcome'</span>,</span><br><span class="line">          icon: &lt;QuestionCircleOutlined /&gt;,</span><br><span class="line">          component: <span class="string">'./Welcome'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ];</span><br><span class="line">      *<span class="regexp">/</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/传入配置参数</span></span><br><span class="line"><span class="regexp">    ...initialState?.settings,</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure>

<h4 id="b-PageContainer"><a href="#b-PageContainer" class="headerlink" title="b) PageContainer"></a>b) PageContainer</h4><p>正文内容组件，封装了 ant design 的 PageHeader 组件，增加了 tabList 和 content。 根据当前的路由填入 title 和 breadcrumb。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//content 指定页面内容</span></span><br><span class="line"><span class="comment">//title 指定页面标题</span></span><br><span class="line"><span class="comment">//pageHeaderRender 重新渲染页面头</span></span><br><span class="line"><span class="comment">//footer 网页尾部内容</span></span><br><span class="line"><span class="comment">//tabList 切换的tab列表</span></span><br><span class="line">&lt;PageContainer</span><br><span class="line">  content=<span class="string">" 这个页面只有 admin 权限才能查看"</span></span><br><span class="line">  title=<span class="string">"管理员页面头部信息"</span></span><br><span class="line">  pageHeaderRender=&#123;<span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;div&gt;测试&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">  &#125;&#125;</span></span><br><span class="line"><span class="regexp">  footer=&#123;[&lt;div&gt;页面尾巴&lt;/div&gt;]&#125;</span></span><br><span class="line"><span class="regexp">  tabList=&#123;</span></span><br><span class="line"><span class="regexp">     [&#123;key:"张三",tab:&lt;div&gt;张三&lt;/div&gt;&#125;,&#123;key:"李四",tab:&lt;div&gt;李四&lt;/div&gt;&#125;]</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&gt;</span></span><br><span class="line"><span class="regexp">  &lt;p&gt;正文内容&lt;/</span>p&gt;</span><br><span class="line">&lt;<span class="regexp">/PageContainer&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="c-DefaultFooter"><a href="#c-DefaultFooter" class="headerlink" title="c) DefaultFooter"></a>c) DefaultFooter</h4><p>网页默认的底部组件</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;DefaultFooter</span><br><span class="line">    copyright=<span class="string">"2019 蚂蚁金服体验技术部出品"</span></span><br><span class="line">    links=&#123;[</span><br><span class="line">      &#123;</span><br><span class="line">        key: <span class="string">'Ant Design Pro'</span>,</span><br><span class="line">        title: <span class="string">'Ant Design Pro'</span>,</span><br><span class="line">        href: <span class="string">'https://pro.ant.design'</span>,</span><br><span class="line">        blankTarget: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        key: <span class="string">'github'</span>,</span><br><span class="line">        title: &lt;GithubOutlined /&gt;,</span><br><span class="line">        href: <span class="string">'https://github.com/ant-design/ant-design-pro'</span>,</span><br><span class="line">        blankTarget: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        key: <span class="string">'Ant Design'</span>,</span><br><span class="line">        title: <span class="string">'Ant Design'</span>,</span><br><span class="line">        href: <span class="string">'https://ant.design'</span>,</span><br><span class="line">        blankTarget: <span class="literal">true</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ]&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<h4 id="d-PageLoading"><a href="#d-PageLoading" class="headerlink" title="d) PageLoading"></a>d) PageLoading</h4><p>加载页面组件，需要在config.ts中配置。配置之后加载页面就默认会用该组件</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配置按需加载   即是否把构建产物进行拆分，在需要的时候下载额外的 JS 再执行。</span></span><br><span class="line">dynamicImport: &#123;</span><br><span class="line">    loading: <span class="string">'@/components/PageLoading/index'</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="e-FooterToolbar"><a href="#e-FooterToolbar" class="headerlink" title="e) FooterToolbar"></a>e) FooterToolbar</h4><p>底部工具栏组件</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;FooterToolbar</span><br><span class="line">    extra=&#123;</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">        已选择项&amp;nbsp;&amp;nbsp;</span><br><span class="line">        &lt;span&gt;服务调用次数总计万&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">    &gt;</span><br><span class="line">        &#123;<span class="comment">/**批量删除按钮 */</span>&#125;</span><br><span class="line">    &lt;Button&gt;批量删除&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">    &#123;/</span>**批量审批按钮 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">    &lt;Button type="primary"&gt;批量审批&lt;/</span>Button&gt;</span><br><span class="line">&lt;<span class="regexp">/FooterToolbar&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-高级表格ProTable"><a href="#3-2-2-高级表格ProTable" class="headerlink" title="3.2.2  高级表格ProTable"></a>3.2.2  高级表格ProTable</h3><h4 id="a-ProColumns"><a href="#a-ProColumns" class="headerlink" title="a) ProColumns"></a>a) ProColumns</h4><p>高级列，会嵌套在高级表格中使用</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义高级列(会嵌套在高级表格中)</span></span><br><span class="line">  <span class="keyword">const</span> columns: ProColumns&lt;TableListItem&gt;[] = [</span><br><span class="line">    &#123;</span><br><span class="line">      title: <span class="string">'规则名称'</span>, <span class="comment">//页面显示的标题</span></span><br><span class="line">      dataIndex: <span class="string">'name'</span>, <span class="comment">//对应数据源中的字段</span></span><br><span class="line">      tip: <span class="string">'规则名称是唯一的 key'</span>, <span class="comment">//tip提示信息</span></span><br><span class="line">      formItemProps: &#123;</span><br><span class="line">        <span class="comment">//校验规则</span></span><br><span class="line">        rules: [</span><br><span class="line">          &#123;</span><br><span class="line">            required: <span class="literal">true</span>,</span><br><span class="line">            message: <span class="string">'规则名称为必填项'</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">//渲染列的方法 : dom为页面元素,entity为数据源</span></span><br><span class="line">      render: <span class="function">(<span class="params">dom, entity</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &lt;a onClick=&#123;<span class="function"><span class="params">()</span> =&gt;</span> setRow(entity)&#125;&gt;&#123;dom&#125;&lt;<span class="regexp">/a&gt;;</span></span><br><span class="line"><span class="regexp">      &#125;,</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    &#123;</span></span><br><span class="line"><span class="regexp">      title: '描述',</span></span><br><span class="line"><span class="regexp">      dataIndex: 'desc',</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/input的type类型</span></span><br><span class="line"><span class="regexp">      valueType: 'textarea',</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    &#123;</span></span><br><span class="line"><span class="regexp">      title: '服务调用次数',</span></span><br><span class="line"><span class="regexp">      dataIndex: 'callNo',</span></span><br><span class="line"><span class="regexp">      sorter: true,</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/新建表单和查询的展开表单中不显示当前信息</span></span><br><span class="line"><span class="regexp">      hideInForm: true,</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/渲染文字的方法</span></span><br><span class="line"><span class="regexp">      renderText: (val: string) =&gt; `$&#123;val&#125; 万`,</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    &#123;</span></span><br><span class="line"><span class="regexp">      title: '状态',</span></span><br><span class="line"><span class="regexp">      dataIndex: 'status',</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/新建表单和查询的展开表单中不显示当前信息</span></span><br><span class="line"><span class="regexp">      hideInForm: true,</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/枚举值</span></span><br><span class="line"><span class="regexp">      valueEnum: &#123;</span></span><br><span class="line"><span class="regexp">        0: &#123; text: '关闭', status: 'Default' &#125;,</span></span><br><span class="line"><span class="regexp">        1: &#123; text: '运行中', status: 'Processing' &#125;,</span></span><br><span class="line"><span class="regexp">        2: &#123; text: '已上线', status: 'Success' &#125;,</span></span><br><span class="line"><span class="regexp">        3: &#123; text: '异常', status: 'Error' &#125;,</span></span><br><span class="line"><span class="regexp">      &#125;,</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    &#123;</span></span><br><span class="line"><span class="regexp">      title: '上次调度时间',</span></span><br><span class="line"><span class="regexp">      dataIndex: 'updatedAt',</span></span><br><span class="line"><span class="regexp">      sorter: true,</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ input的type类型</span></span><br><span class="line"><span class="regexp">      valueType: 'dateTime',</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ 新建表单查询的展开表单中不显示当前信息</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ hideInForm: true,</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/ 自定义渲染内容(会在新增表单和查询的展开表单中显示,要看到这个属性的结果需要把hideInForm: true去掉)</span></span><br><span class="line"><span class="regexp">      renderFormItem: (item, &#123; defaultRender, ...rest &#125;, form) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/获取当前数据的状态信息</span></span><br><span class="line"><span class="regexp">        const status = form.getFieldValue('status');</span></span><br><span class="line"><span class="regexp">        if (`$&#123;status&#125;` === '0') &#123;</span></span><br><span class="line"><span class="regexp">          return false;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        if (`$&#123;status&#125;` === '3') &#123;</span></span><br><span class="line"><span class="regexp">          return &lt;Input &#123;...rest&#125; placeholder="请输入异常原因！" /</span>&gt;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> defaultRender(item);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      title: <span class="string">'操作'</span>,</span><br><span class="line">      dataIndex: <span class="string">'option'</span>,</span><br><span class="line">      valueType: <span class="string">'option'</span>,</span><br><span class="line">      <span class="comment">//渲染操作栏的方法</span></span><br><span class="line">      render: <span class="function">(<span class="params">_, record</span>) =&gt;</span> (</span><br><span class="line">        &lt;&gt;</span><br><span class="line">          &#123;<span class="comment">/**配置按钮 */</span>&#125;</span><br><span class="line">          &lt;a</span><br><span class="line">            onClick=&#123;<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">              <span class="comment">//点击配置按钮让更新表单可见</span></span><br><span class="line">              handleUpdateModalVisible(<span class="literal">true</span>);</span><br><span class="line">              <span class="comment">//点击配置按钮设置更新表单的数据</span></span><br><span class="line">              setStepFormValues(record);</span><br><span class="line">            &#125;&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            配置</span><br><span class="line">          &lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Divider type="vertical" /</span>&gt;</span><br><span class="line">          &#123;<span class="comment">/**订阅警报按钮 */</span>&#125;</span><br><span class="line">          &lt;a href=<span class="string">""</span>&gt;订阅警报&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>&gt;</span><br><span class="line">      ),</span><br><span class="line">    &#125;,</span><br><span class="line">  ];</span><br></pre></td></tr></table></figure>

<h4 id="b-ProTable-amp-ActionType"><a href="#b-ProTable-amp-ActionType" class="headerlink" title="b) ProTable&amp;ActionType"></a>b) ProTable&amp;ActionType</h4><p>ProTable 高级表格</p>
<p>ActionType  记录高级表格的常用事件  (reload reset reloadAndRest等事件)</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ProTable, &#123; ProColumns, ActionType &#125; <span class="keyword">from</span> <span class="string">'@ant-design/pro-table'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//actionRef 记录高级表格的常用事件  (reload reset reloadAndRest等事件)</span></span><br><span class="line"><span class="keyword">const</span> actionRef = useRef&lt;ActionType&gt;();</span><br><span class="line"></span><br><span class="line">&lt;ProTable&lt;TableListItem&gt;</span><br><span class="line">        headerTitle=<span class="string">"查询表格"</span> <span class="comment">//表格标题</span></span><br><span class="line">        actionRef=&#123;actionRef&#125; <span class="comment">//表格事件的引用</span></span><br><span class="line">        rowKey=<span class="string">"key"</span> <span class="comment">//表格每一行的key，这边为数据源中每一条数据的key</span></span><br><span class="line">        search=&#123;&#123;</span><br><span class="line">          labelWidth: <span class="number">120</span>, <span class="comment">//搜索lable的宽度   如果不想显示搜索栏，设置成false即可</span></span><br><span class="line">        &#125;&#125;</span><br><span class="line">        <span class="comment">//渲染工具栏(新建按钮)</span></span><br><span class="line">        toolBarRender=&#123;<span class="function"><span class="params">()</span> =&gt;</span> [</span><br><span class="line">          <span class="comment">//点击新建按钮，让新建表单可见</span></span><br><span class="line">          &lt;Button <span class="keyword">type</span>=<span class="string">"primary"</span>&gt;新建&lt;<span class="regexp">/Button&gt;,</span></span><br><span class="line"><span class="regexp">        ]&#125;</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/设置表格数据 (columns配置的sorter没有用，这边入参的sorter为空，要实现排序，手动storter写死)</span></span><br><span class="line"><span class="regexp">        request=&#123;(params, sorter, filter) =&gt; </span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/指定表格列</span></span><br><span class="line"><span class="regexp">        columns=&#123;columns&#125;</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/选中每一行(打钩)，记录下选中的数据</span></span><br><span class="line"><span class="regexp">        rowSelection=&#123;&#123;</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">/</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-3-高级描述ProDescriptions"><a href="#3-2-3-高级描述ProDescriptions" class="headerlink" title="3.2.3 高级描述ProDescriptions"></a>3.2.3 高级描述ProDescriptions</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ProDescriptions <span class="keyword">from</span> <span class="string">'@ant-design/pro-descriptions'</span>;</span><br><span class="line"></span><br><span class="line">&lt;ProDescriptions&lt;TableListItem&gt;</span><br><span class="line">    <span class="comment">//几列显示</span></span><br><span class="line">    column=&#123;<span class="number">2</span>&#125;</span><br><span class="line">    <span class="comment">//标题 如果row存在则取name，如果row不存在则不取name，避免row不存在的时候报错</span></span><br><span class="line">    title=&#123;row?.name&#125;</span><br><span class="line">    <span class="comment">//设置ProDescriptions的数据</span></span><br><span class="line">    request=&#123;<span class="keyword">async</span> () =&gt; (&#123;</span><br><span class="line">        data: row || &#123;&#125;,</span><br><span class="line">    &#125;)&#125;</span><br><span class="line">    <span class="comment">//传参，参数改变的时候会触发页面刷新</span></span><br><span class="line">    params=&#123;&#123;</span><br><span class="line">        id: row?.name,</span><br><span class="line">    &#125;&#125;</span><br><span class="line">    <span class="comment">//设置ProDescriptions的列数据</span></span><br><span class="line">    columns=&#123;columns&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<h2 id="3-3-登录页面及流程"><a href="#3-3-登录页面及流程" class="headerlink" title="3.3 登录页面及流程"></a>3.3 登录页面及流程</h2><h3 id="3-3-1-登录页面及子组件"><a href="#3-3-1-登录页面及子组件" class="headerlink" title="3.3.1 登录页面及子组件"></a>3.3.1 登录页面及子组件</h3><p>user/login/index.tsx   登录页面</p>
<p>user/login/components/login/index.tsx  封装的login组件，同时把Tab、Submit、Username、Password、Mobile、Captcha等组件挂在到当前index.tsx中</p>
<p>LoginContext.tsx  上下文对象，主要通过上下文在user/login/components/login/index.tsx中给子组件共享和暴露数据</p>
<p>LoginItem.tsx    登录项，主要在这里通过map.tsx中的配置动态创建登录子组件，包括Username、Password、Mobile、Captcha等</p>
<p>LoginSumit.tsx  提交登录表单的组件</p>
<p>LoginTab.tsx  登录切换Tab组件</p>
<h3 id="3-3-2-登录流程"><a href="#3-3-2-登录流程" class="headerlink" title="3.3.2 登录流程"></a>3.3.2 登录流程</h3><ol>
<li><p>提交登录表单</p>
</li>
<li><p>调用fakeAccountLogin这个service发送登录请求</p>
</li>
<li><p>登录成功之后跳回回调地址 </p>
<p>注意：这边使用window.location.href=”xx”，会刷新页面，从而触发app.tsx中的getInitialState方法重新执行</p>
</li>
<li><p>根据当前url从路由配置中找寻相应的规则，然后根据getInitialState中的CurrentUser做权限验证，呈现登录后的用户菜单和页面</p>
</li>
</ol>
<h2 id="3-4-列表页流程"><a href="#3-4-列表页流程" class="headerlink" title="3.4 列表页流程"></a>3.4 列表页流程</h2><h3 id="3-4-1-列表页面及子组件"><a href="#3-4-1-列表页面及子组件" class="headerlink" title="3.4.1 列表页面及子组件"></a>3.4.1 列表页面及子组件</h3><p>pages/ListTableList/index.tsx   列表页面</p>
<p>pages/ListTableList/service.ts  列表页面的请求文件</p>
<p>pages/ListTableList/data.d.ts   列表页面的类型声明文件</p>
<p>pages/ListTableList/components/createForm.tsx  创建表单的组件</p>
<p>pages/ListTableList/components/updateForm.tsx  更新表单的组件</p>
<h3 id="3-4-2-列表流程"><a href="#3-4-2-列表流程" class="headerlink" title="3.4.2 列表流程"></a>3.4.2 列表流程</h3><h4 id="a-列表页面展示、查询、分页"><a href="#a-列表页面展示、查询、分页" class="headerlink" title="a) 列表页面展示、查询、分页"></a>a) 列表页面展示、查询、分页</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置表格数据 (columns配置的sorter没有用，这边入参的sorter为空，要实现排序，手动storter写死)</span></span><br><span class="line">request=&#123;<span class="function">(<span class="params">params, sorter, filter</span>) =&gt;</span></span><br><span class="line">         queryRule(&#123; ...params, sorter: &#123; callNo: <span class="string">'ascend'</span> &#125;, filter &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="b-规则新增"><a href="#b-规则新增" class="headerlink" title="b) 规则新增"></a>b) 规则新增</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.点击新建按钮，让新建表单模态框可见</span></span><br><span class="line">&lt;Button <span class="keyword">type</span>=<span class="string">"primary"</span> onClick=&#123;<span class="function"><span class="params">()</span> =&gt;</span> handleModalVisible(<span class="literal">true</span>)&#125;&gt;</span><br><span class="line">    &lt;PlusOutlined /&gt; 新建</span><br><span class="line">&lt;<span class="regexp">/Button&gt;,</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/2.点击新建表单的提交表单按钮，发送请求，然后让新建表单不可见，然后让外边的表单刷新页面</span></span><br><span class="line"><span class="regexp">&lt;CreateForm onCancel=&#123;() =&gt; handleModalVisible(false)&#125; modalVisible=&#123;createModalVisible&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &#123;/</span>**嵌套一个ProTable *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">        &lt;ProTable&lt;TableListItem, TableListItem&gt;</span></span><br><span class="line"><span class="regexp">          /</span><span class="regexp">/点击提交按钮 发送请求 让外部的ProTable刷新表格</span></span><br><span class="line"><span class="regexp">          onSubmit=&#123;async (value) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            const success = await handleAdd(value);</span></span><br><span class="line"><span class="regexp">            if (success) &#123;</span></span><br><span class="line"><span class="regexp">              handleModalVisible(false);</span></span><br><span class="line"><span class="regexp">              if (actionRef.current) &#123;</span></span><br><span class="line"><span class="regexp">                actionRef.current.reload();</span></span><br><span class="line"><span class="regexp">              &#125;</span></span><br><span class="line"><span class="regexp">            &#125;</span></span><br><span class="line"><span class="regexp">          &#125;&#125;</span></span><br><span class="line"><span class="regexp">          /</span><span class="regexp">/每一行的索引</span></span><br><span class="line"><span class="regexp">          rowKey="key"</span></span><br><span class="line"><span class="regexp">          /</span><span class="regexp">/表格的类型</span></span><br><span class="line"><span class="regexp">          type="form"</span></span><br><span class="line"><span class="regexp">          /</span><span class="regexp">/指定表格的列  此时columns中配置的hideInForm生效了</span></span><br><span class="line"><span class="regexp">          columns=&#123;columns&#125;</span></span><br><span class="line"><span class="regexp">        /</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/CreateForm&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="c-规则更新"><a href="#c-规则更新" class="headerlink" title="c) 规则更新"></a>c) 规则更新</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.点击配置按钮，让配置表单可见，并设置配置表单的数据</span></span><br><span class="line">handleUpdateModalVisible(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//点击配置按钮设置更新表单的数据</span></span><br><span class="line">setStepFormValues(record);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.点击配置表单的提交按钮，发送请求，然后让配置表单不可见，然后让外边的表单刷新页面</span></span><br><span class="line">&lt;UpdateForm</span><br><span class="line">          <span class="comment">//提交表单 发送请求 让外部的ProTable刷新表格</span></span><br><span class="line">          onSubmit=&#123;<span class="keyword">async</span> (value) =&gt; &#123;</span><br><span class="line">            <span class="keyword">const</span> success = <span class="keyword">await</span> handleUpdate(value);</span><br><span class="line">            <span class="keyword">if</span> (success) &#123;</span><br><span class="line">              handleUpdateModalVisible(<span class="literal">false</span>);</span><br><span class="line">              setStepFormValues(&#123;&#125;);</span><br><span class="line">              <span class="keyword">if</span> (actionRef.current) &#123;</span><br><span class="line">                actionRef.current.reload();</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;&#125;</span><br><span class="line">          <span class="comment">//取消更新表单</span></span><br><span class="line">          onCancel=&#123;<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            handleUpdateModalVisible(<span class="literal">false</span>);</span><br><span class="line">            setStepFormValues(&#123;&#125;);</span><br><span class="line">          &#125;&#125;</span><br><span class="line">          <span class="comment">//更新表单的显示隐藏状态</span></span><br><span class="line">          updateModalVisible=&#123;updateModalVisible&#125;</span><br><span class="line">          <span class="comment">//更新表单的数据</span></span><br><span class="line">          values=&#123;stepFormValues&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<h4 id="d-规则选中"><a href="#d-规则选中" class="headerlink" title="d) 规则选中"></a>d) 规则选中</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.选中规则，保存选中的数据到selectedRows数组</span></span><br><span class="line">rowSelection=&#123;&#123;</span><br><span class="line">    onChange: <span class="function">(<span class="params">_, selectedRows</span>) =&gt;</span> setSelectedRows(selectedRows),</span><br><span class="line">&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.如果选中行的长度&gt;0，则让底部FooterToolbar显示出来</span></span><br><span class="line"><span class="comment">//点击批量删除，发送请求，设置选中的selectedRows数组为空(让FooterToolbar不可见)，同时让外边的表单刷新页面</span></span><br><span class="line">&#123;selectedRowsState?.length &gt; <span class="number">0</span> &amp;&amp; (</span><br><span class="line">        &lt;FooterToolbar</span><br><span class="line">          extra=&#123;</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">              已选择 &lt;a style=&#123;&#123; fontWeight: <span class="number">600</span> &#125;&#125;&gt;&#123;selectedRowsState.length&#125;&lt;<span class="regexp">/a&gt; 项&amp;nbsp;&amp;nbsp;</span></span><br><span class="line"><span class="regexp">              &lt;span&gt;</span></span><br><span class="line"><span class="regexp">                服务调用次数总计 &#123;selectedRowsState.reduce((pre, item) =&gt; pre + item.callNo, 0)&#125; 万</span></span><br><span class="line"><span class="regexp">              &lt;/</span>span&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          &#123;/</span>**批量删除按钮 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">          &lt;Button</span></span><br><span class="line"><span class="regexp">            onClick=&#123;async () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">              await handleRemove(selectedRowsState);</span></span><br><span class="line"><span class="regexp">              setSelectedRows([]);</span></span><br><span class="line"><span class="regexp">              actionRef.current?.reloadAndRest?.();</span></span><br><span class="line"><span class="regexp">            &#125;&#125;</span></span><br><span class="line"><span class="regexp">          &gt;</span></span><br><span class="line"><span class="regexp">            批量删除</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Button&gt;</span><br><span class="line">           &#123;<span class="comment">/**批量审批按钮 */</span>&#125;</span><br><span class="line">          &lt;Button <span class="keyword">type</span>=<span class="string">"primary"</span>&gt;批量审批&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>FooterToolbar&gt;</span><br><span class="line">)&#125;</span><br></pre></td></tr></table></figure>

<h4 id="e-查看规则名称"><a href="#e-查看规则名称" class="headerlink" title="e) 查看规则名称"></a>e) 查看规则名称</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.点击规则名称记录当前点击的规则数据(row)</span></span><br><span class="line">&lt;a onClick=&#123;<span class="function"><span class="params">()</span> =&gt;</span> setRow(entity)&#125;&gt;&#123;dom&#125;&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/2.当前记录的规则有数据的时候，让抽屉可见，并使用ProDescriptions展示数据</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ 点击抽屉组件的关闭按钮的时候，让row数据置空(此时Drawer会隐藏)</span></span><br><span class="line"><span class="regexp">&lt;Drawer</span></span><br><span class="line"><span class="regexp">        width=&#123;500&#125;</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/当row数据存在的时候让抽屉组件显示</span></span><br><span class="line"><span class="regexp">        visible=&#123;!!row&#125;</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/关闭抽屉组件的时候触发的方法</span></span><br><span class="line"><span class="regexp">        onClose=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          setRow(undefined);</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/是否显示抽屉组件的关闭按钮</span></span><br><span class="line"><span class="regexp">        closable=&#123;false&#125;</span></span><br><span class="line"><span class="regexp">      &gt; </span></span><br><span class="line"><span class="regexp">        &#123;/</span>**如果row中有信息则显示规则的详细信息 *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">        &#123;row?.name &amp;&amp; (</span></span><br><span class="line"><span class="regexp">          &lt;ProDescriptions&lt;TableListItem&gt;</span></span><br><span class="line"><span class="regexp">            /</span><span class="regexp">/几列显示</span></span><br><span class="line"><span class="regexp">            column=&#123;2&#125;</span></span><br><span class="line"><span class="regexp">            /</span><span class="regexp">/标题 如果row存在则取name，如果row不存在则不取name，避免row不存在的时候报错</span></span><br><span class="line"><span class="regexp">            title=&#123;row?.name&#125;</span></span><br><span class="line"><span class="regexp">            /</span><span class="regexp">/设置ProDescriptions的数据</span></span><br><span class="line"><span class="regexp">            request=&#123;async () =&gt; (&#123;</span></span><br><span class="line"><span class="regexp">              data: row || &#123;&#125;,</span></span><br><span class="line"><span class="regexp">            &#125;)&#125;</span></span><br><span class="line"><span class="regexp">            /</span><span class="regexp">/传参，参数改变的时候会触发reload</span></span><br><span class="line"><span class="regexp">            params=&#123;&#123;</span></span><br><span class="line"><span class="regexp">              id: row?.name,</span></span><br><span class="line"><span class="regexp">            &#125;&#125;</span></span><br><span class="line"><span class="regexp">            /</span><span class="regexp">/设置ProDescriptions的列数据</span></span><br><span class="line"><span class="regexp">            columns=&#123;columns&#125;</span></span><br><span class="line"><span class="regexp">          /</span>&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">&lt;<span class="regexp">/Drawer&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="4-ant-design-pro区块"><a href="#4-ant-design-pro区块" class="headerlink" title="4. ant design pro区块"></a>4. ant design pro区块</h1><p><a href="https://pro.ant.design/docs/block-cn" target="_blank" rel="noopener">https://pro.ant.design/docs/block-cn</a></p>
<p>区块是研发资产的一种，它是一系列快速搭建页面的代码片段，它可以帮助你快速的在项目中初始化好一个页面，帮助你更快速的开发代码。当前的区块都是页面级别的区块，你可以理解为它是一些项目中经常会用到的典型页面的模板，使用区块其实相当于从已有的项目中复制一些页面的代码到你当前的项目中。</p>
<ul>
<li>以前开发一个页面：创建 JS -&gt; 创建 CSS -&gt; 创建 Model -&gt; 创建 service -&gt; 写页面组件。</li>
<li>现在开发一个页面：下载区块 -&gt; 基于区块初始化好的页面组件修改代码。</li>
</ul>
<p>在 Pro 中资产被分为了两种，区块和模板。区块可以类比为一个组件，而模板代表一个页面。区块现在支持所有 antd 中的 demo，可以更加快速的将 demo 导入到项目中去。</p>
<h1 id="5-vue-antd-admin"><a href="#5-vue-antd-admin" class="headerlink" title="5.vue-antd-admin"></a>5.vue-antd-admin</h1><p><a href="https://github.com/iczer/vue-antd-admin" target="_blank" rel="noopener">https://github.com/iczer/vue-antd-admin</a></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Wang su</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://ehbhgh.github.io/2020/03/23/ant-design-pro/">https://ehbhgh.github.io/2020/03/23/ant-design-pro/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/07/23/Dj7mVOJLucTNYet.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/06/23/typescript/"><img class="prev-cover" data-src="https://i.loli.net/2020/07/23/XARfSvl9oB6MKYm.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">浅谈TypeScript</div></div></a></div><div class="next-post pull-right"><a href="/2019/12/23/umi&amp;dva/"><img class="next-cover" data-src="https://i.loli.net/2020/07/23/XARfSvl9oB6MKYm.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Umi&amp;dva</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 <i style="color:#FF6A6A;animation: announ_animation 0.8s linear infinite;" class="fa fa-heartbeat"></i> Wang su</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">彼岸花开一千年,花开花落不相见。 若问花开叶落故,彼岸缘起缘又灭。</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="Increase Font Size"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="Decrease Font Size"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script><script src="https://cdn.jsdelivr.net/gh/lete114/CDN/Sum/sakura.js"></script><script id="xplayer" src="https://music.m0x.cn/Static/player/player.js" key="5f185cdca3357" ></script><script src="https://cdn.jsdelivr.net/gh/lete114/CDN/js/upjiang.js"></script></body></html>
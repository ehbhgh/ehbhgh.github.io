<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>详解React | So Love</title><meta name="description" content="1. React简介1.1 React介绍 React 是一个用于构建用户界面的 JAVASCRIPT库。React主要用于构建UI，很多人认为 React 是 MVC 中的 V（视图）。  React 起源于 Facebook 的内部项目，因为该公司对市场上所有 JavaScript MVC 框架都不满意，就决定自己写一套，用来架设 Instagram（照片交友） 的网站。做出来以后，发现这套东"><meta name="author" content="Wang su"><meta name="copyright" content="Wang su"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://ehbhgh.github.io/2020/07/23/react%E5%9F%BA%E7%A1%80/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="详解React"><meta property="og:url" content="https://ehbhgh.github.io/2020/07/23/react%E5%9F%BA%E7%A1%80/"><meta property="og:site_name" content="So Love"><meta property="og:description" content="1. React简介1.1 React介绍 React 是一个用于构建用户界面的 JAVASCRIPT库。React主要用于构建UI，很多人认为 React 是 MVC 中的 V（视图）。  React 起源于 Facebook 的内部项目，因为该公司对市场上所有 JavaScript MVC 框架都不满意，就决定自己写一套，用来架设 Instagram（照片交友） 的网站。做出来以后，发现这套东"><meta property="og:image" content="https://i.loli.net/2020/07/23/XARfSvl9oB6MKYm.jpg"><meta property="article:published_time" content="2020-07-23T00:55:13.000Z"><meta property="article:modified_time" content="2020-11-04T12:59:54.514Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="js三大家族" href="https://ehbhgh.github.io/2020/07/23/js%E7%B3%BB%E5%88%97%E4%B8%89%E5%A4%A7%E5%AE%B6%E6%97%8F/"><link rel="next" title="浅谈TypeScript" href="https://ehbhgh.github.io/2020/06/23/typescript/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: false,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: false    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2020-11-04 20:59:54'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">11</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 关键字</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa-fw fa fa-book"></i><span> 找文章</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-link"></i><span> 链接</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/link/"><i class="fa-fw fa fa-users"></i><span> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-React简介"><span class="toc-number">1.</span> <span class="toc-text">1. React简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-React介绍"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 React介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-前端三大主流框架"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 前端三大主流框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-React与Vue的对比"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 React与Vue的对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-React中几个核心的概念"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 React中几个核心的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-1-虚拟DOM（Virtual-Document-Object-Model）"><span class="toc-number">1.4.1.</span> <span class="toc-text">1.4.1 虚拟DOM（Virtual Document Object Model）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-2-react的Diff算法-Reconciliation"><span class="toc-number">1.4.2.</span> <span class="toc-text">1.4.2 react的Diff算法(Reconciliation)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-tree-diff"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">a) tree diff</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-component-diff"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">b) component diff</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-element-diff"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">c) element diff</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Create-React-App脚手架"><span class="toc-number">2.</span> <span class="toc-text">2. Create React App脚手架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-创建应用"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 创建应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-添加图片，字体和文件"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 添加图片，字体和文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-修改默认配置"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 修改默认配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-React基本语法"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 React基本语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-1-React的核心包"><span class="toc-number">2.4.1.</span> <span class="toc-text">2.4.1 React的核心包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-2-JSX语法"><span class="toc-number">2.4.2.</span> <span class="toc-text">2.4.2 JSX语法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-React中创建组件"><span class="toc-number">3.</span> <span class="toc-text">3. React中创建组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-使用-class-关键字来创建组件"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 使用 class 关键字来创建组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-1-最基本的组件结构"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1 最基本的组件结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-2-使用案例"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2 使用案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-3-state的修改"><span class="toc-number">3.1.3.</span> <span class="toc-text">3.1.3 state的修改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-不能直接修改-State"><span class="toc-number">3.1.3.1.</span> <span class="toc-text">a) 不能直接修改 State</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-State的更新可能是异步的"><span class="toc-number">3.1.3.2.</span> <span class="toc-text">b) State的更新可能是异步的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-获取更新之后的state数据"><span class="toc-number">3.1.3.3.</span> <span class="toc-text">c) 获取更新之后的state数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#d-setState合并"><span class="toc-number">3.1.3.4.</span> <span class="toc-text">d) setState合并</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#e-setState的实现过程"><span class="toc-number">3.1.3.5.</span> <span class="toc-text">e) setState的实现过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-使用构造函数来创建组件"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 使用构造函数来创建组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-基本使用"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-函数组件中的state"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 函数组件中的state</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-3-state-hook基本使用"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3  state hook基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-4-useState使用注意点"><span class="toc-number">3.2.4.</span> <span class="toc-text">3.2.4 useState使用注意点</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-useState是异步的"><span class="toc-number">3.2.4.1.</span> <span class="toc-text">a) useState是异步的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-useState中的数据务必是immutable数据"><span class="toc-number">3.2.4.2.</span> <span class="toc-text">b) useState中的数据务必是immutable数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-useState-是将新值直接覆盖掉旧值，而不是合并"><span class="toc-number">3.2.4.3.</span> <span class="toc-text">c) useState 是将新值直接覆盖掉旧值，而不是合并</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-两种创建组件方式的对比"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 两种创建组件方式的对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-条件渲染"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 条件渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-通过if来进行条件渲染"><span class="toc-number">3.4.1.</span> <span class="toc-text">3.4.1 通过if来进行条件渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-通过三元运算符条件渲染"><span class="toc-number">3.4.2.</span> <span class="toc-text">3.4.2 通过三元运算符条件渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-3-阻止组件渲染"><span class="toc-number">3.4.3.</span> <span class="toc-text">3.4.3 阻止组件渲染</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-4-通过-amp-amp-进行条件渲染"><span class="toc-number">3.4.4.</span> <span class="toc-text">3.4.4 通过&amp;&amp;进行条件渲染</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-列表渲染"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 列表渲染</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-Fragment的使用"><span class="toc-number">3.6.</span> <span class="toc-text">3.6 Fragment的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-7-React组合"><span class="toc-number">3.7.</span> <span class="toc-text">3.7 React组合</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-评论列表案例"><span class="toc-number">4.</span> <span class="toc-text">4. 评论列表案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-启用sass"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 启用sass</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-安装依赖"><span class="toc-number">4.1.1.</span> <span class="toc-text">4.1.1 安装依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-在sass文件中引入其他sass文件"><span class="toc-number">4.1.2.</span> <span class="toc-text">4.1.2 在sass文件中引入其他sass文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-案例完成"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 案例完成</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-CmtList-tsx"><span class="toc-number">4.2.1.</span> <span class="toc-text">4.2.1 CmtList.tsx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-CmtList-scss"><span class="toc-number">4.2.2.</span> <span class="toc-text">4.2.2 CmtList.scss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-CmtItem-tsx"><span class="toc-number">4.2.3.</span> <span class="toc-text">4.2.3 CmtItem.tsx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-CmtItem-scss"><span class="toc-number">4.2.4.</span> <span class="toc-text">4.2.4 CmtItem.scss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-5-问题"><span class="toc-number">4.2.5.</span> <span class="toc-text">4.2.5 问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-使用CSS模块化"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 使用CSS模块化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-1-CmtList-module-scss"><span class="toc-number">4.3.1.</span> <span class="toc-text">4.3.1 CmtList.module.scss</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-2-CmtList-tsx"><span class="toc-number">4.3.2.</span> <span class="toc-text">4.3.2 CmtList.tsx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-3-总结"><span class="toc-number">4.3.3.</span> <span class="toc-text">4.3.3 总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-React-事件处理"><span class="toc-number">5.</span> <span class="toc-text">5. React 事件处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-函数组件的事件绑定"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 函数组件的事件绑定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-绑定文本框与state中的值"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 绑定文本框与state中的值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-表单受控组件"><span class="toc-number">5.2.1.</span> <span class="toc-text">5.2.1 表单受控组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-表单非受控组件"><span class="toc-number">5.2.2.</span> <span class="toc-text">5.2.2 表单非受控组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-3-受控组件和非受控组件"><span class="toc-number">5.2.3.</span> <span class="toc-text">5.2.3 受控组件和非受控组件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-React父子组件的通信"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 React父子组件的通信</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-1-父组件传递给子组件"><span class="toc-number">5.3.1.</span> <span class="toc-text">5.3.1 父组件传递给子组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-2-子组件传递给父组件"><span class="toc-number">5.3.2.</span> <span class="toc-text">5.3.2 子组件传递给父组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-3-评论列表发表评论"><span class="toc-number">5.3.3.</span> <span class="toc-text">5.3.3 评论列表发表评论</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-Ref-Hook"><span class="toc-number">5.4.</span> <span class="toc-text">5.4 Ref Hook</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-1-保存dom"><span class="toc-number">5.4.1.</span> <span class="toc-text">5.4.1 保存dom</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-2-forwardRef"><span class="toc-number">5.4.2.</span> <span class="toc-text">5.4.2 forwardRef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-3-useImperativeHandle"><span class="toc-number">5.4.3.</span> <span class="toc-text">5.4.3 useImperativeHandle</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-4-保存事件-变量"><span class="toc-number">5.4.4.</span> <span class="toc-text">5.4.4 保存事件&#x2F;变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-5-useState和useRef的区别"><span class="toc-number">5.4.5.</span> <span class="toc-text">5.4.5 useState和useRef的区别</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-类组件的生命周期"><span class="toc-number">6.</span> <span class="toc-text">6. 类组件的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-生命周期钩子函数介绍"><span class="toc-number">6.1.</span> <span class="toc-text">6.1 生命周期钩子函数介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-生命周期函数详解"><span class="toc-number">6.2.</span> <span class="toc-text">6.2 生命周期函数详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-组件的重新渲染和优化"><span class="toc-number">6.3.</span> <span class="toc-text">6.3 组件的重新渲染和优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-1-类组件的re-render的时机"><span class="toc-number">6.3.1.</span> <span class="toc-text">6.3.1 类组件的re-render的时机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-2-shouldComponentUpdate优化"><span class="toc-number">6.3.2.</span> <span class="toc-text">6.3.2 shouldComponentUpdate优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-3-PureComponent优化"><span class="toc-number">6.3.3.</span> <span class="toc-text">6.3.3 PureComponent优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-getDerivedStateFromProps存在的问题"><span class="toc-number">6.4.</span> <span class="toc-text">6.4 getDerivedStateFromProps存在的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-5-React老版本生命周期"><span class="toc-number">6.5.</span> <span class="toc-text">6.5 React老版本生命周期</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-函数组件的生命周期"><span class="toc-number">7.</span> <span class="toc-text">7.函数组件的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-useEffect介绍"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 useEffect介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-useEffect用法"><span class="toc-number">7.2.</span> <span class="toc-text">7.2 useEffect用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-useEffect使用"><span class="toc-number">7.3.</span> <span class="toc-text">7.3 useEffect使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-4-清除副作用"><span class="toc-number">7.4.</span> <span class="toc-text">7.4 清除副作用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#a-无需清理的副作用"><span class="toc-number">7.4.1.</span> <span class="toc-text">a) 无需清理的副作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b-需要清理的副作用"><span class="toc-number">7.4.2.</span> <span class="toc-text">b) 需要清理的副作用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c-useEffect返回清除函数的执行时机"><span class="toc-number">7.4.3.</span> <span class="toc-text">c) useEffect返回清除函数的执行时机</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-5-useLayoutEffect"><span class="toc-number">7.5.</span> <span class="toc-text">7.5 useLayoutEffect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-6-useEffect使用注意点"><span class="toc-number">7.6.</span> <span class="toc-text">7.6 useEffect使用注意点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-其他常用hook"><span class="toc-number">8.</span> <span class="toc-text">8.其他常用hook</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-函数组件re-render的时机"><span class="toc-number">8.1.</span> <span class="toc-text">8.1 函数组件re-render的时机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-memo-useMemo-useCallback"><span class="toc-number">8.2.</span> <span class="toc-text">8.2 memo\useMemo\useCallback</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-1-使用memo高阶函数"><span class="toc-number">8.2.1.</span> <span class="toc-text">8.2.1 使用memo高阶函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-2-useMemo"><span class="toc-number">8.2.2.</span> <span class="toc-text">8.2.2 useMemo</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-没有使用useMemo存在的问题"><span class="toc-number">8.2.2.1.</span> <span class="toc-text">a) 没有使用useMemo存在的问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-useMemo-hook"><span class="toc-number">8.2.2.2.</span> <span class="toc-text">b) useMemo hook</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-3-useCallback"><span class="toc-number">8.2.3.</span> <span class="toc-text">8.2.3 useCallback</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-没有使用useCallback的问题"><span class="toc-number">8.2.3.1.</span> <span class="toc-text">a) 没有使用useCallback的问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-useCallback-hook"><span class="toc-number">8.2.3.2.</span> <span class="toc-text">b) useCallback   hook</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-4-useMemo和useCallback的区别和联系"><span class="toc-number">8.2.4.</span> <span class="toc-text">8.2.4 useMemo和useCallback的区别和联系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-useReducer和useContext"><span class="toc-number">8.3.</span> <span class="toc-text">8.3 useReducer和useContext</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-1-useContext"><span class="toc-number">8.3.1.</span> <span class="toc-text">8.3.1 useContext</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-2-useReducer"><span class="toc-number">8.3.2.</span> <span class="toc-text">8.3.2 useReducer</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-redux介绍"><span class="toc-number">8.3.2.1.</span> <span class="toc-text">a) redux介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-useReducer"><span class="toc-number">8.3.2.2.</span> <span class="toc-text">b) useReducer</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-3-useReducer和useContext-了解"><span class="toc-number">8.3.3.</span> <span class="toc-text">8.3.3 useReducer和useContext(了解)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-Hook的规则"><span class="toc-number">8.4.</span> <span class="toc-text">8.4 Hook的规则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-1-只在组件顶层中使用Hook"><span class="toc-number">8.4.1.</span> <span class="toc-text">8.4.1 只在组件顶层中使用Hook</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-2-只在React-函数中调用Hook"><span class="toc-number">8.4.2.</span> <span class="toc-text">8.4.2 只在React 函数中调用Hook</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5-Hook参照文章："><span class="toc-number">8.5.</span> <span class="toc-text">8.5 Hook参照文章：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-React-router"><span class="toc-number">9.</span> <span class="toc-text">9. React-router</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-前端路由的两种实现方案"><span class="toc-number">9.1.</span> <span class="toc-text">9.1 前端路由的两种实现方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-Reac中的路由"><span class="toc-number">9.2.</span> <span class="toc-text">9.2 Reac中的路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-HashRouter的基本使用"><span class="toc-number">9.3.</span> <span class="toc-text">9.3 HashRouter的基本使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-4-匹配规则"><span class="toc-number">9.4.</span> <span class="toc-text">9.4 匹配规则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-5-Switch和Redirect"><span class="toc-number">9.5.</span> <span class="toc-text">9.5 Switch和Redirect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-6-React中的编程式导航和路由传参"><span class="toc-number">9.6.</span> <span class="toc-text">9.6 React中的编程式导航和路由传参</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-1-withRouter的使用"><span class="toc-number">9.6.1.</span> <span class="toc-text">9.6.1 withRouter的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-2-使用withRouter跳转页面"><span class="toc-number">9.6.2.</span> <span class="toc-text">9.6.2 使用withRouter跳转页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-6-3-路由传参"><span class="toc-number">9.6.3.</span> <span class="toc-text">9.6.3 路由传参</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-params方式传参"><span class="toc-number">9.6.3.1.</span> <span class="toc-text">a) params方式传参</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-search方式传参"><span class="toc-number">9.6.3.2.</span> <span class="toc-text">b) search方式传参</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-state方式传参"><span class="toc-number">9.6.3.3.</span> <span class="toc-text">c) state方式传参</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-7-组件懒加载和基于路由的代码分割"><span class="toc-number">9.7.</span> <span class="toc-text">9.7 组件懒加载和基于路由的代码分割</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-高阶组件"><span class="toc-number">10.</span> <span class="toc-text">10.高阶组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-高阶函数"><span class="toc-number">10.1.</span> <span class="toc-text">10.1 高阶函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-高阶组件"><span class="toc-number">10.2.</span> <span class="toc-text">10.2 高阶组件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-1-高阶组件的实现方式-属性代理"><span class="toc-number">10.2.1.</span> <span class="toc-text">10.2.1 高阶组件的实现方式-属性代理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-属性代理-用其他元素包装组件"><span class="toc-number">10.2.1.1.</span> <span class="toc-text">a) 属性代理-用其他元素包装组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-属性代理-更改props"><span class="toc-number">10.2.1.2.</span> <span class="toc-text">b) 属性代理-更改props</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#c-属性代理-抽取公共state"><span class="toc-number">10.2.1.3.</span> <span class="toc-text">c) 属性代理-抽取公共state</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-2-高阶组件的实现方式-反向继承"><span class="toc-number">10.2.2.</span> <span class="toc-text">10.2.2 高阶组件的实现方式-反向继承</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#a-反向继承-渲染劫持"><span class="toc-number">10.2.2.1.</span> <span class="toc-text">a) 反向继承-渲染劫持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#b-反向继承-修改state"><span class="toc-number">10.2.2.2.</span> <span class="toc-text">b) 反向继承-修改state</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-安装-React-Developer-Tools-调试工具"><span class="toc-number">11.</span> <span class="toc-text">11.安装 React Developer Tools 调试工具</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-相关文章"><span class="toc-number">12.</span> <span class="toc-text">12. 相关文章</span></a></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><header class="post-bg" id="page-header" style="background-image: url(https://i.loli.net/2020/07/23/XARfSvl9oB6MKYm.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">So Love</a></span><span class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 关键字</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa-fw fa fa-book"></i><span> 找文章</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li></ul></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-link"></i><span> 链接</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/link/"><i class="fa-fw fa fa-users"></i><span> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">详解React</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="Created 2020-07-23 08:55:13"><i class="far fa-calendar-alt fa-fw"></i> Created 2020-07-23</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="Updated 2020-11-04 20:59:54"><i class="fas fa-history fa-fw"></i> Updated 2020-11-04</span></time></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="1-React简介"><a href="#1-React简介" class="headerlink" title="1. React简介"></a>1. React简介</h1><h2 id="1-1-React介绍"><a href="#1-1-React介绍" class="headerlink" title="1.1 React介绍"></a>1.1 React介绍</h2><ul>
<li><p>React 是一个用于构建用户界面的 JAVASCRIPT库。React主要用于构建UI，很多人认为 React 是 MVC 中的 V（视图）。</p>
</li>
<li><p>React 起源于 Facebook 的内部项目，因为该公司对市场上所有 JavaScript MVC 框架都不满意，就决定自己写一套，用来架设 Instagram（照片交友） 的网站。做出来以后，发现这套东西很好用，<strong>就在2013年5月开源了</strong>。</p>
</li>
<li><p>React 拥有较高的性能，代码逻辑非常简单，越来越多的人已开始关注和使用它。由于 React 的<strong>设计思想极其独特</strong>，属于革命性创新，性能出众，代码逻辑却非常简单。所以，越来越多的人开始关注和使用，认为它可能是将来 Web 开发的主流工具。</p>
</li>
<li><p>清楚两个概念：</p>
<ul>
<li><p>library（库）：小而巧的库，只提供了特定的API；优点就是 船小好掉头，可以很方便的从一个库切换到另外的库；但是代码几乎不会改变；比如从jQuery切换到</p>
</li>
<li><p>Framework（框架）：大而全的是框架；框架提供了一整套的解决方案；所以如果在项目中间，想切换到另外的框架，是比较困难的；</p>
</li>
</ul>
</li>
</ul>
<h2 id="1-2-前端三大主流框架"><a href="#1-2-前端三大主流框架" class="headerlink" title="1.2 前端三大主流框架"></a>1.2 前端三大主流框架</h2><ul>
<li>Angular.js：出来<strong>较早</strong>的前端框架，学习曲线比较陡，NG1学起来比较麻烦，NG2 ~ NG5开始，进行了一系列的改革，也提供了组件化开发的概念；从NG2开始，也支持使用TS（TypeScript）进行编程；</li>
</ul>
<ul>
<li><p>Vue.js：<strong>最火</strong>（关注的人比较多）的一门前端框架，它是中国人开发的，对我们来说，文档要友好一些；</p>
</li>
<li><p>React.js：<strong>最流行</strong>（用的人比较多）的一门框架，因为它的设计很优秀；</p>
</li>
</ul>
<h2 id="1-3-React与Vue的对比"><a href="#1-3-React与Vue的对比" class="headerlink" title="1.3 React与Vue的对比"></a>1.3 React与Vue的对比</h2><p><strong>1、监听数据变化的实现原理不同</strong></p>
<ul>
<li><p>Vue 通过 getter/setter 以及一些函数的劫持，能精确知道数据变化，不需要特别的优化就能达到很好的性能</p>
</li>
<li><p>React 默认是通过比较引用地址的方式进行的，如果不优化   </p>
<p>（PureComponent/shouldComponentUpdate）可能导致大量不必要的VDOM的重新渲染</p>
</li>
</ul>
<p><strong>2、数据流的不同</strong></p>
<p><img src= "/img/loading.gif" data-src="assets%5C1574133046838.png" alt="img"></p>
<p>大家都知道Vue中默认是支持双向绑定的。在Vue1.0中我们可以实现两种双向绑定：</p>
<ol>
<li>父子组件之间，props 可以双向绑定</li>
<li>组件与DOM之间可以通过 v-model 双向绑定</li>
</ol>
<p>在 Vue2.x 中去掉了第一种，也就是父子组件之间不能双向绑定了（但是提供了一个语法糖自动帮你通过事件的方式修改），并且 Vue2.x 已经不鼓励组件对自己的 props 进行任何修改了。所以现在我们只有 组件 &lt;––&gt; DOM 之间的双向绑定这一种。</p>
<p>然而 React 从诞生之初就不支持双向绑定，React一直提倡的是单向数据流，他称之为 onChange/setState()模式。</p>
<p>不过由于我们一般都会用 Vuex 以及 Redux 等单向数据流的状态管理框架，因此很多时候我们感受不到这一点的区别了。</p>
<p><strong>3、模板渲染方式的不同</strong></p>
<p>在表层上， 模板的语法不同</p>
<ul>
<li>React 是通过JSX渲染模板</li>
<li>而Vue是通过一种拓展的HTML语法进行渲染</li>
</ul>
<p>但其实这只是表面现象，毕竟React并不必须依赖JSX。在深层上，模板的原理不同，这才是他们的本质区别：</p>
<ul>
<li>React是在组件JS代码中，通过原生JS实现模板中的常见语法，比如插值，条件，循环等，都是通过JS语法实现的</li>
<li>Vue是在和组件JS代码分离的单独的模板中，通过指令来实现的，比如条件语句就需要 v-if 来实现</li>
</ul>
<p><strong>4、Vuex 和 Redux 的区别</strong></p>
<p>从表面上来说，store 注入和使用方式有一些区别。</p>
<p>在 Vuex 中，$store 被直接注入到了组件实例中，因此可以比较灵活的使用：</p>
<ul>
<li>使用 dispatch 和 commit 提交更新</li>
<li>通过 mapState 或者直接通过 this.$store 来读取数据</li>
</ul>
<p>在 Redux 中，我们每一个组件都需要显示的用 connect 把需要的 props 和 dispatch 连接起来。</p>
<p>另外 Vuex 更加灵活一些，组件中既可以 dispatch action 也可以 commit reducer，而 Redux 中只能进行 dispatch，并不能直接调用 reducer 进行修改。</p>
<p>从实现原理上来说，最大的区别是两点：</p>
<ul>
<li>Redux 使用的是不可变数据，而Vuex的数据是可变的。Redux每次都是用新的state替换旧的state，而Vuex是直接修改</li>
<li>Redux 在检测数据变化的时候，是比较对象的引用地址；而Vuex其实和Vue的原理一样，是通过 getter/setter来比较的（如果看Vuex源码会知道，其实他内部直接创建一个Vue实例用来跟踪数据变化）</li>
</ul>
<p><strong>5、总结</strong></p>
<p>React更偏向于构建稳定大型的应用，非常的科班化。相比之下，Vue更偏向于简单迅速的解决问题，更灵活，不那么严格遵循条条框框。因此也会给人一种大型项目用React，小型项目用 Vue 的感觉。</p>
<h2 id="1-4-React中几个核心的概念"><a href="#1-4-React中几个核心的概念" class="headerlink" title="1.4 React中几个核心的概念"></a>1.4 React中几个核心的概念</h2><h3 id="1-4-1-虚拟DOM（Virtual-Document-Object-Model）"><a href="#1-4-1-虚拟DOM（Virtual-Document-Object-Model）" class="headerlink" title="1.4.1 虚拟DOM（Virtual Document Object Model）"></a>1.4.1 虚拟DOM（Virtual Document Object Model）</h3><ul>
<li><strong>DOM的本质是什么</strong>：浏览器中的概念，用JS对象来表示页面上的元素，并提供了操作 DOM 对象的API；</li>
<li><strong>什么是React中的虚拟DOM</strong>：是框架中的概念，是程序员用JS对象来模拟页面上的 DOM 和 DOM嵌套；</li>
<li><strong>为什么要实现虚拟DOM（虚拟DOM的目的）：</strong>为了实现页面中DOM 元素的高效更新</li>
<li><strong>DOM和虚拟DOM的区别</strong>：</li>
</ul>
<p><img src= "/img/loading.gif" data-src="images/%E8%99%9A%E6%8B%9FDOM%E7%9A%84%E6%A6%82%E5%BF%B5.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="assets%5C1552877849641.png" alt="1552877849641"></p>
<h3 id="1-4-2-react的Diff算法-Reconciliation"><a href="#1-4-2-react的Diff算法-Reconciliation" class="headerlink" title="1.4.2 react的Diff算法(Reconciliation)"></a>1.4.2 react的Diff算法(Reconciliation)</h3><p><img src= "/img/loading.gif" data-src="assets/Diff.png" alt="Diff算法图"></p>
<p>其实传统diff算法就是对每个节点一一对比，循环遍历所有的子节点，然后判断子节点的更新状态。通过循环递归对节点进行依次对比，算法时间复杂度达到 O(n^3) ，n是树的节点数，这个有多可怕呢？——如果要展示1000个节点，得执行上亿次比较。即便是CPU快能执行30亿条命令，也<strong>很难在一秒内</strong>计算出差异。</p>
<p>React 通过制定大胆的策略，将 O(n^3) 复杂度的问题转换成 O(n) 复杂度的问题。react根据自己的特点，实现了部分代码的简化。</p>
<p><img src= "/img/loading.gif" data-src="assets%5C1552878167661.png" alt="1552878167661"></p>
<h4 id="a-tree-diff"><a href="#a-tree-diff" class="headerlink" title="a) tree diff"></a>a) tree diff</h4><blockquote>
<p>（1）React通过updateDepth对Virtual DOM树进行层级控制。<br>（2）对树分层比较，两棵树只对同一层次节点进行比较。如果该节点不存在时，则该节点及其子节点会被完全删除，不会再进一步比较。<br>（3）只需遍历一次就能完成整棵DOM树的比较。</p>
</blockquote>
<p><img src= "/img/loading.gif" data-src="assets%5C1562723697592.png" alt="1562723697592"></p>
<blockquote>
<p>那么问题来了，如果DOM节点出现了跨层级操作,diff会咋办呢？<br>答：diff只简单考虑同层级的节点位置变换，如果是跨层级的话，只有创建节点和删除节点的操作。</p>
</blockquote>
<p><img src= "/img/loading.gif" data-src="assets%5C1562723819718.png" alt="1562723819718"></p>
<blockquote>
<p>如上图所示，以A为根节点的整棵树会被<strong>重新创建，而不是移动</strong>，因此 <strong>官方建议不要进行DOM节点跨层级操作，可以通过CSS隐藏、显示节点，而不是真正地移除、添加DOM节点</strong>。</p>
</blockquote>
<h4 id="b-component-diff"><a href="#b-component-diff" class="headerlink" title="b) component diff"></a>b) component diff</h4><p>React应用是基于组件构建的，对于组件的比较优化侧重于以下几点：</p>
<blockquote>
<ol>
<li>同一类型组件遵从tree diff比较v-dom树</li>
<li>不同类型组件，先将该组件归类为dirty component，替换下整个组件下的所有子节点</li>
<li>同一类型组件Virtual Dom没有变化，React允许开发者使用shouldComponentUpdate()来判断该组件是否进行diff，运用得当可以节省diff计算时间，提升性能</li>
</ol>
</blockquote>
<p><img src= "/img/loading.gif" data-src="assets%5C1562723945651.png" alt="1562723945651"></p>
<p>如上图，当组件D → 组件G时，diff判断为不同类型的组件，虽然它们的结构相似甚至一样，diff仍然不会比较二者结构，会直接销毁D及其子节点，然后新建一个G相关的子tree，这显然会影响性能，官方虽然认定这种情况极少出现，但是开发中的这种现象造成的影响是非常大的。</p>
<h4 id="c-element-diff"><a href="#c-element-diff" class="headerlink" title="c) element diff"></a>c) element diff</h4><p>对于同一层级的element节点，diff提供了以下3种节点操作：</p>
<blockquote>
<ol>
<li>INSERT_MARKUP 插入节点</li>
<li>MOVE_EXISING 移动节点</li>
<li>REMOVE_NODE 移除节点</li>
</ol>
</blockquote>
<p><img src= "/img/loading.gif" data-src="assets%5C1562724094202.png" alt="1562724094202"></p>
<p>一般diff在比较集合[A,B,C,D]和[B，A，D，C]的时候会进行全部对比，即按对应位置逐个比较，发现每个位置对应的元素都有所更新，则把旧集合全部移除，替换成新的集合，如上图，但是这样的操作在React中显然是复杂、低效、影响性能的操作，因为新集合中所有的元素都可以进行复用，无需删除重新创建，耗费性能和内存，只需要移动元素位置即可。</p>
<p>React对这一现象做出了一个高效的策略：允许开发者对同一层级的同组子节点添加唯一key值进行区分。意义就是代码上的一小步，性能上的一大步，甚至是翻天覆地的变化！</p>
<h1 id="2-Create-React-App脚手架"><a href="#2-Create-React-App脚手架" class="headerlink" title="2. Create React App脚手架"></a>2. Create React App脚手架</h1><p><a href="https://www.html.cn/create-react-app/docs/getting-started/" target="_blank" rel="noopener">https://www.html.cn/create-react-app/docs/getting-started/</a></p>
<p><code>Create React App</code>是FaceBook的React团队官方出的一个构建<code>React</code>单页面应用的脚手架工具。它本身集成了<code>Webpack</code>，并配置了一系列内置的<code>loader</code>和默认的npm的脚本，可以很轻松的实现零配置就可以快速开发React的应用。</p>
<h2 id="2-1-创建应用"><a href="#2-1-创建应用" class="headerlink" title="2.1 创建应用"></a>2.1 创建应用</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 全局安装</span><br><span class="line">npm install -g create-react-app</span><br><span class="line"># 构建一个my-app的项目</span><br><span class="line">npx create-react-app my-app                     </span><br><span class="line">npx create-react-app my-test-app --template typescript    <span class="comment">//typescript版本</span></span><br><span class="line">cd my-app</span><br><span class="line"></span><br><span class="line"># 启动编译当前的React项目，并自动打开 http://localhost:3000/</span><br><span class="line">yarn start</span><br><span class="line"></span><br><span class="line"># 如果你不能确保最新版本，可以先尝试卸载： npm uninstall -g create-react-app,然后再全局安装</span><br><span class="line"></span><br><span class="line"># 解压默认的webpack配置到配置文件中</span><br><span class="line"># react-scripts 是 create-react-app 的一个核心包，一些脚本和工具的默认配置都集成在里面，而 yarn eject 命令执行后会将封装在 create-react-app 中的配置全部反编译到当前项目，这样用户就能完全取得 webpack 文件的控制权。所以，eject 命令存在的意义就是更改 webpack 配置存在的啊！</span><br><span class="line">yarn run eject</span><br><span class="line">yarn install   <span class="comment">//需要再次运行install命令安装</span></span><br><span class="line">yarn run start <span class="comment">//然后才可以启动</span></span><br></pre></td></tr></table></figure>

<p>应用的目录结构：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">├── package.json</span><br><span class="line">├── public                  # 这个是webpack的配置的静态目录</span><br><span class="line">│   ├── favicon.ico</span><br><span class="line">│   ├── index.html          # 默认是单页面应用，这个是最终的html的基础模板</span><br><span class="line">│   └── manifest.json</span><br><span class="line">├── src</span><br><span class="line">│   ├── App.css             # App根组件的css</span><br><span class="line">│   ├── App.tsx              # App组件代码</span><br><span class="line">│   ├── App.test.tsx</span><br><span class="line">│   ├── index.css           # 启动文件样式</span><br><span class="line">│   ├── index.tsx            # 启动的文件（开始执行的入口）！！！！</span><br><span class="line">│   ├── logo.svg</span><br><span class="line">│   └── serviceWorker.js</span><br><span class="line">└── yarn.lock</span><br></pre></td></tr></table></figure>

<h2 id="2-2-添加图片，字体和文件"><a href="#2-2-添加图片，字体和文件" class="headerlink" title="2.2 添加图片，字体和文件"></a>2.2 添加图片，字体和文件</h2><p>使用 Webpack，添加图片和字体等静态资源的工作方式与 CSS 类似。</p>
<p>你可以 <strong>直接在 JavaScript 模块中 import 文件</strong>。 这会告诉 Webpack 将该文件包含在 bundle(包) 中。 与 CSS 导入不同，导入文件会为你提供字符串值。 此值是你可以在代码中引用的最终路径，例如 image 的 <code>src</code> 属性或链接到 PDF 的 <code>href</code> 属性。</p>
<p>要减少对服务器的请求数，导入小于 10,000 字节的图片将返回 <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs" target="_blank" rel="noopener">data URI</a> 而不是路径。 这适用于以下文件扩展名：<code>bmp</code> ，<code>gif</code> ，<code>jpg</code> ，<code>jpeg</code> 和 <code>png</code> 。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//例如：</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'./logo.png'</span>; <span class="comment">// 告诉 Webpack 这个 JS 文件使用了这个图片</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(logo); <span class="comment">// /logo.84287d09.png</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Header</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 导入结果是图片的 URL </span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;logo&#125;</span> <span class="attr">alt</span>=<span class="string">"Logo"</span> /&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Header;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这也适用于 CSS ：</span></span><br><span class="line">.Logo &#123;</span><br><span class="line">  background-image: url(./logo.png);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//字体图标的使用</span></span><br><span class="line"><span class="comment">//yarn add font-awesome</span></span><br><span class="line"><span class="comment">//引入样式</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'font-awesome/css/font-awesome.css'</span></span><br><span class="line"><span class="comment">//使用样式</span></span><br><span class="line">&lt;i <span class="class"><span class="keyword">class</span></span>=<span class="string">"fa fa-address-book"</span> aria-hidden=<span class="string">"true"</span>&gt;&lt;<span class="regexp">/i&gt; </span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/具体使用参照官网：http:/</span><span class="regexp">/www.fontawesome.com.cn/</span>faicons/</span><br></pre></td></tr></table></figure>

<h2 id="2-3-修改默认配置"><a href="#2-3-修改默认配置" class="headerlink" title="2.3 修改默认配置"></a>2.3 修改默认配置</h2><p>要修改 create-react-app 脚手架中的默认配置，正常情况下我们也不会通过yarn reject暴露配置文件然后修改配置文件，我们可以在项目根目录下新建一个config-overrides.js配置文件，覆盖默认的配置</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>	yarn add react-app-rewired customize-cra</span><br><span class="line"><span class="number">2.</span>	在项目根目录下创建一个config-overrides.js</span><br><span class="line"><span class="number">3.</span>  修改package.json</span><br><span class="line">    <span class="string">"scripts"</span>: &#123;</span><br><span class="line">        - <span class="string">"start"</span>: <span class="string">"react-scripts start"</span>,</span><br><span class="line">        + <span class="string">"start"</span>: <span class="string">"react-app-rewired start"</span>,</span><br><span class="line">        - <span class="string">"build"</span>: <span class="string">"react-scripts build"</span>,</span><br><span class="line">        + <span class="string">"build"</span>: <span class="string">"react-app-rewired build"</span>,</span><br><span class="line">        - <span class="string">"test"</span>: <span class="string">"react-scripts test"</span>,</span><br><span class="line">        + <span class="string">"test"</span>: <span class="string">"react-app-rewired test"</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  修改config-overrides.js文件</span></span><br><span class="line"><span class="comment">//  http://npm.taobao.org/package/customize-cra</span></span><br><span class="line"><span class="comment">//  https://blog.csdn.net/weixin_33850890/article/details/91372527</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="comment">// 配置less和@符号</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    override,</span><br><span class="line">    addWebpackAlias</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">"customize-cra"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = override(</span><br><span class="line">    addWebpackAlias(&#123;</span><br><span class="line">        [<span class="string">"@"</span>]: path.resolve(__dirname, <span class="string">"src"</span>)</span><br><span class="line">    &#125;),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在项目根目录下创建paths.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">        <span class="attr">"baseUrl"</span>: <span class="string">"."</span>,</span><br><span class="line">        <span class="attr">"paths"</span>: &#123;</span><br><span class="line">            <span class="attr">"@/*"</span>: [<span class="string">"src/*"</span>],</span><br><span class="line">            <span class="attr">"@components/*"</span>: [<span class="string">"src/components/*"</span>],</span><br><span class="line">            <span class="attr">"@pages/*"</span>: [<span class="string">"src/pages/*"</span>],</span><br><span class="line">            <span class="attr">"@utils/*"</span>: [<span class="string">"src/utils/*"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改tsconfig.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"extends"</span>: <span class="string">"./paths.json"</span>,</span><br><span class="line">    <span class="attr">"compilerOptions"</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-4-React基本语法"><a href="#2-4-React基本语法" class="headerlink" title="2.4 React基本语法"></a>2.4 React基本语法</h2><h3 id="2-4-1-React的核心包"><a href="#2-4-1-React的核心包" class="headerlink" title="2.4.1 React的核心包"></a>2.4.1 React的核心包</h3><ul>
<li>react： 专门用于创建组件和虚拟DOM的，同时组件的生命周期都在这个包中</li>
<li>react-dom： 专门进行DOM操作的，最主要的应用场景，就是<code>ReactDOM.render()</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是 创建虚拟DOM元素的 API    &lt;h1 title="啊，五环" id="myh1"&gt;你比四环多一环&lt;/h1&gt;</span></span><br><span class="line"><span class="comment">//  第一个参数： 字符串类型的参数，表示要创建的标签的名称</span></span><br><span class="line"><span class="comment">//  第二个参数：对象类型的参数， 表示 创建的元素的属性节点</span></span><br><span class="line"><span class="comment">//  第三个参数： 子节点（包括 其它 虚拟DOM 获取 文本子节点）</span></span><br><span class="line"><span class="comment">//  参数n :  其它子节点</span></span><br><span class="line"><span class="keyword">const</span> myh1 = React.createElement(<span class="string">'h1'</span>, &#123; <span class="attr">title</span>: <span class="string">'啊，五环'</span>, <span class="attr">id</span>: <span class="string">'myh1'</span> &#125;, <span class="string">'你比四环多一环'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mydiv = React.createElement(<span class="string">'div'</span>, <span class="literal">null</span>, <span class="string">'这是一个div元素'</span>, myh1)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 渲染虚拟DOM元素</span></span><br><span class="line"><span class="comment">// 参数1： 表示要渲染的虚拟DOM对象</span></span><br><span class="line"><span class="comment">// 参数2： 指定容器,注意：这里不能直接放 容器元素的Id字符串，需要放一个容器的DOM对象</span></span><br><span class="line">ReactDOM.render(myh1, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br></pre></td></tr></table></figure>

<h3 id="2-4-2-JSX语法"><a href="#2-4-2-JSX语法" class="headerlink" title="2.4.2 JSX语法"></a>2.4.2 JSX语法</h3><blockquote>
<p>什么是JSX语法：就是符合 xml 规范的 JS 语法；（语法格式相对来说，要比HTML严谨很多）</p>
</blockquote>
<p>JSX语法的本质：并不是直接把 jsx 渲染到页面上，而是内部通过 createElement 再渲染到页面；</p>
<p>在 jsx 中混合写入 js 表达式：在 jsx 语法中，要把 JS代码写到    <code>{ }</code> 中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 导入包</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//2. JSX中使用数值、字符串、bool、数组等信息</span></span><br><span class="line"><span class="keyword">let</span> a:number = <span class="number">10</span></span><br><span class="line"><span class="keyword">let</span> str:string = <span class="string">'你好，中国'</span></span><br><span class="line"><span class="keyword">let</span> boo:boolean = <span class="literal">false</span></span><br><span class="line"><span class="keyword">let</span> title:string = <span class="string">'999'</span></span><br><span class="line"><span class="keyword">const</span> h1:JSX.Element = <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>红火火恍恍惚惚<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="keyword">const</span> arr:JSX.Element[] = [</span><br><span class="line">  &lt;h2&gt;这是h2&lt;<span class="regexp">/h2&gt;,</span></span><br><span class="line"><span class="regexp">  &lt;h3&gt;这是h3&lt;/</span>h3&gt;</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> arrStr:string[] = [<span class="string">'毛利兰'</span>, <span class="string">'柯南'</span>, <span class="string">'小五郎'</span>, <span class="string">'灰原哀'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个空数组，将来用来存放 名称 标签【方案1】</span></span><br><span class="line"><span class="keyword">const</span> nameArr:JSX.Element[] = []</span><br><span class="line"><span class="comment">// 注意： React 中，需要把 key 添加给 被 forEach 或 map 或 for 循环直接控制的元素</span></span><br><span class="line">arrStr.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> temp = <span class="xml"><span class="tag">&lt;<span class="name">h5</span> <span class="attr">key</span>=<span class="string">&#123;item&#125;</span>&gt;</span>&#123;item&#125;<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span></span><br><span class="line">  nameArr.push(temp)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组的 map 方法, map 中必须写 return</span></span><br><span class="line"><span class="keyword">const</span> result:string[] = arrStr.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> item + <span class="string">'~~'</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(result) </span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 调用 render 函数渲染   JSX  XML 比 HTML 严格多了</span></span><br><span class="line"><span class="comment">// 在JSX要使用JS，则需要把 JS 代码写到 &#123;&#125; 中</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;a + 2&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;str&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;boo ? '条件为真' : '条件为假'&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">title</span>=<span class="string">&#123;title&#125;</span>&gt;</span>这是p标签<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;h1&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;/* &#123;arr&#125; */&#125;</span></span><br><span class="line"><span class="xml">  &#123;</span></span><br><span class="line"><span class="xml">    // 这是注释，你看不见我</span></span><br><span class="line"><span class="xml">  &#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  &#123;nameArr&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line">  &#123;arrStr.map(item =&gt; &lt;div key=&#123;item&#125;&gt;&lt;h3&gt;&#123;item&#125;&lt;/h3&gt;</span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span>)&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">hr</span> /&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">"ooo"</span>&gt;</span>11111<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br><span class="line">        </span><br><span class="line">                </span><br><span class="line"> #注意点：</span><br><span class="line"><span class="number">1.</span> 在 JSX 中 写注释：推荐使用&#123; <span class="comment">/* 这是注释 */</span> &#125;</span><br><span class="line"><span class="number">2.</span> 为 JSX 中的htmlFor替换label的<span class="keyword">for</span>属性</span><br><span class="line"><span class="number">3.</span> 在 JSX 创建DOM的时候，所有的节点，必须有唯一的根元素进行包裹；</span><br><span class="line"><span class="number">4.</span> 在 JSX 语法中，标签必须成对出现，如果是单标签，则必须自闭和！</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当 编译引擎，在编译JSX代码的时候，如果遇到了<code>&lt;</code>那么就把它当作 HTML代码去编译，如果遇到了 <code>{}</code> 就把 花括号内部的代码当作普通JS代码去编译；</p>
</blockquote>
<h1 id="3-React中创建组件"><a href="#3-React中创建组件" class="headerlink" title="3. React中创建组件"></a>3. React中创建组件</h1><h2 id="3-1-使用-class-关键字来创建组件"><a href="#3-1-使用-class-关键字来创建组件" class="headerlink" title="3.1 使用 class 关键字来创建组件"></a>3.1 使用 class 关键字来创建组件</h2><h3 id="3-1-1-最基本的组件结构"><a href="#3-1-1-最基本的组件结构" class="headerlink" title="3.1.1 最基本的组件结构"></a>3.1.1 最基本的组件结构</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//让自己的组件继承React.Compoent，重写render方法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> 组件名称 <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>这是 class 创建的组件<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-1-2-使用案例"><a href="#3-1-2-使用案例" class="headerlink" title="3.1.2 使用案例"></a>3.1.2 使用案例</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新建Movie.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//只读 不可以修改</span></span><br><span class="line">type IProps = Readonly&lt;&#123;</span><br><span class="line">  name?: string;</span><br><span class="line">  age?: number;</span><br><span class="line">  gender?: string;</span><br><span class="line">&#125;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">msg</span>: <span class="string">'大家好，我是 class 创建的 Movie组件'</span> &#125;;</span><br><span class="line"><span class="comment">//只读 不可以this.state来修改</span></span><br><span class="line">type IState = Readonly&lt;<span class="keyword">typeof</span> initialState&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个类继承React.component   </span></span><br><span class="line"><span class="comment">//&lt;IProps，IState&gt;是泛型，约定组件中的props和state的类型</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movie</span> <span class="keyword">extends</span> <span class="title">Component</span>&lt;<span class="title">IProps</span>, <span class="title">IState</span>&gt; </span>&#123;</span><br><span class="line">  readonly state: IState = initialState;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;/* 注意：在 class 组件内部，this 表示 当前组件的实例对象。props数据不可以修改，state数据可以修改 */&#125;</span></span><br><span class="line"><span class="xml">      这是 Movie 组件 -- &#123;this.props.name&#125; -- &#123;this.props.age&#125; -- &#123;this.props.gender&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;this.state.msg&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Movie;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.tsx</span></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  name: <span class="string">'zs'</span>,</span><br><span class="line">  age: <span class="number">22</span>,</span><br><span class="line">  gender: <span class="string">'男'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 调用 render 函数渲染</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  123</span></span><br><span class="line"><span class="xml">  &#123;/* 这里的 Movie 标签，其实，就是 Movie 类的一个实例对象 */&#125;</span></span><br><span class="line"><span class="xml">  &#123;/* <span class="tag">&lt;<span class="name">Movie</span> <span class="attr">name</span>=<span class="string">&#123;user.name&#125;</span> <span class="attr">age</span>=<span class="string">&#123;user.age&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Movie</span>&gt;</span> */&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">Movie</span> &#123;<span class="attr">...user</span>&#125;&gt;</span><span class="tag">&lt;/<span class="name">Movie</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>))</span><br></pre></td></tr></table></figure>

<h3 id="3-1-3-state的修改"><a href="#3-1-3-state的修改" class="headerlink" title="3.1.3 state的修改"></a>3.1.3 state的修改</h3><h4 id="a-不能直接修改-State"><a href="#a-不能直接修改-State" class="headerlink" title="a) 不能直接修改 State"></a>a) 不能直接修改 State</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//我们把state设置为Readonly就是为了不让直接修改state，所以下面写法错误</span></span><br><span class="line"><span class="keyword">this</span>.state.comment = <span class="string">'Hello'</span>;</span><br><span class="line"></span><br><span class="line"> <span class="comment">//可以这样修改State</span></span><br><span class="line"><span class="keyword">this</span>.setState(&#123;<span class="attr">comment</span>: <span class="string">'Hello'</span>&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="b-State的更新可能是异步的"><a href="#b-State的更新可能是异步的" class="headerlink" title="b) State的更新可能是异步的"></a>b) State的更新可能是异步的</h4><p>因为 <code>this.props</code> 和 <code>this.state</code> 可能会异步更新，所以你不要依赖他们的值来更新下一个状态。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用setState，组件的state并不会立即改变，setState只是把要修改的状态放入一个队列中，React会优化真正的执行时机，并且React会出于性能原因，可能会将多次setState的状态修改合并成一次状态修改。所以不要依赖当前的State，计算下个State。</span></span><br><span class="line">private btnAdd = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="comment">//Wrong</span></span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;<span class="attr">count</span>: <span class="keyword">this</span>.state.count + <span class="number">1</span>&#125;);</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;<span class="attr">count</span>: <span class="keyword">this</span>.state.count + <span class="number">1</span>&#125;);</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;<span class="attr">count</span>: <span class="keyword">this</span>.state.count + <span class="number">1</span>&#125;);</span><br><span class="line">  <span class="comment">//结果state的count为1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Wrong   因为state和props的更新可能是异步的，所以并不能保证counter中所获取到的state和props是最新的</span></span><br><span class="line">private btnAdd = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      counter: <span class="keyword">this</span>.state.counter + <span class="keyword">this</span>.props.increment,</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Correct</span></span><br><span class="line"> private btnAdd = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(<span class="function">(<span class="params">state:IState,props:IProps</span>)=&gt;</span>(&#123;</span><br><span class="line">      count:state.count+<span class="number">1</span></span><br><span class="line">    &#125;))</span><br><span class="line">    <span class="keyword">this</span>.setState(<span class="function">(<span class="params">state:IState,props:IProps</span>)=&gt;</span>(&#123;</span><br><span class="line">      count:state.count+<span class="number">1</span></span><br><span class="line">    &#125;))</span><br><span class="line">    <span class="keyword">this</span>.setState(<span class="function">(<span class="params">state:IState,props:IProps</span>)=&gt;</span>(&#123;</span><br><span class="line">      count:state.count+<span class="number">1</span></span><br><span class="line">    &#125;))</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>state的更新既可能是同步的，也可能是异步的。 准确地说，在React内部机制能检测到的地方, setState就是异步的；在React检测不到的地方，例如setInterval、setTimeout里，setState就是同步更新的。</p>
</blockquote>
<h4 id="c-获取更新之后的state数据"><a href="#c-获取更新之后的state数据" class="headerlink" title="c) 获取更新之后的state数据"></a>c) 获取更新之后的state数据</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.setState(</span><br><span class="line">    &#123; <span class="attr">data</span>: newData &#125;,</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">        <span class="comment">//这里打印的是最新的state值</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.state.data);</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="d-setState合并"><a href="#d-setState合并" class="headerlink" title="d) setState合并"></a>d) setState合并</h4><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//setState会把当前的值合并到原来的state中</span></span><br><span class="line"><span class="comment">//只要调用一次setState就会触发页面的重新渲染，不管这个state在页面有没有使用过，也不管这个state有没有发生变化</span></span><br><span class="line"><span class="comment">//为什么setState会触发页面的重新渲染呢？  因为setState内容会触发batchingUpdate方法来触发组件更新</span></span><br><span class="line"><span class="keyword">this</span>.setState(&#123;</span><br><span class="line">    name:<span class="string">"王小虎"</span></span><br><span class="line">&#125;,<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.state)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="e-setState的实现过程"><a href="#e-setState的实现过程" class="headerlink" title="e) setState的实现过程"></a>e) setState的实现过程</h4><p><img src= "/img/loading.gif" data-src="assets/3941614716-5b13d6d716035_articlex.png" alt="3941614716-5b13d6d716035_articlex"></p>
<h2 id="3-2-使用构造函数来创建组件"><a href="#3-2-使用构造函数来创建组件" class="headerlink" title="3.2 使用构造函数来创建组件"></a>3.2 使用构造函数来创建组件</h2><h3 id="3-2-1-基本使用"><a href="#3-2-1-基本使用" class="headerlink" title="3.2.1 基本使用"></a>3.2.1 基本使用</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#1. 新建Hello.tsx，并导出组件</span><br><span class="line"><span class="keyword">import</span> React, &#123; MouseEvent, FC &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  name?: string;</span><br><span class="line">  age?: number;</span><br><span class="line">  gender?: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Hello: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 如果 在一个组件中 return 一个 null。则表示此组件是空的，什么都不会渲染</span></span><br><span class="line">  <span class="comment">// return null</span></span><br><span class="line">  <span class="comment">// 在组件中，必须 返回一个 合法的 JSX 虚拟DOM元素</span></span><br><span class="line">  <span class="comment">// props.name = 'zs'</span></span><br><span class="line">  <span class="built_in">console</span>.log(props)</span><br><span class="line">  <span class="comment">// 结论：不论是 Vue 还是 React，组件中的 props 永远都是只读的；不能被重新赋值；</span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>这是 Hello 组件 --- &#123;props.name&#125; --- &#123;props.age&#125; --- &#123;props.gender&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Hello;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#2.导入Hello.jsx</span><br><span class="line">  <span class="comment">// 1. 导入包</span></span><br><span class="line">  <span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line">  <span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line">  <span class="comment">// 注意： 这里的 @ 符号，表示 项目根目录中的 src 这一层目录</span></span><br><span class="line">  <span class="keyword">import</span> Hello <span class="keyword">from</span> <span class="string">'@/components/Hello.jsx'</span></span><br><span class="line">  <span class="keyword">const</span> dog = &#123;</span><br><span class="line">    name: <span class="string">'大黄'</span>,</span><br><span class="line">    age: <span class="number">3</span>,</span><br><span class="line">    gender: <span class="string">'雄'</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    123</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Hello</span> &#123;<span class="attr">...dog</span>&#125;&gt;</span><span class="tag">&lt;/<span class="name">Hello</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-函数组件中的state"><a href="#3-2-2-函数组件中的state" class="headerlink" title="3.2.2 函数组件中的state"></a>3.2.2 函数组件中的state</h3><blockquote>
<p>React 16.7.0开始推行Hook，到 React 16.8.0 Hook 稳定，Hooks开始被推广使用，它解决了传统使用生命周期而导致的相关代码逻辑分离(例如创建订阅及取消订阅)、不相关代码逻辑混合在一个生命周期中(使用多个Effect)、class中复杂的this指向、class不能被很好的压缩、class可能导致热重载不稳定</p>
</blockquote>
<blockquote>
<p>Hook为开发者提供了可以使用function创建微state，且一个state由一个对应的函数管理，还提供了专门处理副作用、实现redux、性能优化等功能，并且100%向后兼容，个人认为Hook是react未来发展的趋势，但并不意味着摒弃class，react也没有移除class的计划。</p>
</blockquote>
<p><code>useState</code> 就是一个 <em>Hook</em> ，通过在函数组件里调用它来给组件添加一些内部 state。React 会在重复渲染时保留这个 state。</p>
<p><code>useState</code> 会返回一对值：<strong>当前</strong>状态和一个让你更新它的函数，你可以在事件处理函数中或其他一些地方调用这个函数。它类似 class 组件的 <code>this.setState</code>，但是它不会把新的 state 和旧的 state 进行合并。</p>
<blockquote>
<ol>
<li><p>一般来说，一个函数组件，在函数退出后变量就会”消失”，但是 state 中的变量会被 React 保留。</p>
</li>
<li><p>当我们点击按钮，调用setCount函数时，React会重新渲染这个组件，并把更新的count值传给这个组件。(其实是每次 Render 都有自己的 Props 与 State)</p>
<p><a href="https://segmentfault.com/a/1190000018639033#item-2-5" target="_blank" rel="noopener">https://segmentfault.com/a/1190000018639033#item-2-5</a></p>
</li>
<li><p>useState()接受一个参数为默认值，该方法返回一个数组，第一个值为定义data的值，第二个为更新data的方法，他们总是成对出现的</p>
</li>
</ol>
</blockquote>
<h3 id="3-2-3-state-hook基本使用"><a href="#3-2-3-state-hook基本使用" class="headerlink" title="3.2.3  state hook基本使用"></a>3.2.3  state hook基本使用</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo1: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//count代表state的变量</span></span><br><span class="line">  <span class="comment">//setCount是一个function，如果我们要修改count变量，需要通过setCount来修改</span></span><br><span class="line">  <span class="keyword">let</span> [count, setCount] = useState&lt;number&gt;(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">let</span> [count2, setCount2] = useState&lt;number&gt;(<span class="number">1</span>)</span><br><span class="line">  <span class="keyword">let</span> [count3, setCount3] = useState&lt;number&gt;(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;count&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; setCount(++count) &#125;&#125;&gt;点我修改count<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;count2&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; setCount2(++count2) &#125;&#125;&gt;点我修改count2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;count3&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; setCount3(++count3) &#125;&#125;&gt;点我修改count3<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo1;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-4-useState使用注意点"><a href="#3-2-4-useState使用注意点" class="headerlink" title="3.2.4 useState使用注意点"></a>3.2.4 useState使用注意点</h3><h4 id="a-useState是异步的"><a href="#a-useState是异步的" class="headerlink" title="a) useState是异步的"></a>a) <code>useState</code>是异步的</h4><p>修改state之后无法拿到最新的状态，要等到下一个事件循环周期执行时，状态才是最新的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Demo1: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [people, setPeople] = useState&lt;&#123; <span class="attr">name</span>: string, <span class="attr">age</span>: number &#125;&gt;(&#123; <span class="attr">name</span>: <span class="string">"张三"</span>, <span class="attr">age</span>: <span class="number">12</span> &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleUpdate = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setPeople(&#123; ...people, <span class="attr">name</span>: <span class="string">'王五'</span> &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(people.name); <span class="comment">// 张三</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;people.name&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleUpdate&#125;</span>&gt;</span> 修改name<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo1;</span><br></pre></td></tr></table></figure>

<p>但是在state不影响DOM的前提下，你是可以同步使用它</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Demo1: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [people, setPeople] = useState&lt;&#123; <span class="attr">name</span>: string, <span class="attr">age</span>: number &#125;&gt;(&#123; <span class="attr">name</span>: <span class="string">"张三"</span>, <span class="attr">age</span>: <span class="number">12</span> &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleUpdate = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setPeople(&#123; ...people, <span class="attr">name</span>: <span class="string">'王五'</span> &#125;);</span><br><span class="line">    people.name = <span class="string">"王五"</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(people.name); <span class="comment">// 王五</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;people.name&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;handleUpdate&#125;</span>&gt;</span> 修改name<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo1;</span><br></pre></td></tr></table></figure>

<h4 id="b-useState中的数据务必是immutable数据"><a href="#b-useState中的数据务必是immutable数据" class="headerlink" title="b) useState中的数据务必是immutable数据"></a>b) <code>useState</code>中的数据务必是<code>immutable</code>数据</h4><p>若两次传入同一对象则不会触发组件更新，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo1: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [list, setList] = useState&lt;number[]&gt;([<span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">9</span>])</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;&gt;</span></span></span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &#123;list.map((item, idx) =&gt; &lt;li key=&#123;String(idx)&#125;&gt;&#123;item&#125;&lt;/li&gt;)&#125;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;/* sort 不生成副本，直接返回原数组 */&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; setList(list.sort((a, b) =&gt; a - b)) &#125;&#125;&gt;sort<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;/* slice 返回一个新的副本数组 */&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; setList(list.slice().sort((a, b) =&gt; a - b)) &#125;&#125;&gt;slice<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo1;</span><br></pre></td></tr></table></figure>

<p>点击sort按钮后并不会出发更新！</p>
<ul>
<li><code>useState</code>对应的 setState对state地改变生效，无论DOM是否使用了<code>state</code>，该组件都会重新渲染；</li>
</ul>
<h4 id="c-useState-是将新值直接覆盖掉旧值，而不是合并"><a href="#c-useState-是将新值直接覆盖掉旧值，而不是合并" class="headerlink" title="c) useState 是将新值直接覆盖掉旧值，而不是合并"></a>c) useState 是将新值直接覆盖掉旧值，而不是合并</h4><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> [temp,setTemp] = useState(&#123;<span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>&#125;);</span><br><span class="line">setTemp(&#123;<span class="attr">a</span>: <span class="number">2</span>&#125;); <span class="comment">// temp = &#123;a: 2&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-3-两种创建组件方式的对比"><a href="#3-3-两种创建组件方式的对比" class="headerlink" title="3.3 两种创建组件方式的对比"></a>3.3 两种创建组件方式的对比</h2><ol>
<li>用<strong>构造函数</strong>创建出来的组件：叫做“无状态组件”，只有props，没有自己的私有数据和生命周期函数</li>
<li>用<strong>class关键字</strong>创建出来的组件：叫做“有状态组件”，有私有数据和生命周期函数</li>
<li>无状态组件的本质只是一个render函数，其没有实例化的过程，故而也无法访问组件对象</li>
</ol>
<blockquote>
<p>有状态组件和无状态组件之间的<strong>本质区别</strong>就是：有无state属性！无状态组件由于没有私有数据和生命周期函数，运行效率会比有状态组件高一些。</p>
<p>在react hooks中，允许我们通过useState这个hook给函数组件添加状态</p>
</blockquote>
<h2 id="3-4-条件渲染"><a href="#3-4-条件渲染" class="headerlink" title="3.4 条件渲染"></a>3.4 条件渲染</h2><h3 id="3-4-1-通过if来进行条件渲染"><a href="#3-4-1-通过if来进行条件渲染" class="headerlink" title="3.4.1 通过if来进行条件渲染"></a>3.4.1 通过if来进行条件渲染</h3><p><a href="https://blog.csdn.net/crystalqy/article/details/79066347" target="_blank" rel="noopener">https://blog.csdn.net/crystalqy/article/details/79066347</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Gretting.jsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  isLoggedIn?:boolean</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Gretting: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isLoggedIn = props.isLoggedIn;</span><br><span class="line">  <span class="keyword">if</span> (isLoggedIn) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>已登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>未登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Gretting;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.tsx</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">Gretting</span> <span class="attr">isLoggedIn</span>=<span class="string">&#123;false&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Gretting</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br></pre></td></tr></table></figure>

<h3 id="3-4-2-通过三元运算符条件渲染"><a href="#3-4-2-通过三元运算符条件渲染" class="headerlink" title="3.4.2 通过三元运算符条件渲染"></a>3.4.2 通过三元运算符条件渲染</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  isLoggedIn?:boolean</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Gretting: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isLoggedIn = props.isLoggedIn;</span><br><span class="line">  <span class="keyword">return</span> isLoggedIn?<span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>已登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>:<span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>未登录<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Gretting;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-3-阻止组件渲染"><a href="#3-4-3-阻止组件渲染" class="headerlink" title="3.4.3 阻止组件渲染"></a>3.4.3 阻止组件渲染</h3><p>在极少数情况下，你可能希望能隐藏组件，即使它已经被其他组件渲染。若要完成此操作，你可以让 <code>render</code> 方法直接返回 <code>null</code>，而不进行任何渲染。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  isLoggedIn?:boolean</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Gretting: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> isLoggedIn = props.isLoggedIn;</span><br><span class="line">  <span class="keyword">if</span> (!isLoggedIn) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;已登录&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Gretting;</span><br></pre></td></tr></table></figure>

<h3 id="3-4-4-通过-amp-amp-进行条件渲染"><a href="#3-4-4-通过-amp-amp-进行条件渲染" class="headerlink" title="3.4.4 通过&amp;&amp;进行条件渲染"></a>3.4.4 通过&amp;&amp;进行条件渲染</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Mailbox.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  unreadMessages?: string[]</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">//解构赋值  如果没有给unreadMessages指定值的时候，默认用[]</span></span><br><span class="line"><span class="keyword">const</span> Mailbox: FC&lt;Props&gt; = <span class="function">(<span class="params">&#123;unreadMessages=[]&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;Hello!&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &#123;unreadMessages.length &gt; 0 &amp;&amp;</span></span><br><span class="line"><span class="regexp">        &lt;h2&gt;</span></span><br><span class="line"><span class="regexp">          You have &#123;unreadMessages.length&#125; unread messages.</span></span><br><span class="line"><span class="regexp">        &lt;/</span>h2&gt;</span><br><span class="line">      &#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Mailbox;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/index.tsx</span></span><br><span class="line"><span class="regexp">const messages = ['React', 'Re: React', 'Re:Re: React'];</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;Mailbox unreadMessages=&#123;messages&#125;&gt;&lt;/</span>Mailbox&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;, document.getElementById('root'))</span></span><br></pre></td></tr></table></figure>

<h2 id="3-5-列表渲染"><a href="#3-5-列表渲染" class="headerlink" title="3.5 列表渲染"></a>3.5 列表渲染</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//NumberList.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  numbers?:number[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//key 帮助 React 识别哪些元素改变了，比如被添加或删除。因此你应当给数组中的每一个元素赋予一个确定的标识。</span></span><br><span class="line"><span class="comment">//一个元素的 key 最好是这个元素在列表中拥有的一个独一无二的字符串。通常，我们使用来自数据 id 来作为元素的 key。key在兄弟节点之间必须唯一</span></span><br><span class="line"><span class="comment">//当元素没有确定 id 的时候，万不得已你可以使用元素索引 index 作为 key：</span></span><br><span class="line"><span class="keyword">const</span> NumberList: FC&lt;Props&gt; = <span class="function">(<span class="params">&#123;numbers=[]&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> listItems = numbers.map(<span class="function">(<span class="params">number</span>) =&gt;</span></span><br><span class="line">    &lt;li key=&#123;number.toString()&#125;&gt;</span><br><span class="line">      &#123;number&#125;</span><br><span class="line">    &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;ul&gt;&#123;listItems&#125;&lt;/u</span>l&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> NumberList;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.tsx</span></span><br><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">NumberList</span> <span class="attr">numbers</span>=<span class="string">&#123;numbers&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">NumberList</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br></pre></td></tr></table></figure>

<h2 id="3-6-Fragment的使用"><a href="#3-6-Fragment的使用" class="headerlink" title="3.6 Fragment的使用"></a>3.6 Fragment的使用</h2><p>有时，语义化的 HTML 会被破坏。比如当在 JSX 中使用 <code>&lt;div&gt;</code> 元素来实现 React 代码功能的时候，又或是在使用列表（<code>&lt;ol&gt;</code>， <code>&lt;ul&gt;</code> 和 <code>&lt;dl&gt;</code>）和 HTML <code>&lt;table&gt;</code> 时。 在这种情况下，我们应该使用 <a href="https://react.docschina.org/docs/fragments.html" target="_blank" rel="noopener">React Fragments</a> 来组合各个组件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ListItem.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//这边把?去掉，表示父组件在使用当前组件的时候item必传</span></span><br><span class="line">type Props = &#123;</span><br><span class="line">  item: &#123; <span class="attr">term</span>: string, <span class="attr">description</span>: string &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ListItem: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> item = props.item;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;React.Fragment&gt;</span><br><span class="line">      &lt;dt&gt;&#123;item.term&#125;&lt;<span class="regexp">/dt&gt;</span></span><br><span class="line"><span class="regexp">      &lt;dd&gt;&#123;item.description&#125;&lt;/</span>dd&gt;</span><br><span class="line">    &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default ListItem;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/index.tsx</span></span><br><span class="line"><span class="regexp">const items = [</span></span><br><span class="line"><span class="regexp">  &#123;</span></span><br><span class="line"><span class="regexp">    term: "1",</span></span><br><span class="line"><span class="regexp">    description: "描述1"</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  &#123;</span></span><br><span class="line"><span class="regexp">    term: "2",</span></span><br><span class="line"><span class="regexp">    description: "描述2"</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">];</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;dl&gt;</span></span><br><span class="line"><span class="regexp">    &#123;</span></span><br><span class="line"><span class="regexp">      items.map((item) =&gt; (</span></span><br><span class="line"><span class="regexp">        &lt;ListItem item=&#123;item&#125; key=&#123;item.term&#125; /</span>&gt;</span><br><span class="line">      ))</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;<span class="regexp">/dl&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br></pre></td></tr></table></figure>

<h2 id="3-7-React组合"><a href="#3-7-React组合" class="headerlink" title="3.7 React组合"></a>3.7 React组合</h2><p>react组合类似于Vue中的slot(插槽)，子组件的内容由父组件来指定</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//FancyBorder.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  color?:string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FancyBorder: FC&lt;Props&gt; = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div style=&#123;&#123;<span class="attr">color</span>:props.color&#125;&#125;&gt;</span><br><span class="line">      &#123;<span class="comment">/*子组件：占坑*/</span>&#125;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default FancyBorder;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/index.tsx</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;FancyBorder color="blue"&gt;</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;孩儿们&lt;/</span>div&gt;</span><br><span class="line">  &lt;<span class="regexp">/FancyBorder&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>div&gt;, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br></pre></td></tr></table></figure>

<p>少数情况下，你可能需要在一个组件中预留出几个“洞”。这种情况下，我们可以不使用 children，而是自行约定：将所需内容传入 props，并使用相应的 prop。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//SplitPane.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; MouseEvent, FC &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  left?:JSX.Element,</span><br><span class="line">  right?:JSX.Element</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SplitPane: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"SplitPane"</span>&gt;</span><br><span class="line">      &lt;div className=<span class="string">"SplitPane-left"</span>&gt;</span><br><span class="line">        &#123;props.left&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div className="SplitPane-right"&gt;</span></span><br><span class="line"><span class="regexp">        &#123;props.right&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default SplitPane;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/index.tsx</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;SplitPane</span></span><br><span class="line"><span class="regexp">    left=&#123;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;左边&lt;/</span>div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">    right=&#123;</span><br><span class="line">      &lt;div&gt;右边&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &#125; /</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;, document.getElementById('root'))</span></span><br></pre></td></tr></table></figure>

<h1 id="4-评论列表案例"><a href="#4-评论列表案例" class="headerlink" title="4. 评论列表案例"></a>4. 评论列表案例</h1><h2 id="4-1-启用sass"><a href="#4-1-启用sass" class="headerlink" title="4.1 启用sass"></a>4.1 启用sass</h2><p><a href="mailto:react-scripts@2.0.0">react-scripts@2.0.0</a> 以上版本才适用。</p>
<p>react-scripts主要设计原理是将配置好的如 <code>Webpack，Babel，ESLint</code> ，合并到 <code>react-scripts</code> 这npm包中，用户就可以开箱即用。很多开发者都在这基础上进行改造开发。注意 <code>react-scripts</code> 就是create-react-app脚手架的核心配置代码。</p>
<h3 id="4-1-1-安装依赖"><a href="#4-1-1-安装依赖" class="headerlink" title="4.1.1 安装依赖"></a>4.1.1 安装依赖</h3><p>要使用Sass必须首先安装   <code>node-sass</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ npm install node-sass --save</span><br><span class="line">$ # or</span><br><span class="line">$ yarn add node-sass</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;配置node-sass的二进制包</span><br><span class="line">npm config set sass_binary_site https:&#x2F;&#x2F;npm.taobao.org&#x2F;mirrors&#x2F;node-sass&#x2F;</span><br></pre></td></tr></table></figure>

<p>安装完之后，我们就可以直接在组件中引入scss文件了。</p>
<h3 id="4-1-2-在sass文件中引入其他sass文件"><a href="#4-1-2-在sass文件中引入其他sass文件" class="headerlink" title="4.1.2 在sass文件中引入其他sass文件"></a>4.1.2 在sass文件中引入其他sass文件</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">import</span> <span class="string">'styles/colors.scss'</span>;   <span class="comment">//这边路径以当前文件路径为参照</span></span><br></pre></td></tr></table></figure>

<h2 id="4-2-案例完成"><a href="#4-2-案例完成" class="headerlink" title="4.2 案例完成"></a>4.2 案例完成</h2><p>思路：父组件中套了若干个评论Item子组件，所以需要创建两个组件，分别是：CmtList和CmtItem</p>
<h3 id="4-2-1-CmtList-tsx"><a href="#4-2-1-CmtList-tsx" class="headerlink" title="4.2.1 CmtList.tsx"></a>4.2.1 CmtList.tsx</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> CmtItem <span class="keyword">from</span> <span class="string">"./CmtItem"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./CmtList.scss"</span>;</span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CmtList: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [commentList, SetCommentList] = useState([</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">user</span>: <span class="string">'张三'</span>, <span class="attr">content</span>: <span class="string">'哈哈，沙发'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">user</span>: <span class="string">'李四'</span>, <span class="attr">content</span>: <span class="string">'哈哈，板凳'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">user</span>: <span class="string">'王五'</span>, <span class="attr">content</span>: <span class="string">'哈哈，凉席'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">user</span>: <span class="string">'赵六'</span>, <span class="attr">content</span>: <span class="string">'哈哈，砖头'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">5</span>, <span class="attr">user</span>: <span class="string">'田七'</span>, <span class="attr">content</span>: <span class="string">'哈哈，楼下山炮'</span> &#125;]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;/* 样式的第一种写法：直接用行内样式 */&#125;</span></span><br><span class="line"><span class="xml">    &#123;/* <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> '<span class="attr">red</span>', <span class="attr">fontSize:</span> '<span class="attr">35px</span>', <span class="attr">zIndex:</span> <span class="attr">3</span>, <span class="attr">fontWeight:</span> <span class="attr">200</span>, <span class="attr">textAlign:</span> '<span class="attr">center</span>' &#125;&#125;&gt;</span>这是评论列表组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> */&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>这是评论列表组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;commentList.map(item =&gt; <span class="tag">&lt;<span class="name">CmtItem</span> &#123;<span class="attr">...item</span>&#125; <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">CmtItem</span>&gt;</span>)&#125;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> CmtList;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-2-CmtList-scss"><a href="#4-2-2-CmtList-scss" class="headerlink" title="4.2.2 CmtList.scss"></a>4.2.2 CmtList.scss</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>:red;</span><br><span class="line">  <span class="attribute">font-size</span>:<span class="number">35px</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">3</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>:<span class="number">200</span>;</span><br><span class="line">  <span class="attribute">text-align</span>:center;</span><br><span class="line">  <span class="attribute">font-style</span>: italic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-3-CmtItem-tsx"><a href="#4-2-3-CmtItem-tsx" class="headerlink" title="4.2.3 CmtItem.tsx"></a>4.2.3 CmtItem.tsx</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./CmtItem.scss'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  user?: string,</span><br><span class="line">  content?: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CmtItem: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"item"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">"user"</span>&gt;</span>评论人：&#123;props.user&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">"content"</span>&gt;</span>评论内容：&#123;props.content&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> CmtItem;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-4-CmtItem-scss"><a href="#4-2-4-CmtItem-scss" class="headerlink" title="4.2.4 CmtItem.scss"></a>4.2.4 CmtItem.scss</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span>&#123;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> dashed <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">10px</span> <span class="number">#ccc</span>;</span><br><span class="line">  </span><br><span class="line">  .user&#123;</span><br><span class="line">    <span class="selector-tag">font-size</span>: 14<span class="selector-tag">px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="selector-class">.content</span>&#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-5-问题"><a href="#4-2-5-问题" class="headerlink" title="4.2.5 问题"></a>4.2.5 问题</h3><p>当我们在CmtList.css中指定了h1标签的样式的时候，我们发现  <code>import &quot;./CmtList.scss&quot;;&#39;</code> 之后，CmtList和CmtItem中的h1标签都变成了倾斜，说明CmtList中的样式全局生效了。原因在于webpack进行打包的时候会将所有内容打包到一个js文件，所以打包后的样式会全局生效。</p>
<h2 id="4-3-使用CSS模块化"><a href="#4-3-使用CSS模块化" class="headerlink" title="4.3 使用CSS模块化"></a>4.3 使用CSS模块化</h2><p>在cra脚手架中，如果某个样式文件要开启模块化，只需要把样式文件命名为xx.module.css/xx.module.scss就可以了</p>
<h3 id="4-3-1-CmtList-module-scss"><a href="#4-3-1-CmtList-module-scss" class="headerlink" title="4.3.1 CmtList.module.scss"></a>4.3.1 CmtList.module.scss</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* css 模块化只针对类选择器 和 Id选择器生效， 不会对标签选择器模块化 */</span></span><br><span class="line"><span class="selector-tag">h1</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>:red;</span><br><span class="line">  <span class="attribute">font-size</span>:<span class="number">35px</span>;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">3</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>:<span class="number">200</span>;</span><br><span class="line">  <span class="attribute">text-align</span>:center;</span><br><span class="line">  <span class="attribute">font-style</span>: italic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 注意： 被 :local() 包裹起来的类名会被模块化； 默认情况下所有的类和id选择器都会被模块化了； */</span></span><br><span class="line"><span class="selector-class">.title</span>&#123;</span><br><span class="line">  <span class="attribute">color</span>: blue;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">800</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 注意：被 :global() 包裹起来的类名，不会被模块化，而是会全局生效； */</span> </span><br><span class="line"><span class="selector-pseudo">:global(.test)</span>&#123;</span><br><span class="line">  <span class="attribute">font-style</span>: italic;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-2-CmtList-tsx"><a href="#4-3-2-CmtList-tsx" class="headerlink" title="4.3.2 CmtList.tsx"></a>4.3.2 CmtList.tsx</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cssObj <span class="keyword">from</span>  <span class="string">'./CmtList.module.scss'</span></span><br><span class="line"><span class="built_in">console</span>.log(cssObj)</span><br><span class="line"></span><br><span class="line"> &lt;h1 className=&#123;cssObj.title&#125;&gt;这是评论列表组件&lt;<span class="regexp">/h1&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-3-3-总结"><a href="#4-3-3-总结" class="headerlink" title="4.3.3 总结"></a>4.3.3 总结</h3><ol>
<li>使用 <code>:local()</code> 和 <code>:global()</code><ul>
<li><code>:local()</code>包裹的类名，是被模块化的类名，只能通过<code>className={cssObj.类名}</code>来使用。<code>:local</code>可以省略</li>
<li><code>:global()</code>包裹的类名，是全局生效的，不会被 <code>css-modules</code> 控制，定义的类名是什么，就是使用定义的类名<code>className=&quot;类名&quot;</code></li>
</ul>
</li>
<li>注意：只有<code>.title</code>这样的类样式或者id选择器，才会被模块化控制，类似于<code>body</code>这样的标签选择器，不会被模块化控制；</li>
</ol>
<h1 id="5-React-事件处理"><a href="#5-React-事件处理" class="headerlink" title="5. React 事件处理"></a>5. React 事件处理</h1><p><a href="https://reactjs.org/docs/events.html" target="_blank" rel="noopener">https://reactjs.org/docs/events.html</a></p>
<h2 id="5-1-函数组件的事件绑定"><a href="#5-1-函数组件的事件绑定" class="headerlink" title="5.1 函数组件的事件绑定"></a>5.1 函数组件的事件绑定</h2><ol>
<li><p>事件的名称都是React的提供的，因此名称的首字母必须大写<code>onClick</code>、<code>onMouseOver</code></p>
</li>
<li><p>为事件提供的处理函数，必须是如下格式 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123; <span class="function"><span class="keyword">function</span> &#125;&gt;按钮&lt;/<span class="title">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>事件绑定方式：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type Props = &#123; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> show = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"show方法"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> show2 = <span class="function">(<span class="params">msg:string</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"show2方法"</span>, msg)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;show&#125;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; show2("参数") &#125;&#125;&gt;按钮2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>


</li>
</ol>
<h2 id="5-2-绑定文本框与state中的值"><a href="#5-2-绑定文本框与state中的值" class="headerlink" title="5.2 绑定文本框与state中的值"></a>5.2 绑定文本框与state中的值</h2><ol>
<li><p>在Vue中提供了<code>v-model</code>指令，可以很方便的实现 <code>数据的双向绑定</code>；</p>
</li>
<li><p>但是在React中只是<code>单向数据流</code>，也就是只能把state上的数据绑定到页面，无法把页面中数据的变化自动同步回 state ； 如果需要把页面上数据的变化保存到 state，则需要程序员手动监听<code>onChange</code>事件，拿到最新的数据，手动调用<code>this.setState({  })</code> 更改回去。 这种方式叫受控组件</p>
</li>
</ol>
<h3 id="5-2-1-表单受控组件"><a href="#5-2-1-表单受控组件" class="headerlink" title="5.2.1 表单受控组件"></a>5.2.1 表单受控组件</h3><p>在 HTML 中，表单元素（如<code>&lt;input&gt;</code>、 <code>&lt;textarea&gt;</code> 和 <code>&lt;select&gt;</code>）之类的表单元素通常自己维护 state，并根据用户输入进行更新。而在 React 中，可变状态（mutable state）通常保存在组件的 state 属性中，并且只能通过使用 <a href="https://zh-hans.reactjs.org/docs/react-component.html#setstate" target="_blank" rel="noopener"><code>setState()</code></a>来更新。</p>
<p>我们可以把两者结合起来，使 React 的 state 成为“唯一数据源”。渲染表单的 React 组件还控制着用户输入过程中表单发生的操作。被 React 以这种方式控制取值的表单输入元素就叫做“受控组件”。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState&lt;string&gt;(<span class="string">"默认数据"</span>)</span><br><span class="line">  <span class="keyword">const</span> inputChange = <span class="function">(<span class="params">e: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    setValue(e.target.value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;input value=&#123;value&#125; onChange=&#123;inputChange&#125; /&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-2-表单非受控组件"><a href="#5-2-2-表单非受控组件" class="headerlink" title="5.2.2 表单非受控组件"></a>5.2.2 表单非受控组件</h3><p>在大多数情况下，我们推荐使用 <a href="https://zh-hans.reactjs.org/docs/forms.html#controlled-components" target="_blank" rel="noopener">受控组件</a> 来处理表单数据。在一个受控组件中，表单数据是由 React 组件来管理的。另一种替代方案是使用非受控组件，这时表单数据将交由 DOM 节点来处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState, useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//引用页面元素</span></span><br><span class="line">  <span class="keyword">const</span> inputRef = useRef&lt;HTMLInputElement&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> handleSubmit = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(inputRef.current &amp;&amp; inputRef.current.value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;input type=<span class="string">"text"</span> ref=&#123;inputRef&#125; /&gt;</span><br><span class="line">      &lt;input type=<span class="string">"button"</span> value=<span class="string">"点我"</span> onClick=&#123;handleSubmit&#125;&gt;&lt;<span class="regexp">/input&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>

<p>因为非受控组件将真实数据储存在 DOM 节点中，所以在使用非受控组件时，有时候反而更容易同时集成 React 和非 React 代码。如果你不介意代码美观性，并且希望快速编写代码，使用非受控组件往往可以减少你的代码量。否则，你应该使用受控组件。</p>
<h3 id="5-2-3-受控组件和非受控组件"><a href="#5-2-3-受控组件和非受控组件" class="headerlink" title="5.2.3 受控组件和非受控组件"></a>5.2.3 受控组件和非受控组件</h3><p>“受控”和“不受控制”的术语通常指的是表单输入，但他们还可以描述任何组件数据的位置。作为props传递进组件的数据可以被认为是<strong>受控的</strong>（因为父组件控制数据）。只存在于内部状态的数据可以被认为是<strong>不受控制的</strong>（因为父类不能直接更改它）。</p>
<h2 id="5-3-React父子组件的通信"><a href="#5-3-React父子组件的通信" class="headerlink" title="5.3 React父子组件的通信"></a>5.3 React父子组件的通信</h2><h3 id="5-3-1-父组件传递给子组件"><a href="#5-3-1-父组件传递给子组件" class="headerlink" title="5.3.1 父组件传递给子组件"></a>5.3.1 父组件传递给子组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父组件</span></span><br><span class="line">&lt;CMTItem key=&#123;i&#125; &#123;...item&#125;&lt;<span class="regexp">/CMTItem&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/子组件通过props可以获取到父组件传递过来的数据</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-2-子组件传递给父组件"><a href="#5-3-2-子组件传递给父组件" class="headerlink" title="5.3.2 子组件传递给父组件"></a>5.3.2 子组件传递给父组件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//父组件</span></span><br><span class="line"> &lt;CMTBox reload=&#123;loadCmts&#125;&gt;&lt;<span class="regexp">/CMTBox&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/子组件通过props.reload() 来调用父组件的方法，调用的时候可以传递参数</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-3-评论列表发表评论"><a href="#5-3-3-评论列表发表评论" class="headerlink" title="5.3.3 评论列表发表评论"></a>5.3.3 评论列表发表评论</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">#1.CmtList.jsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> CmtItem <span class="keyword">from</span> <span class="string">"./CmtItem"</span>;</span><br><span class="line"><span class="keyword">import</span> CmtBox <span class="keyword">from</span> <span class="string">"./CmtBox"</span>;</span><br><span class="line"><span class="comment">// import "./CmtList.scss";</span></span><br><span class="line"><span class="keyword">import</span> cssObj <span class="keyword">from</span> <span class="string">'./CmtList.module.scss'</span></span><br><span class="line"><span class="built_in">console</span>.log(cssObj)</span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CmtList: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [commentList, SetCommentList] = useState([</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">user</span>: <span class="string">'张三'</span>, <span class="attr">content</span>: <span class="string">'哈哈，沙发'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">user</span>: <span class="string">'李四'</span>, <span class="attr">content</span>: <span class="string">'哈哈，板凳'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">user</span>: <span class="string">'王五'</span>, <span class="attr">content</span>: <span class="string">'哈哈，凉席'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">user</span>: <span class="string">'赵六'</span>, <span class="attr">content</span>: <span class="string">'哈哈，砖头'</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">id</span>: <span class="number">5</span>, <span class="attr">user</span>: <span class="string">'田七'</span>, <span class="attr">content</span>: <span class="string">'哈哈，楼下山炮'</span> &#125;]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> reload = <span class="function">(<span class="params">obj:&#123;id:number,user:string,content:string&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    SetCommentList([...commentList, obj])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;/* 样式的第一种写法：直接用行内样式 */&#125;</span></span><br><span class="line"><span class="xml">    &#123;/* <span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> '<span class="attr">red</span>', <span class="attr">fontSize:</span> '<span class="attr">35px</span>', <span class="attr">zIndex:</span> <span class="attr">3</span>, <span class="attr">fontWeight:</span> <span class="attr">200</span>, <span class="attr">textAlign:</span> '<span class="attr">center</span>' &#125;&#125;&gt;</span>这是评论列表组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> */&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>这是评论列表组件<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">    &#123;commentList.map(item =&gt; <span class="tag">&lt;<span class="name">CmtItem</span> &#123;<span class="attr">...item</span>&#125; <span class="attr">key</span>=<span class="string">&#123;item.id&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">CmtItem</span>&gt;</span>)&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">CmtBox</span> <span class="attr">reload</span>=<span class="string">&#123;reload&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">CmtBox</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> CmtList;</span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line">#2.CmtItem.jsx</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./CmtItem.scss'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">CmtItem</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"item"</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">className</span>=<span class="string">"user"</span>&gt;</span>评论人：&#123;props.user&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">className</span>=<span class="string">"content"</span>&gt;</span>评论内容：&#123;props.content&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#3.CmtBox.jsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./CmtItem.scss'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  reload?(obj: <span class="built_in">Object</span>): <span class="keyword">void</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> CmtBox: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [user, setUser] = useState&lt;string&gt;(<span class="string">""</span>);</span><br><span class="line">  <span class="keyword">const</span> [content, setContent] = useState&lt;string&gt;(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//操作的是哪个文本框就去修改哪个文本框的数据</span></span><br><span class="line">  <span class="keyword">const</span> changeHandler = <span class="function">(<span class="params">e: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> tag = e.currentTarget.id;</span><br><span class="line">    <span class="keyword">if</span> (tag == <span class="string">"user"</span>) &#123;</span><br><span class="line">      setUser(e.currentTarget.value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      setContent(e.currentTarget.value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> postComment = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (user &amp;&amp; content) &#123;</span><br><span class="line">      props.reload &amp;&amp; props.reload(&#123;</span><br><span class="line">        user,</span><br><span class="line">        content,</span><br><span class="line">        id: <span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random() * <span class="number">1000</span> + <span class="string">''</span>) + <span class="number">100</span></span><br><span class="line">      &#125;)</span><br><span class="line">      setUser(<span class="string">""</span>);</span><br><span class="line">      setContent(<span class="string">""</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">"user"</span>&gt;</span>用户名<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"user"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">value</span>=<span class="string">&#123;user&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;changeHandler&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">htmlFor</span>=<span class="string">"content"</span>&gt;</span>内容<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"content"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">value</span>=<span class="string">&#123;content&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;changeHandler&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"发表评论"</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> postComment()&#125; /&gt;</span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> CmtBox;</span><br></pre></td></tr></table></figure>

<h2 id="5-4-Ref-Hook"><a href="#5-4-Ref-Hook" class="headerlink" title="5.4 Ref Hook"></a>5.4 Ref Hook</h2><blockquote>
<p>“ref”对象是一个通用容器，其current属性是可变的。返回的 ref 对象在组件的整个生命周期内保持不变。</p>
</blockquote>
<h3 id="5-4-1-保存dom"><a href="#5-4-1-保存dom" class="headerlink" title="5.4.1 保存dom"></a>5.4.1 保存dom</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useRef, useEffect , RefObject &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Test: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> t:RefObject&lt;HTMLDivElement&gt; = useRef&lt;HTMLDivElement&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="comment">//相当于componentDidMount 、componentDidUpdate</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(t.current); <span class="comment">// div</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div ref=&#123;t&#125;&gt; ... &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Test;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-4-2-forwardRef"><a href="#5-4-2-forwardRef" class="headerlink" title="5.4.2 forwardRef"></a>5.4.2 forwardRef</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// father</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> Son <span class="keyword">from</span> <span class="string">'./Son'</span>;</span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Father: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> refContainer = useRef&lt;HTMLInputElement&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> changeInput = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      refContainer.current&amp;&amp;(refContainer.current.value=<span class="string">'啊，我被改了!'</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> &gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;changeInput&#125;</span>&gt;</span>changeInput<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Son</span> <span class="attr">ref</span>=<span class="string">&#123;refContainer&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Father;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Son</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; forwardRef &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Son = React.forwardRef&lt;HTMLInputElement&gt;<span class="function">(<span class="params">(props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;ref&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Son;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-3-useImperativeHandle"><a href="#5-4-3-useImperativeHandle" class="headerlink" title="5.4.3 useImperativeHandle"></a>5.4.3 useImperativeHandle</h3><blockquote>
<p><code>useImperativeHandle</code> 可以让你在使用 <code>ref</code> 时给父组件暴露的指定的值。在大多数情况下，应当避免使用 ref 这样的命令式代码。<code>useImperativeHandle</code> 应当与 <code>forwardRef</code> 一起使用</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//father</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useRef, useEffect, RefObject &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> Son <span class="keyword">from</span> <span class="string">'./Son'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; InputRefProps &#125; <span class="keyword">from</span> <span class="string">"./type"</span>;</span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Father: FC&lt;Props&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> refContainer = useRef&lt;InputRefProps&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">const</span> changeInput = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    refContainer.current &amp;&amp; refContainer.current.focus()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> talk = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    refContainer.current &amp;&amp; refContainer.current.talk()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> &gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;changeInput&#125;</span>&gt;</span>changeInput<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;talk&#125;</span>&gt;</span>talk<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Son</span> <span class="attr">ref</span>=<span class="string">&#123;refContainer&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Son</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Father;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Son</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; forwardRef,useRef,useImperativeHandle &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; InputRefProps &#125; <span class="keyword">from</span> <span class="string">"./type"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Son = React.forwardRef&lt;InputRefProps&gt;<span class="function">(<span class="params">(props, ref</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//新建一个ref  将此ref绑定在本组建内的input上</span></span><br><span class="line">  <span class="keyword">const</span> inputRef = useRef&lt;HTMLInputElement&gt;(<span class="literal">null</span>);</span><br><span class="line">  <span class="comment">//将 使得本组件input获取焦点的方法赋给父组件传递来的ref上 </span></span><br><span class="line">  useImperativeHandle(ref, () =&gt; (&#123;</span><br><span class="line">      focus: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        inputRef.current &amp;&amp; inputRef.current.focus();</span><br><span class="line">      &#125;,</span><br><span class="line">      talk: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'hello, world!'</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;));</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Son;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//type.d.ts</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> InputRefProps &#123;</span><br><span class="line">  focus(): <span class="built_in">void</span>;</span><br><span class="line">  talk():<span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-4-保存事件-变量"><a href="#5-4-4-保存事件-变量" class="headerlink" title="5.4.4 保存事件/变量"></a>5.4.4 保存事件/变量</h3><p>在函数组件中，因为每次re-render就意味着函数重新执行一次，因此在函数内部保持变量引用是一件我们需要思考的事情(如果普通变量，每次re-render都会被重新初始化)。</p>
<p>在前面学习useState时我们知道，使用useState定义变量，可以做到这样的事情。同样的，利用ref的.current也可以。</p>
<p>一个很常见的应用场景就是对于定时器的清除。我们需要确保setInterval的执行结果timer的引用，才能准确的清除对应的定时器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Timer:FC&lt;<span class="built_in">Object</span>&gt; = <span class="function">(<span class="params">props</span>)=&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> timerRef = useRef&lt;NodeJS.Timeout&gt;();</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      timerRef.current = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'do something'</span>);</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 组件卸载时，清除定时器</span></span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          timerRef.current &amp;&amp; clearInterval(timerRef.current);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-4-5-useState和useRef的区别"><a href="#5-4-5-useState和useRef的区别" class="headerlink" title="5.4.5 useState和useRef的区别"></a>5.4.5 useState和useRef的区别</h3><ul>
<li>每次 Render 的内容都会形成一个快照并保留下来，因此当状态变更而 re-render 时，就形成了 N 个 Render 状态，而每个 Render 状态都拥有自己固定不变的 Props 与 State。(每次Render都有自己的Props、State、事件处理、effect，这就是<strong>Capture Value</strong> 特性)</li>
<li>利用 <code>useRef</code> 就可以绕过 Capture Value 的特性。<strong>可以认为 ref 在所有 Render 过程中保持着唯一引用，因此所有对 ref 的赋值或取值，拿到的都只有一个最终状态</strong></li>
<li>也可以简洁的认为，<code>ref</code> 是 Mutable 的，而 <code>state</code> 是 Immutable 的。</li>
</ul>
<h1 id="6-类组件的生命周期"><a href="#6-类组件的生命周期" class="headerlink" title="6. 类组件的生命周期"></a>6. 类组件的生命周期</h1><h2 id="6-1-生命周期钩子函数介绍"><a href="#6-1-生命周期钩子函数介绍" class="headerlink" title="6.1 生命周期钩子函数介绍"></a>6.1 生命周期钩子函数介绍</h2><ul>
<li><p>生命周期的概念：每个组件的实例，从创建、运行、到销毁，在这个过程中会出发一些列事件，这些事件就叫做组件的生命周期函数；</p>
</li>
<li><p>React组件生命周期(React 16.4+)分为三部分：</p>
<ul>
<li><strong>组件创建阶段</strong>：</li>
</ul>
<blockquote>
<p>static 开头的     只会执行一次</p>
<p>constructor    构造器     只会执行一次</p>
<p>getDerivedStateFromProps: 每次re-rendering之前被调用，作用：将传递的props映射到state里面       会执行多次</p>
<p>render           构建虚拟dom，但是此时虚拟dom还没有渲染到页面        会执行多次</p>
<p>componentDidMount:组建的虚拟dom已经挂载到页面                      只会执行一次</p>
</blockquote>
<ul>
<li><strong>组件运行阶段</strong>：根据 props 属性 或 state 状态的改变，有选择性的执行0到多次</li>
</ul>
<blockquote>
<p>getDerivedStateFromProps:每次re-rendering之前被调用</p>
<p>shouldComponentUpdate:组件是否需要被更新，返回值是true或者false。此时可以获取最新的props和state数据</p>
<p>render: 重新更新渲染组件的虚拟dom</p>
<p>getSnapshotBeforeUpdate：在最近一次渲染提交到 DOM 节点之前调用。它的含义是在React更新Dom元素之前，获取一个快照，它返回的结果将作为componentDidUpdate的第三个参数。一般的用法就是获取更新前的DOM。</p>
<p>componentDidUpdate: 组件完成了更新，此时页面已经是最新的了</p>
</blockquote>
<ul>
<li><strong>组件卸载阶段</strong>：只执行一次</li>
</ul>
<blockquote>
<p>componentWillUnmount: 当组件从 DOM 中移除时会调用如下方法，此时组件还可以被使用</p>
<p><img src= "/img/loading.gif" data-src="assets/1574654437154.png" alt="1574654437154"></p>
</blockquote>
</li>
</ul>
<p>React生命周期的回调函数总结成表格如下：<br><img src= "/img/loading.gif" data-src="assets/1574666830021.png" alt="1574666830021"></p>
<h2 id="6-2-生命周期函数详解"><a href="#6-2-生命周期函数详解" class="headerlink" title="6.2 生命周期函数详解"></a>6.2 生命周期函数详解</h2><blockquote>
<p>在组件创建之前，会先初始化默认的props属性，这是全局调用一次，严格地来说，这不是组件的生命周期的一部分。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line">#1.Counter.jsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line">type IProps = Readonly&lt;&#123;</span><br><span class="line">  initCount: number;</span><br><span class="line">&#125;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">msg</span>: <span class="string">'张三'</span> &#125;;</span><br><span class="line">type IState = Readonly&lt;<span class="keyword">typeof</span> initialState&gt;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span>&lt;<span class="title">IProps</span>, <span class="title">IState</span>&gt; </span>&#123;</span><br><span class="line">  readonly state: IState = initialState;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//-------------------------------组件创建阶段----------------------------------------</span></span><br><span class="line">  <span class="comment">//1.在组件的创建阶段：第一个执行的是static开头的属性</span></span><br><span class="line">  <span class="comment">//设定props的默认值：当父组件没有给子组件传递props的时候就会使用这个默认值</span></span><br><span class="line">  <span class="keyword">static</span> defaultProps = &#123;</span><br><span class="line">    initCount: <span class="number">100</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//2.在组件创建阶段，第二个执行的是构造函数 (创建一个组件对象执行一次)</span></span><br><span class="line">  <span class="comment">//构造函数的作用：主要就是用来创建组件对象</span></span><br><span class="line">  <span class="comment">//我们可以在构造函数中声明当前组件的state</span></span><br><span class="line">  <span class="keyword">constructor</span>(props: IProps) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造函数中只可以给state赋予初始值</span></span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      msg: <span class="string">"李四"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造函数中能够通过setState()来修改state的值</span></span><br><span class="line">    <span class="comment">// this.setState(&#123;</span></span><br><span class="line">    <span class="comment">//     msg:"李四"</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//3.在组件的创建阶段，第三个执行的是getDerivedStateFromProps</span></span><br><span class="line">  <span class="comment">//这个方法的作用：就是将props映射到state中</span></span><br><span class="line">  <span class="comment">//在每一次re-render的时候执行</span></span><br><span class="line">  <span class="keyword">static</span> getDerivedStateFromProps(nextProps: IProps, <span class="attr">prevState</span>: IState) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"getDerivedStateFromProps"</span>, nextProps, prevState)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//4.在组件的创建阶段，第四个执行的是render()方法。(在一个组件的各种生命周期阶段中，至少执行一次)</span></span><br><span class="line">  <span class="comment">//render()方法的主要作用：在内存中构建虚拟dom(此时虚拟dom还没有被挂载到页面)</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;</span></span><br><span class="line"><span class="xml">        // 在render()函数中不能通过setState()来修改state状态，因为这样会陷入死循环</span></span><br><span class="line"><span class="xml">        // 其实render()函数应该是一个纯函数，这个函数的作用本身就是给他什么数据，他就显示什么数据</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        // this.setState(&#123;</span></span><br><span class="line"><span class="xml">        //     msg:"王五"</span></span><br><span class="line"><span class="xml">        // &#125;)</span></span><br><span class="line"><span class="xml">      &#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;this.props.initCount&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;this.state.msg&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//5.在组件的创建阶段，第五个执行的是componentDidMount。(创建一个组件对象执行一次)</span></span><br><span class="line">  <span class="comment">//componentDidMount执行的时候就表示内存中的虚拟dom已经挂载到页面了，此时页面是最新的</span></span><br><span class="line">  <span class="comment">//只有componentDidMount()钩子函数才可以通过setState()来修改state</span></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="comment">//componentDidMount()方法允许我们通过setState()来修改状态</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      msg: <span class="string">"赵六"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"componentDidMount方法执行了"</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//-------------------------------组价的运行阶段-------------------------------</span></span><br><span class="line">  <span class="comment">//当前组件的状态发生改变之后，会进入组件的运行阶段</span></span><br><span class="line">  <span class="comment">//1.在组件运行阶段，第一个执行的函数是getDerivedStateFromProps</span></span><br><span class="line">  <span class="comment">// static getDerivedStateFromProps(nextProps: IProps, prevState: IState) &#123;</span></span><br><span class="line">  <span class="comment">//   console.log("getDerivedStateFromProps", nextProps, prevState)</span></span><br><span class="line">  <span class="comment">//   return null;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//2.在组件的运行阶段，第二个执行的函数是shouldComponentUpdate。(在组件的各种生命周期阶段中，执行&gt;=0次)</span></span><br><span class="line">  <span class="comment">//作用：让程序员手动控制是否要更新组件</span></span><br><span class="line">  <span class="comment">//如果这个方法返回false，就不会更新组件(后续的生命周期函数就不会执行了)；如果这个方法返回true，就会更新组件(后续的生命周期会执行)</span></span><br><span class="line">  shouldComponentUpdate(nextProps: IProps, <span class="attr">nextState</span>: IState) &#123;</span><br><span class="line">    <span class="comment">// shouldComponentUpdate() 方法中也不能通过setState()来更改state，此时仍然会进入死循环</span></span><br><span class="line">    <span class="comment">// this.setState(&#123;</span></span><br><span class="line">    <span class="comment">//     msg:"王五"</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"shouldComponentUpdate"</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//3.在组件的运行阶段，第三个执行的函数是render()函数</span></span><br><span class="line">  <span class="comment">//render()函数的作用：在内存中构建虚拟dom(此时虚拟dom还没有被挂载到页面)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//4.在组件的运行阶段，第四个执行的函数是getSnapshotBeforeUpdate。(在组件的各种生命周期阶段中，执行&gt;=0次)</span></span><br><span class="line">  <span class="comment">//主要作用：获取更新页面之前的dom信息</span></span><br><span class="line">  <span class="comment">//这个方法的返回值会作为componentDidUpdate()方法第三个参数入参  https://react.docschina.org/docs/react-component.html</span></span><br><span class="line">  getSnapshotBeforeUpdate() &#123;</span><br><span class="line">    <span class="comment">// getSnapshotBeforeUpdate() 方法中也不能通过setState()来更改state，此时仍然会进入死循环</span></span><br><span class="line">    <span class="comment">// this.setState(&#123;</span></span><br><span class="line">    <span class="comment">//     msg:"王五"</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"getSnapshotBeforeUpdate"</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">aa</span>: <span class="number">123</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//5.在组件的运行阶段，第五个执行的函数是componentDidUpdate。(在组件的各种生命周期阶段中，执行&gt;=0次)</span></span><br><span class="line">  <span class="comment">//主要作用：虚拟dom已经挂载到页面，此时页面是最新的</span></span><br><span class="line">  componentDidUpdate(prevProps: IProps, <span class="attr">prevState</span>: IState, <span class="attr">snapshot</span>: any) &#123;</span><br><span class="line">    <span class="comment">// componentDidUpdate() 方法中也不能通过setState()来更改state，此时仍然会进入死循环</span></span><br><span class="line">    <span class="comment">// this.setState(&#123;</span></span><br><span class="line">    <span class="comment">//     msg: "王五"</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"componentDidUpdate"</span>, snapshot)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//----------------------------组件的卸载阶段-----------------------------</span></span><br><span class="line">  <span class="comment">//可以在componentWillUnmount()方法中进行一些资源的释放工作。比如关闭定时器、移除事件监听。(卸载一个组件执行一次)</span></span><br><span class="line">  componentWillUnmount() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"componentWillUnmount"</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Counter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#App.jsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState, useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> Counter <span class="keyword">from</span> <span class="string">'./components4/Counter'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">count</span>: <span class="number">1</span> &#125;</span><br><span class="line">type IState = Readonly&lt;<span class="keyword">typeof</span> initialState&gt;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  readonly state: IState = initialState;</span><br><span class="line"></span><br><span class="line">  handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(<span class="function">(<span class="params">prev: IState</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        count: prev.count + <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      这是App组件</span></span><br><span class="line"><span class="xml">      &#123;/* <span class="tag">&lt;<span class="name">Counter</span> <span class="attr">initCount</span>=<span class="string">&#123;this.state.count&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">Counter</span>&gt;</span> */&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Counter</span>&gt;</span><span class="tag">&lt;/<span class="name">Counter</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>改变count<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>

<h2 id="6-3-组件的重新渲染和优化"><a href="#6-3-组件的重新渲染和优化" class="headerlink" title="6.3 组件的重新渲染和优化"></a>6.3 组件的重新渲染和优化</h2><h3 id="6-3-1-类组件的re-render的时机"><a href="#6-3-1-类组件的re-render的时机" class="headerlink" title="6.3.1 类组件的re-render的时机"></a>6.3.1 类组件的re-render的时机</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">什么时候触发类组件的re-render</span><br><span class="line">一：当类组件继承React.Component的时候</span><br><span class="line">1.当前组件中调用了setState会触发组件的re-render，不管当前组件的state有没有发生过变化(原理是setState内部会触发batchingUpdate)</span><br><span class="line">2.当父组件re-render的时候，父组件中的子组件也会re-render，不管父组件有没有给子组件传递过任何数据</span><br><span class="line">3.只要组件re-render的时候，有关于组件运行阶段的生命周期的钩子都会被触发(getDerivedStateFromProps\shouldComponentUpdate\render\getSnapshotBeforeUpdate\componentDidMount\componentDidUpdate)。</span><br><span class="line"></span><br><span class="line">二：当类组件继承React.PureComponent的时候</span><br><span class="line">1.当前组件调用了setState之后，只要state数据的内存地址发生变化，就会触发组件的re-render(不管state数据在页面有没有使用)</span><br><span class="line">2.当父组件re-render的时候，子组件不一定再re-render，而是要看父组件给子组件传递了props内存地址有没有发生变化(不管在子组件中有没有使用过父组件传递的props)</span><br><span class="line">3.只要组件re-render的时候，有关于组件运行阶段的生命周期的钩子都会被触发</span><br></pre></td></tr></table></figure>

<p>当组件继承React.Component的时候，我们在父组件修改了与子组件无关的state，而子组件没有用到这个状态，发现子组件也会re-render，这个时候就需要借助shouldComponentUpdate钩子函数来做优化。</p>
<p>我们通常的解决方案是：</p>
<blockquote>
<ol>
<li>使用immutable进行比较，在不相等的时候调用setState；</li>
<li>在shouldComponentUpdate中判断前后的props和state，如果没有变化，则返回false来阻止更新。</li>
<li>创建一个类继承PureComponent，判断页面是否要更新的时候进行浅比较</li>
</ol>
</blockquote>
<h3 id="6-3-2-shouldComponentUpdate优化"><a href="#6-3-2-shouldComponentUpdate优化" class="headerlink" title="6.3.2 shouldComponentUpdate优化"></a>6.3.2 shouldComponentUpdate优化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//作用：让程序员手动控制是否要更新组件</span></span><br><span class="line"><span class="comment">//如果这个方法返回false，就不会更新组件(后续的生命周期函数就不会执行了)；如果这个方法返回true，就会更新组件(后续的生命周期会执行)</span></span><br><span class="line">shouldComponentUpdate(nextProps: IProps, <span class="attr">nextState</span>: IState) &#123;</span><br><span class="line">    <span class="comment">//当下次传递过来的initCount为偶数的时候，不更新页面。为奇数的时候更新页面</span></span><br><span class="line">    <span class="keyword">if</span>(nextProps.initCount%<span class="number">2</span> == <span class="number">0</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-3-PureComponent优化"><a href="#6-3-3-PureComponent优化" class="headerlink" title="6.3.3 PureComponent优化"></a>6.3.3 PureComponent优化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ListOfWords.tsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">type IProps = Readonly&lt;&#123;</span><br><span class="line">  words: string[];</span><br><span class="line">&#125;&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承React.Component的时候，视图更新通过shouldComponentUpdate完成</span></span><br><span class="line"><span class="comment">// class ListOfWords extends React.Component&lt;IProps&gt; &#123;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 继承React.PureComponent的时候，视图更新通过数据源的内存地址判断完成</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListOfWords</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">PureComponent</span>&lt;<span class="title">IProps</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">// shouldComponentUpdate(nextProps: IProps) &#123;</span></span><br><span class="line">  <span class="comment">//   console.log(nextProps.words,"0000000000000000000000")</span></span><br><span class="line">  <span class="comment">//   return true;</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;console.log("render")&#125;</span></span><br><span class="line"><span class="xml">      &#123;this.props.words.join("-")&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ListOfWords</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//App.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC, useState, useRef &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ListOfWords <span class="keyword">from</span> <span class="string">'./components4/ListOfWords'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">words</span>: [<span class="string">'marklar'</span>] &#125;</span><br><span class="line">type IState = Readonly&lt;<span class="keyword">typeof</span> initialState&gt;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  readonly state: IState = initialState;</span><br><span class="line"></span><br><span class="line">  handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 当ListOfWords组件继承React.PureComponent的时候，下面的代码不会触发视图的刷新，因为当前的words虽然修改了，但总是引用同一块内存</span></span><br><span class="line">    <span class="comment">// this.setState((prev:IState)=&gt;&#123;</span></span><br><span class="line">    <span class="comment">//   prev.words.push("marklar")</span></span><br><span class="line">    <span class="comment">//   return &#123;</span></span><br><span class="line">    <span class="comment">//     words:prev.words</span></span><br><span class="line">    <span class="comment">//   &#125;</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//下面代码会触发ListOfWords视图更新，因为每次点击按钮都给words赋值一个新的数组，此时新数组和原来数组的内存地址肯定不一致，从而组件才可能更新</span></span><br><span class="line">    <span class="keyword">this</span>.setState(<span class="function">(<span class="params">prev:IState</span>)=&gt;</span>&#123;</span><br><span class="line">      prev.words.push(<span class="string">"marklar"</span>)</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        words:[...prev.words]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">      这是App组件</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">ListOfWords</span> <span class="attr">words</span>=<span class="string">&#123;this.state.words&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">ListOfWords</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;this.handleClick&#125;</span>&gt;</span>添加words<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1.继承Component时，数据源发生变化之后，会通过shouldComponentUpdate的返回值来判断页面是否需要刷新</span></span><br><span class="line"><span class="comment">2.继承PureComponent时，数据源发生变化之后，默认进行的是浅比较(只会比较数据的内存地址是否一致)，不能再重写shouldComponentUpdate</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h2 id="6-4-getDerivedStateFromProps存在的问题"><a href="#6-4-getDerivedStateFromProps存在的问题" class="headerlink" title="6.4 getDerivedStateFromProps存在的问题"></a>6.4 getDerivedStateFromProps存在的问题</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//getDerivedStateFromProps 函数会在每次re-rendering之前被调用</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//为什么要用getDerivedStateFromProps？答案：组件接收的props数据是只读的，我们可以使用该方法将传递的props映射到state里面，实现修改(会有诸多问题)</span></span><br><span class="line"><span class="comment">//注意点：该方法是一个静态方法，方法中没有this，故而不可以直接通过this.setState()来改变状态，而是需要通过return来改变状态</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//参数：</span></span><br><span class="line"><span class="comment">//1.nextProps外部传递过来的props属性</span></span><br><span class="line"><span class="comment">//2.prevState之前的state状态</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> getDerivedStateFromProps(nextProps, prevState) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"getDerivedStateFromProps"</span>, nextProps, prevState)</span><br><span class="line">    <span class="comment">//获取到父组件中传递过来的initcount值</span></span><br><span class="line">    <span class="keyword">const</span> &#123; initcount &#125; = nextProps;</span><br><span class="line">    <span class="comment">//当父组件中传递过来的initcount发生改变了</span></span><br><span class="line">    <span class="keyword">if</span> (initcount != prevState.prevCount) &#123;</span><br><span class="line">        <span class="comment">//在方法中返回&#123;count:initcount&#125; 替换掉当前state中的 count值</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            count: initcount,</span><br><span class="line">            prevCount:initcount</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果props传入的内容不需要影响到你的state，那么就需要返回一个null</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//问题：</span></span><br><span class="line"><span class="number">1.</span>当前组件的状态由多个源控制，父组件中控制列表数据，子组件中又控制了type这个state。</span><br><span class="line">因此父组件state改掉之后，会触发子组件重新渲染；本身组件state改掉之后，会触发当前组件重新渲染</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>如果你的组件内部既需要修改自己的type，又需要接收从外部修改的type。逻辑非常混乱！getDerivedStateFromProps中你根本不知道该做什么。</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (initcount != prevState.prevCount) &#123;</span><br><span class="line">    <span class="comment">//在方法中返回&#123;count:initcount&#125; 替换掉当前state中的 count值</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        count: initcount,</span><br><span class="line">        prevCount:initcount</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">如果彻底解决这个问题呢？</span><br><span class="line">答案：好好组织你的组件，在非必须的时候，摒弃这种写法(派生属性)。type要么由props驱动，要么完全由state驱动。</span><br><span class="line"></span><br><span class="line">从这个生命周期的更新来看，react更希望将受控的props和state进行分离，就如同Redux作者Dan Abramov在redux文档当中写的一样Presentational and Container Components，将所有的组件分离称为展示型组件和容器型组件，一个只负责接收props来改变自己的样式，一个负责保持其整个模块的state。这样可以让代码更加清晰。但是在实际的业务逻辑中，我们有时很难做到这一点，而且这样可能会导致容器型组件变得非常庞大以致难以管理，如何进行取舍还是需要根据实际场景决定的</span><br></pre></td></tr></table></figure>

<h2 id="6-5-React老版本生命周期"><a href="#6-5-React老版本生命周期" class="headerlink" title="6.5 React老版本生命周期"></a>6.5 React老版本生命周期</h2><p><img src= "/img/loading.gif" data-src="./assets/3284159097-5bbb08d17db33_articlex-1584956954768.png" alt="3284159097-5bbb08d17db33_articlex"></p>
<h1 id="7-函数组件的生命周期"><a href="#7-函数组件的生命周期" class="headerlink" title="7.函数组件的生命周期"></a>7.函数组件的生命周期</h1><h2 id="7-1-useEffect介绍"><a href="#7-1-useEffect介绍" class="headerlink" title="7.1 useEffect介绍"></a>7.1 useEffect介绍</h2><p><code>useEffect</code> 就是一个 Effect Hook，给函数组件增加了操作副作用的能力。它跟 class 组件中的 <code>componentDidMount</code>、<code>componentDidUpdate</code> 和 <code>componentWillUnmount</code> 具有相同的用途，只不过被合并成了一个 API。</p>
<p>在调用这个hook时，就是告诉React在完成对DOM的更改后运行这个hook，在这里你可以访问到state和props。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- 纯函数：如果函数的调用参数相同，则永远返回相同的结果。它不依赖于程序执行期间函数外部任何状态或数据的变化，必须只依赖于其输入参数。</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">priceAfterTax</span>(<span class="params">productPrice</span>) </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> (productPrice * <span class="number">0.20</span>) + productPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">- 副作用：一个可以被观察的副作用是在函数内部与其外部的任意交互。这可能是在函数内修改外部的变量，或者在函数里调用另外一个函数等。</span><br><span class="line">    <span class="keyword">var</span> tax = <span class="number">20</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">calculateTax</span>(<span class="params">productPrice</span>) </span>&#123;</span><br><span class="line">        tax = tax/<span class="number">100</span></span><br><span class="line">        <span class="keyword">return</span> (productPrice * tax) + productPrice;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="7-2-useEffect用法"><a href="#7-2-useEffect用法" class="headerlink" title="7.2 useEffect用法"></a>7.2 useEffect用法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1  componentDidMount执行一次，依赖项每次改变时执行一次</span></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">//副作用动作</span></span><br><span class="line">&#125;,[依赖项])</span><br><span class="line"></span><br><span class="line"><span class="comment">//2  相当于componentDidMount</span></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">//副作用动作</span></span><br><span class="line">&#125;,[])</span><br><span class="line"></span><br><span class="line"><span class="comment">//3  相当于componentDidMount 、componentDidUpdate</span></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">//副作用动作</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="7-3-useEffect使用"><a href="#7-3-useEffect使用" class="headerlink" title="7.3 useEffect使用"></a>7.3 useEffect使用</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line">type IProps = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Demo2: FC&lt;IProps&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//count代表state的变量</span></span><br><span class="line">  <span class="comment">//setCount是一个function，如果我们要修改count变量，需要通过setCount来修改</span></span><br><span class="line">  <span class="keyword">let</span> [count, setCount] = useState&lt;number&gt;(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">let</span> [count2, setCount2] = useState&lt;number&gt;(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//useEffect函数可以来模拟class组件的中指定生命周期的钩子函数 componentDidMount，componentDidUpdate，componentWillUnmount</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//相当于componentDidMount 、componentDidUpdate</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"xxxxxxxxxxx"</span>, count)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//相当于componentDidMount</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"yyyyyyyyy"</span>)</span><br><span class="line">  &#125;, [])</span><br><span class="line"></span><br><span class="line">  <span class="comment">//相当于componentDidMount 和 当count2的值被改变之后执行当前的useEffect</span></span><br><span class="line">  <span class="comment">//其他值改变不会执行这个useEffect</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"zzzzzzzzzzzzz"</span>)</span><br><span class="line">  &#125;, [count2])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    count的值是：&#123;count&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; setCount(++count) &#125;&#125;&gt;点我修改count<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    count2的值是:&#123;count2&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> &#123; setCount2(++count2) &#125;&#125;&gt;点我修改count2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Demo2;</span><br></pre></td></tr></table></figure>

<h2 id="7-4-清除副作用"><a href="#7-4-清除副作用" class="headerlink" title="7.4 清除副作用"></a>7.4 清除副作用</h2><h3 id="a-无需清理的副作用"><a href="#a-无需清理的副作用" class="headerlink" title="a) 无需清理的副作用"></a>a) 无需清理的副作用</h3><blockquote>
<p>有时候，我们只想<strong>在 React 更新 DOM 之后运行一些额外的代码。</strong>比如发送网络请求，手动变更 DOM，记录日志，这些都是常见的无需清除的操作。因为我们在执行完这些操作之后，就可以忽略他们了。</p>
</blockquote>
<p>需求：监听url的变化来发送网络请求，保存返回结果</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC, useState, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> ajax <span class="keyword">from</span> <span class="string">'@utils/ajax'</span></span><br><span class="line"></span><br><span class="line">type IProps = &#123;</span><br><span class="line">  location:string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Example: FC&lt;IProps&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [data, setData] = useState(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    getData();</span><br><span class="line">  &#125;, [props.location]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> getData = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ajax.post().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">      setData(res);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;data&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Example;</span><br></pre></td></tr></table></figure>

<p>当location发生变化时，useEffect中函数就会自动执行</p>
<h3 id="b-需要清理的副作用"><a href="#b-需要清理的副作用" class="headerlink" title="b) 需要清理的副作用"></a>b) 需要清理的副作用</h3><blockquote>
<p>之前我们研究了如何使用不需要清除的副作用，还有一些副作用是需要清除的。例如<strong>定时器</strong>、<strong>订阅外部数据源</strong>。这种情况下，清除工作是非常重要的，可以防止引起内存泄露！</p>
</blockquote>
<p>在useEffect中可选的返回一个清除函数，该清除函数会在组件<strong>卸载</strong>时自动执行，以达到清除effect的目的；</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//useEffect函数中return的function会在组件卸载时自动执行</span></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//副作用动作</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//清除effect</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>使用示例</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"useEffect在组件挂载和更新的时候执行"</span>)</span><br><span class="line">        <span class="keyword">let</span> timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"定时器打印"</span>)</span><br><span class="line">        &#125;, <span class="number">1000</span>);</span><br><span class="line">        <span class="comment">//如果useEffect的function中返回了一个函数，那么该函数会在组件卸载的时候执行</span></span><br><span class="line">        <span class="comment">//就相当于componentWillUnMount</span></span><br><span class="line">        <span class="comment">//现在每一次重新渲染都会返回一个新的清除函数，把上一次组件装在执行的定时器清除掉(这边由于闭包的原因，之前的定时器以及一些变量都会被释放)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">()</span>=&gt;</span>&#123;  </span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"清除定时器"</span>)  </span><br><span class="line">            timer &amp;&amp; clearInterval(timer)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="c-useEffect返回清除函数的执行时机"><a href="#c-useEffect返回清除函数的执行时机" class="headerlink" title="c) useEffect返回清除函数的执行时机"></a>c) useEffect返回清除函数的执行时机</h3><p>这里是组件<strong>卸载</strong>时自动执行，当前状态下的函数组件render完之后会立即执行上一个函数状态中<code>useEffect</code>返回的清除函数，而这个清除函数中所带的参数也是处于上一个状态中（闭包的特性）。</p>
<p><a href="https://segmentfault.com/a/1190000018639033" target="_blank" rel="noopener">https://segmentfault.com/a/1190000018639033</a></p>
<blockquote>
<p>假设在组件的使用过程中，外部传入的props参数id，改变了两次，第一次传入<code>id: 1</code>， 第二次传入<code>id: 2</code></p>
<p>那么我们来梳理一下整个过程：</p>
<ol>
<li>传入<code>props.id = 1</code></li>
<li>组件渲染</li>
<li>DOM渲染完成，useEffect逻辑执行，返回清除副作用函数<code>clear，</code>命名为<code>clear1</code></li>
<li>传入<code>props.id = 2</code></li>
<li>组件渲染</li>
<li>组件渲染完成，clear1执行</li>
<li>useEffect逻辑执行，返回另一个clear函数，命名为<code>clear2</code></li>
<li>组件卸载，clear2执行</li>
</ol>
<p>执行过程有点绕，因为与你印象中的执行过程似乎不一样。其实关键的地方就在于clear函数的执行，它的特征如下：</p>
<ul>
<li>每次useEffect执行，都会返回一个新的clear函数</li>
<li>clear函数会在下一次useEffect逻辑之前执行（DOM渲染完成之后）</li>
<li>组件卸载也会执行一次</li>
</ul>
</blockquote>
<h2 id="7-5-useLayoutEffect"><a href="#7-5-useLayoutEffect" class="headerlink" title="7.5 useLayoutEffect"></a>7.5 useLayoutEffect</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useLayoutEffect( <span class="function"><span class="params">()</span> =&gt;</span> &#123; &#125;, [ 依赖项 ] );</span><br></pre></td></tr></table></figure>

<p>其函数签名与 <code>useEffect</code> 相同，但它会在所有的 DOM 变更之后<strong>同步调用</strong> effect。可以使用它来读取 DOM 布局并同步触发重渲染。</p>
<p>这个是用在处理DOM的时候，当你的useEffect里面的操作需要处理DOM。并且会改变页面的样式，就需要用这个，否则可能会出现出现闪屏问题</p>
<p><a href="https://cllxx.cn/2019/07/21/react-xin-te-xing-hooks-zhi-useeffect-he-uselayouteffect-wu/" target="_blank" rel="noopener">https://cllxx.cn/2019/07/21/react-xin-te-xing-hooks-zhi-useeffect-he-uselayouteffect-wu/</a></p>
<blockquote>
<p>useEffect和useLayoutEffect的异同：</p>
<ul>
<li>useLayoutEffect是在虚拟DOM构建完成后立即执行，useEffect是在真实DOM构建完成后立即执行</li>
</ul>
<ul>
<li>useLayoutEffect是同步执行，useEffect是异步执行</li>
</ul>
</blockquote>
<h2 id="7-6-useEffect使用注意点"><a href="#7-6-useEffect使用注意点" class="headerlink" title="7.6 useEffect使用注意点"></a>7.6 useEffect使用注意点</h2><p>useEffect的函数需要返回一个cleanup的清除函数或者undefined。而当我们使用await、async的时候，会默认返回一个Promise，所以我们不能在useEffect函数中使用async</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//错误</span></span><br><span class="line">useEffect(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">     <span class="keyword">await</span> fetchSomething();</span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="comment">//正确</span></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    (<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> fetchSomething();</span><br><span class="line">    &#125;)();</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>

<h1 id="8-其他常用hook"><a href="#8-其他常用hook" class="headerlink" title="8.其他常用hook"></a>8.其他常用hook</h1><h2 id="8-1-函数组件re-render的时机"><a href="#8-1-函数组件re-render的时机" class="headerlink" title="8.1 函数组件re-render的时机"></a>8.1 函数组件re-render的时机</h2><blockquote>
<ol>
<li>组件重新被创建</li>
<li>当前组件state的内存地址发生了变化，无论dom中是否使用了state</li>
<li>父组件更新，子组件也会自动的更新</li>
<li>组件更新时，会卸载所有function，并重新创建function (执行函数组件的所有逻辑)</li>
</ol>
</blockquote>
<p>也就是说，在函数组件中，只要父组件或者当前组件的state内存地址发生变化，都会触发当前组件以及当前组件的子组件re-render，无论当前组件是否使用到父组件中的state。</p>
<p>而在函数组件中，react不再区分mount和update两个状态，这意味着函数组件的每一次调用都会执行其内部的所有逻辑，那么会带来较大的性能损耗。因此useMemo 和useCallback就是解决性能问题的杀手锏。</p>
<h2 id="8-2-memo-useMemo-useCallback"><a href="#8-2-memo-useMemo-useCallback" class="headerlink" title="8.2 memo\useMemo\useCallback"></a>8.2 memo\useMemo\useCallback</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Child.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Child: FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;date.toLocaleString()&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Child;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Parent.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC,useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">"./Child"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent:FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count,setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;数量为:&#123;count&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;()=&gt;&#123;setCount(count+1)&#125;&#125;&gt;点我加1&lt;/</span>button&gt;</span><br><span class="line">      &lt;Child&gt;&lt;<span class="regexp">/Child&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Parent;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//index.tsx</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">Parent</span>&gt;</span><span class="tag">&lt;/<span class="name">Parent</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//案例存在的问题：每点击一次按钮，会重新渲染一次时间，说明父组件更新的时候，子组件也重新渲染了</span></span><br></pre></td></tr></table></figure>

<h3 id="8-2-1-使用memo高阶函数"><a href="#8-2-1-使用memo高阶函数" class="headerlink" title="8.2.1 使用memo高阶函数"></a>8.2.1 使用memo高阶函数</h3><p><code>React.memo()</code>是一个高阶函数，它与 <a href="https://reactjs.org/docs/react-api.html#reactpurecomponent" target="_blank" rel="noopener"><code>React.PureComponent</code></a>类似，是一个函数组件而非一个类。</p>
<p>React.memo()可接受2个参数，第一个参数为纯函数的组件，第二个参数用于对比props控制是否刷新，与<a href="https://reactjs.org/docs/react-component.html#shouldcomponentupdate" target="_blank" rel="noopener"><code>shouldComponentUpdate()</code></a>功能类似</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Child.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC,memo &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Child: FC&lt;&#123;count?:number&#125;&gt; = memo(<span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;date.toLocaleString()&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;,(prev,next) =&gt; &#123; <span class="built_in">console</span>.log(prev.count,next.count); <span class="keyword">return</span> prev.count==next.count &#125;);</span><br><span class="line"> <span class="comment">//这边只要父亲传递给孩子的props发生了变化就应该刷新子组件(如果父亲没有给子组件传递props或者父亲给子组件传递的props没有改变，则子组件不应该刷新)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Child;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Parent.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC,useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">"./Child"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent:FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count,setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;数量为:&#123;count&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;()=&gt;&#123;setCount(count+1)&#125;&#125;&gt;点我加1&lt;/</span>button&gt;</span><br><span class="line">      &lt;Child count=&#123;count&#125;&gt;&lt;<span class="regexp">/Child&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Parent;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-2-useMemo"><a href="#8-2-2-useMemo" class="headerlink" title="8.2.2 useMemo"></a>8.2.2 useMemo</h3><h4 id="a-没有使用useMemo存在的问题"><a href="#a-没有使用useMemo存在的问题" class="headerlink" title="a) 没有使用useMemo存在的问题"></a>a) 没有使用useMemo存在的问题</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Parent.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">"./Child"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent: FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> obj = &#123;</span><br><span class="line">    name: <span class="string">"zhangsan"</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;数量为:&#123;count&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button</span></span><br><span class="line"><span class="regexp">        onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          setCount(count + 1);</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">      &gt;</span></span><br><span class="line"><span class="regexp">        点我加1</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">      &lt;Child obj=&#123;obj&#125;&gt;&lt;<span class="regexp">/Child&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Parent;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Child.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, memo &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Child: FC&lt;&#123; <span class="attr">obj</span>: &#123; name?: string &#125; &#125;&gt; = memo(</span><br><span class="line">  (props) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;date.toLocaleString()&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">  &#125;,</span><br><span class="line">  (prev, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> prev.obj == next.obj;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Child;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//案例存在的问题：每点击一次按钮，会重新渲染一次时间，但是每一次点击按钮的时候，父组件给子组件传递的都是相同的obj对象，为什么子组件还是会刷新呢?</span></span><br><span class="line"><span class="comment">//原因是每一次点击按钮的时候，会重新刷新父组件，父组件中的obj会重新被实例化，所以新实例化的obj和上一次实例化的obj不是同一个对象</span></span><br></pre></td></tr></table></figure>

<h4 id="b-useMemo-hook"><a href="#b-useMemo-hook" class="headerlink" title="b) useMemo hook"></a>b) useMemo hook</h4><p>useMemo可以用来缓存一些变量，并指定哪些条件变化后重新计算缓存的变量。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> memoizedValue = useMemo(<span class="function"><span class="params">()</span> =&gt;</span> computeExpensiveValue(a, b), [a, b]);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>useMemo第一个参数是一个 factory 函数，该函数的返回结果会通过useMemo缓存下来</p>
<p>​                  第二个参数是factory函数的依赖(deps)，当依赖(deps)改变时才重新执行 factory 函数，memoizedValue 才会被重新计算</p>
</blockquote>
<p>也就是在依赖未改变时（或空数组无依赖时），memoizedValue 总是返回通过useMemo缓存的值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Parent.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState,useMemo &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">"./Child"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent: FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="comment">//使用useMemo缓存变量值  依赖项没有指定</span></span><br><span class="line">  <span class="keyword">const</span> obj = useMemo(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      name: <span class="string">"zhangsan"</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,[])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;数量为:&#123;count&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button</span></span><br><span class="line"><span class="regexp">        onClick=&#123;() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">          setCount(count + 1);</span></span><br><span class="line"><span class="regexp">        &#125;&#125;</span></span><br><span class="line"><span class="regexp">      &gt;</span></span><br><span class="line"><span class="regexp">        点我加1</span></span><br><span class="line"><span class="regexp">      &lt;/</span>button&gt;</span><br><span class="line">      &lt;Child obj=&#123;obj&#125;&gt;&lt;<span class="regexp">/Child&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Parent;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-3-useCallback"><a href="#8-2-3-useCallback" class="headerlink" title="8.2.3 useCallback"></a>8.2.3 useCallback</h3><h4 id="a-没有使用useCallback的问题"><a href="#a-没有使用useCallback的问题" class="headerlink" title="a) 没有使用useCallback的问题"></a>a) 没有使用useCallback的问题</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Parent.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState,useMemo &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">"./Child"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent: FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [text,setText] = useState(<span class="string">""</span>)</span><br><span class="line">  <span class="keyword">const</span> changeHandler = <span class="function">(<span class="params">event:React.ChangeEvent&lt;HTMLInputElement&gt;</span>)=&gt;</span>&#123;</span><br><span class="line">    setText(event.target.value)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;text文本为:&#123;text&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Child onChange=&#123;changeHandler&#125;&gt;&lt;/</span>Child&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Parent;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/Child.tsx</span></span><br><span class="line"><span class="regexp">import React, &#123; FC, memo &#125; from "react";</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const Child: FC&lt;&#123;</span></span><br><span class="line"><span class="regexp">  onChange?: (event: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; void;</span></span><br><span class="line"><span class="regexp">&#125;&gt; = memo((props) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  const date = new Date();</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;div&gt;</span></span><br><span class="line"><span class="regexp">      &#123;date.toLocaleString()&#125;</span></span><br><span class="line"><span class="regexp">      &lt;input type="text" onChange=&#123;props.onChange&#125;&gt;&lt;/i</span>nput&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Child;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/上面代码中，我们在子组件中修改文本框的值，会触发子组件的onChange，从而触发父组件的changeHandler方法，在父组件中的changeHandler方法中修改了text文本，所以页面上的text值发生了改变。 </span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/但是除了我们发现页面上text文本改变之外，子组件中的时间也发生了改变 (说明每一次子组件输入内容的时候都会触发子组件的重新渲染)</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/原因是每一次子组件输入内容，父组件的text文本发生变化，造成父组件被重新渲染，从而造成父组件传递给子组件的changeHandler方法(props)发生了变化，从而造成子组件的重新渲染</span></span><br></pre></td></tr></table></figure>

<h4 id="b-useCallback-hook"><a href="#b-useCallback-hook" class="headerlink" title="b) useCallback   hook"></a>b) useCallback   hook</h4><p>useMemo缓存的是值</p>
<p>useCallback缓存的是函数。有两个参数，第一个参数是需要缓存的函数，第二个参数是依赖项。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Parent.tsx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useState,useCallback &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">"./Child"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent: FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [text,setText] = useState(<span class="string">""</span>)</span><br><span class="line">  <span class="comment">//使用useCallback缓存函数</span></span><br><span class="line">  <span class="keyword">const</span> changeHandler = useCallback(<span class="function">(<span class="params">event:React.ChangeEvent&lt;HTMLInputElement&gt;</span>)=&gt;</span>&#123;</span><br><span class="line">    setText(event.target.value)</span><br><span class="line">  &#125;,[])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;text文本为:&#123;text&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Child onChange=&#123;changeHandler&#125;&gt;&lt;/</span>Child&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Parent;</span></span><br></pre></td></tr></table></figure>

<h3 id="8-2-4-useMemo和useCallback的区别和联系"><a href="#8-2-4-useMemo和useCallback的区别和联系" class="headerlink" title="8.2.4 useMemo和useCallback的区别和联系"></a>8.2.4 useMemo和useCallback的区别和联系</h3><p>实际上<code>useCallback</code>是基于<code>useMemo</code>实现的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useCallback</span>(<span class="params">callback, args</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> useMemo(<span class="function"><span class="params">()</span> =&gt;</span> callback, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>useMemo</code>是返回<code>callback</code>执行后的结果</li>
<li><code>useCallback</code> 是直接返回被<code>useMemo</code>修饰的<code>callback</code>函数</li>
</ol>
<h2 id="8-3-useReducer和useContext"><a href="#8-3-useReducer和useContext" class="headerlink" title="8.3 useReducer和useContext"></a>8.3 useReducer和useContext</h2><h3 id="8-3-1-useContext"><a href="#8-3-1-useContext" class="headerlink" title="8.3.1 useContext"></a>8.3.1 useContext</h3><blockquote>
<p>跨级组件通信，实现同一子树下所有节点可统一共享子树根节点的数据</p>
</blockquote>
<p>useContext接收一个 context 对象（<code>React.createContext</code> 的返回值）并返回该 context 的当前值。当前的 context 值由上层组件中距离当前组件最近的 <code>&lt;MyContext.Provider&gt;</code> 的 <code>value</code> 决定。</p>
<p>当组件上层最近的 <code>&lt;MyContext.Provider&gt;</code> 更新时，该 Hook 会触发重渲染，并使用最新传递给 <code>MyContext</code> provider 的 context <code>value</code> 值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = useContext(MyContext);</span><br></pre></td></tr></table></figure>

<p>基本用法：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#1.index.jsx</span><br><span class="line"><span class="keyword">import</span> MyContext <span class="keyword">from</span> <span class="string">'./context.js'</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">MyContext.Provider</span> <span class="attr">value</span>=<span class="string">&#123;&#123;name:</span>"<span class="attr">zhangsan</span>"&#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">Parent</span>&gt;</span><span class="tag">&lt;/<span class="name">Parent</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">MyContext.Provider</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#2.context.js</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">let</span> context = createContext&lt;&#123; <span class="attr">name</span>: string &#125;&gt;(&#123; <span class="attr">name</span>: <span class="string">""</span> &#125;);</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyContext;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#3.Parent.jsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC,useContext &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> MyContext <span class="keyword">from</span> <span class="string">'../context.js'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent: FC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//在子组件中获取根组件暴露的数据</span></span><br><span class="line">  <span class="keyword">const</span> contextValue = useContext(MyContext);</span><br><span class="line">  <span class="built_in">console</span>.log(contextValue)</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;div&gt;text文本为:&#123;contextValue.name&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Parent;</span><br></pre></td></tr></table></figure>

<h3 id="8-3-2-useReducer"><a href="#8-3-2-useReducer" class="headerlink" title="8.3.2 useReducer"></a>8.3.2 useReducer</h3><h4 id="a-redux介绍"><a href="#a-redux介绍" class="headerlink" title="a) redux介绍"></a>a) redux介绍</h4><p>Redux是SPA单页面应用程序中多个组件之间共享数据的一种方式。</p>
<p><img src= "/img/loading.gif" data-src="D:%5C%E5%89%8D%E7%AB%AF%E5%A4%87%E8%AF%BE%5C17.REACT%5Creadme%5Cassets%5C1602462149160.png" alt="1602462149160"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- store：共享的state数据。</span><br><span class="line">- reducers：纯函数，用于修改state，由action触发。</span><br><span class="line">- action：一个对象，是 reducers的触发器，通过dispatch来触发，action对象需要有type字段</span><br><span class="line">- dispatch：派发器， dispatch函数接受一个action对象作为入参。action对象需要有type字段</span><br></pre></td></tr></table></figure>

<h4 id="b-useReducer"><a href="#b-useReducer" class="headerlink" title="b) useReducer"></a>b) useReducer</h4><p>useReducer是在函数组件中实现类似 Redux 功能的一个Hook。他接收两个参数，第一个参数是一个recuder(纯函数)，第二个参数是state的初始值。</p>
<p>他返回一个状态 state和 dispath，state是返回状态中的值，而 dispatch 是一个可以发布事件来更新 state 的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// reducer 纯函数，用于修改state</span></span><br><span class="line"><span class="comment">// initialArg 初始化的state状态</span></span><br><span class="line"><span class="comment">// init 一个函数用于惰性计算state初始值</span></span><br><span class="line"><span class="comment">// state 获取state数据</span></span><br><span class="line"><span class="comment">// dispatch 派发器，用于接收一个action来触发reducer，从而修改state</span></span><br><span class="line"><span class="keyword">const</span> [state, dispatch] = useReducer(reducer, initialArg, init);</span><br></pre></td></tr></table></figure>

<h3 id="8-3-3-useReducer和useContext-了解"><a href="#8-3-3-useReducer和useContext-了解" class="headerlink" title="8.3.3 useReducer和useContext(了解)"></a>8.3.3 useReducer和useContext(了解)</h3><p>在函数组件中，useReducer和useContext结合使用的时候可以提供类似Vuex那样的全局状态管理</p>
<p>useContext负责向子孙组件暴露数据</p>
<p>useReducer提供全局的state、reducers、dispatch等 (useReducer必须要在函数组件中才能使用，所以这边得把代码放到App.tsx中)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line">#1.index.tsx</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span>&gt;</span><span class="tag">&lt;/<span class="name">App</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))</span><br><span class="line">                </span><br><span class="line">#2.App.tsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; useContext, useReducer &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./App.css"</span>;</span><br><span class="line"><span class="keyword">import</span> Parent4 <span class="keyword">from</span> <span class="string">"./components4/Parent4"</span>;</span><br><span class="line"><span class="keyword">import</span> MyContext4, &#123; ActionType &#125; <span class="keyword">from</span> <span class="string">"./components4/MyContext4"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//reducer是一个纯函数，可以将action的变化转换为state的变化</span></span><br><span class="line"><span class="comment">//所以reducer纯函数需要接收一个action</span></span><br><span class="line"><span class="keyword">const</span> reducer = <span class="function"><span class="keyword">function</span> (<span class="params">state = <span class="number">0</span>, action: ActionType</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//根据action的type来修改state</span></span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"ADD"</span>:</span><br><span class="line">      <span class="keyword">return</span> state + <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"SUB"</span>:</span><br><span class="line">      <span class="keyword">return</span> state - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">"ADDN"</span>:</span><br><span class="line">      <span class="keyword">if</span> (action.step) &#123;</span><br><span class="line">        <span class="keyword">let</span> num = action.step.num;</span><br><span class="line">        <span class="keyword">return</span> state + num;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//useContext的作用是给子孙组件提供数据</span></span><br><span class="line"><span class="comment">//useReducer的作用提供全局的状态管理</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> [count = <span class="number">0</span>, dispatch] = useReducer(reducer, <span class="number">10</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;MyContext4.Provider value=&#123;[count, dispatch]&#125;&gt;</span><br><span class="line">      &lt;Parent4&gt;&lt;<span class="regexp">/Parent4&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>MyContext4.Provider&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#3.Parent.tsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC, useContext &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Child4 <span class="keyword">from</span> <span class="string">"./Child4"</span>;</span><br><span class="line"><span class="keyword">import</span> MyContext4 <span class="keyword">from</span> <span class="string">"./MyContext4"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Parent4: FC = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> [count,dispatch] = useContext(MyContext4);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> clickHandler1 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//通过派发器来接收一个action，从而触发reducer的执行，会根据对应的action执行对应的数据修改逻辑</span></span><br><span class="line">    dispatch(&#123;</span><br><span class="line">      type: <span class="string">"ADD"</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> clickHandler2 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    dispatch(&#123;</span><br><span class="line">      type: <span class="string">"SUB"</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> clickHandler3 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    dispatch(&#123;</span><br><span class="line">      type: <span class="string">"ADDN"</span>,</span><br><span class="line">      step: &#123;</span><br><span class="line">        num: <span class="number">5</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h3&gt;Parent组件&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">      &lt;p&gt;当前count : &#123;count&#125;&lt;/</span>p&gt;</span><br><span class="line">      &lt;button onClick=&#123;clickHandler1&#125;&gt;点我+<span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button onClick=&#123;clickHandler2&#125;&gt;点我-1&lt;/</span>button&gt;</span><br><span class="line">      &lt;button onClick=&#123;clickHandler3&#125;&gt;点我+<span class="number">5</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Child4&gt;&lt;/</span>Child4&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Parent4;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">#4.Child.tsx</span></span><br><span class="line"><span class="regexp">import React, &#123; FC, useContext &#125; from "react";</span></span><br><span class="line"><span class="regexp">import MyContext4 from "./</span>MyContext4<span class="string">";</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const Child4: FC = (props) =&gt; &#123;</span></span><br><span class="line"><span class="string">  let [count, dispatch] = useContext(MyContext4);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  const clickHandler = ()=&gt;&#123;</span></span><br><span class="line"><span class="string">    dispatch(&#123;</span></span><br><span class="line"><span class="string">      type:"</span>ADD<span class="string">"</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  return (</span></span><br><span class="line"><span class="string">    &lt;div&gt;</span></span><br><span class="line"><span class="string">      &lt;h3&gt;Child子组件&lt;/h3&gt;</span></span><br><span class="line"><span class="string">      &lt;p&gt;当前数量&#123;count&#125;&lt;/p&gt;</span></span><br><span class="line"><span class="string">      &lt;button onClick=&#123;clickHandler&#125;&gt;点我修改数量&lt;/button&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  );</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default Child4;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">#5.MyContext.tsx</span></span><br><span class="line"><span class="string">//创建一个上下文对象，该对象会在useContext中使用到</span></span><br><span class="line"><span class="string">import &#123; createContext, Dispatch, ReducerAction &#125; from "</span>react<span class="string">";</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//声明Action的泛型</span></span><br><span class="line"><span class="string">export type ActionType = &#123;</span></span><br><span class="line"><span class="string">  type: string;</span></span><br><span class="line"><span class="string">  step?: &#123;</span></span><br><span class="line"><span class="string">    num: number;</span></span><br><span class="line"><span class="string">  &#125;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//声明Context的泛型</span></span><br><span class="line"><span class="string">type ContextType = [</span></span><br><span class="line"><span class="string">  number,</span></span><br><span class="line"><span class="string">  Dispatch&lt;ActionType&gt;</span></span><br><span class="line"><span class="string">];</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//创建一个context上下文，并导出</span></span><br><span class="line"><span class="string">let context = createContext&lt;ContextType&gt;([0,()=&gt;&#123;&#125;])</span></span><br><span class="line"><span class="string">export default context;</span></span><br></pre></td></tr></table></figure>

<p>useReducer和useContext的出现并不是为了取代redux，redux是独立于任何第三方库，redux有优秀的中间件(异步数据流、debug)。当状态比较简单的时候，我们可以使用useReducer和useContext来实现组件之间的数据共享，但是当状态变得特别复杂的时候，建议使用redux。</p>
<h2 id="8-4-Hook的规则"><a href="#8-4-Hook的规则" class="headerlink" title="8.4 Hook的规则"></a>8.4 Hook的规则</h2><h3 id="8-4-1-只在组件顶层中使用Hook"><a href="#8-4-1-只在组件顶层中使用Hook" class="headerlink" title="8.4.1 只在组件顶层中使用Hook"></a>8.4.1 只在组件顶层中使用Hook</h3><blockquote>
<p><strong>不要在循环，条件或嵌套函数中调用 Hook，</strong> 确保总是在你的 React 函数的最顶层调用他们。遵守这条规则，你就能确保 Hook 在每一次渲染中都按照同样的顺序被调用。这让 React 能够在多次的 <code>useState</code> 和 <code>useEffect</code> 调用之间保持 hook 状态的正确。</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Example</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>); <span class="comment">//Yes</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(props.id)&#123;</span><br><span class="line">        <span class="comment">// const [count, setCount] = useState(0); //No</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">   	<span class="keyword">const</span> fn = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// const [count, setCount] = useState(0); //No</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-4-2-只在React-函数中调用Hook"><a href="#8-4-2-只在React-函数中调用Hook" class="headerlink" title="8.4.2 只在React 函数中调用Hook"></a>8.4.2 只在React 函数中调用Hook</h3><blockquote>
<p><strong>不要在普通的 JavaScript 函数中调用 Hook。</strong>你可以：</p>
<ul>
<li>在 React 的函数组件中调用 Hook</li>
<li>在自定义 Hook 中调用其他 Hook</li>
<li>在class组件中不能使用Hook</li>
</ul>
<p>遵循此规则，确保组件的状态逻辑在代码中清晰可见。</p>
</blockquote>
<h2 id="8-5-Hook参照文章："><a href="#8-5-Hook参照文章：" class="headerlink" title="8.5 Hook参照文章："></a>8.5 Hook参照文章：</h2><ol>
<li><a href="https://react-1251415695.cos-website.ap-chengdu.myqcloud.com/docs/getting-started.html" target="_blank" rel="noopener">React官方文档</a></li>
<li><a href="https://blog.csdn.net/sinat_17775997/article/details/94453167" target="_blank" rel="noopener">useMemo与useCallback使用指南</a></li>
<li><a href="https://blog.csdn.net/gtLBTNq9mr3/article/details/93984397" target="_blank" rel="noopener">useReducerde使用和原理</a></li>
<li><a href="https://segmentfault.com/a/1190000021133222" target="_blank" rel="noopener">五个大型项目实践总结，解密React Hooks最佳实践</a></li>
<li><a href="https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/" target="_blank" rel="noopener">useEffect完整指南</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/88135310" target="_blank" rel="noopener">一文彻底搞懂 react hooks 的原理和实现</a></li>
<li><a href="https://www.jianshu.com/p/b9ac8fa849f1" target="_blank" rel="noopener">React Hooks的原理</a></li>
</ol>
<h1 id="9-React-router"><a href="#9-React-router" class="headerlink" title="9. React-router"></a>9. React-router</h1><h2 id="9-1-前端路由的两种实现方案"><a href="#9-1-前端路由的两种实现方案" class="headerlink" title="9.1 前端路由的两种实现方案"></a>9.1 前端路由的两种实现方案</h2><ol>
<li><p>hash : hash原本的作用是为一个很长的文档页添加锚点信息，它自带不改变url刷新页面的功能，所以自然而然被用单页面应用程序中了。</p>
</li>
<li><p>history : 应该说history是主流的解决方案，浏览器的前进后退用的就是这个，它是window对象下的，以前的history提供的方法只能做页面之间的前进后退，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">history.go(number|URL) 可加载历史列表中的某个具体的页面</span><br><span class="line">history.forward() 可加载历史列表中的下一个 URL</span><br><span class="line">history.back() 可加载历史列表中的前一个 URL</span><br></pre></td></tr></table></figure>

<p>为了在不刷新浏览器的情况下，创建新的浏览记录并插入浏览记录队列中，html5新增了如下方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. history.pushState(state, title, url)</span><br><span class="line">   添加一条历史记录， state用于传递参数，可以为空。title是设置历史记录的标题，可以为空。url是历史记录的URL，不可以为空。</span><br><span class="line"></span><br><span class="line">2.history.replaceState(state, title, url)</span><br><span class="line">将history堆栈中当前的记录替换成这里的url，参数同上。</span><br><span class="line"></span><br><span class="line">这个特性后来用到了单页面应用中比如：vue-router，react-router-dom里面。</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="9-2-Reac中的路由"><a href="#9-2-Reac中的路由" class="headerlink" title="9.2 Reac中的路由"></a>9.2 Reac中的路由</h2><p><code>&lt;Router&gt;</code>是React中实现路由最外层的容器，一般情况下我们不再需要直接使用它，而是使用在它基础之上封装的几个适用于不同环境的组件，react-router-dom的Router有四种：</p>
<table>
<thead>
<tr>
<th>Router</th>
<th>适用情况</th>
</tr>
</thead>
<tbody><tr>
<td><a href="https://link.jianshu.com?t=https%3A%2F%2Freacttraining.com%2Freact-router%2Fweb%2Fapi%2FBrowserRouter" target="_blank" rel="noopener">BrowserRouter</a></td>
<td>react-router-dom扩展，利用HTML5 新增的history API (pushState, replaceState)，是web应用最常用的路由组件</td>
</tr>
<tr>
<td><a href="https://link.jianshu.com?t=https%3A%2F%2Freacttraining.com%2Freact-router%2Fweb%2Fapi%2FHashRouter" target="_blank" rel="noopener">HashRouter</a></td>
<td>react-router-dom扩展，利用window.location.hash，适用于低版本浏览器或者一些特殊情境</td>
</tr>
<tr>
<td><a href="https://link.jianshu.com?t=https%3A%2F%2Freacttraining.com%2Freact-router%2Fweb%2Fapi%2FMemoryRouter" target="_blank" rel="noopener">MemoryRouter</a></td>
<td>继承自react-router ，用户在地址栏看不到任何路径变化，一般用在测试或者非浏览器环境开发中</td>
</tr>
<tr>
<td><a href="https://link.jianshu.com?t=https%3A%2F%2Freacttraining.com%2Freact-router%2Fweb%2Fapi%2FStaticRouter" target="_blank" rel="noopener">StaticRouter</a></td>
<td>继承自react-router，某些页面从渲染出来以后没有多的交互，所以没有状态的变化需要存储，就可以使用静态路由，静态路由适用于服务器端</td>
</tr>
</tbody></table>
<p>一般我们很少会用到MemoryRouter和StaticRouter，在web应用中更多的是用   <code>react-router-dom</code>扩展出来的BrowserRouter和HashRouter，这两个就是我前面提到的前端路由的两种解决办法的各自实现。</p>
<h2 id="9-3-HashRouter的基本使用"><a href="#9-3-HashRouter的基本使用" class="headerlink" title="9.3 HashRouter的基本使用"></a>9.3 HashRouter的基本使用</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">yarn add react-router react-router-dom @types/react-router-dom</span><br><span class="line"></span><br><span class="line">#1.main.js </span><br><span class="line"><span class="comment">// 1. 导入包</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.jsx'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 render 函数渲染 虚拟DOM</span></span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span>&gt;</span><span class="tag">&lt;/<span class="name">App</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'app'</span>))</span><br><span class="line">                </span><br><span class="line"></span><br><span class="line">#2.App.jsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HashRouter 表示一个路由的跟容器，所有的路由相关的东西，都要包裹在 HashRouter 里面</span></span><br><span class="line"><span class="comment">// Route 表示一个路由规则， 在 Route 上有两个比较重要的属性：path   component</span></span><br><span class="line"><span class="comment">// Link 表示一个路由的链接 ，就好比 vue 中的 &lt;router-link to=""&gt;&lt;/router-link&gt;</span></span><br><span class="line"><span class="keyword">import</span> &#123; HashRouter, Route, Link &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">'./components6/Home'</span></span><br><span class="line"><span class="keyword">import</span> Movie <span class="keyword">from</span> <span class="string">'./components6/Movie'</span></span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">'./components6/About'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App: FC&lt;&#123;&#125;&gt; = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 当 使用 HashRouter 把 App 根组件的元素包裹起来之后，网站就已经启用路由了</span></span><br><span class="line">  <span class="comment">// 在一个 HashRouter 中，只能有唯一的一个根元素</span></span><br><span class="line">  <span class="comment">// 在一个网站中，只需要使用 唯一的一次 &lt;HashRouter&gt;&lt;/HashRouter&gt; 就行了</span></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;这是网站的APP根组件&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">      &lt;Link to="/home"&gt;首页&lt;/Link&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">      &lt;Link to="/movie/top250/10"&gt;电影&lt;/Link&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">      &lt;Link to="/about"&gt;关于&lt;/Link&gt;</span><br><span class="line"></span><br><span class="line">      &lt;hr /&gt;</span><br><span class="line"></span><br><span class="line">      &#123;/* Route 创建的标签，就是路由规则，其中 path 表示要匹配的路由，component 表示要展示的组件 */&#125;</span><br><span class="line">      &#123;/* 在 vue 中有个 router-view 的路由标签专门用来放置匹配到的路由组件的，但是在 react-router 中并没有类似于这样的标签，而是直接把 Route 标签当作的坑（占位符） */&#125;</span><br><span class="line">      &#123;/* Route 具有两种身份：1. 它是一个路由匹配规则； 2. 它是一个占位符，表示将来匹配到的组件都放到这个位置， 如果想让路由规则进行精确匹配，可以为 Route添加 exact 属性，表示启用精确匹配模式 */&#125;</span><br><span class="line">      &lt;Route path="/home" component=&#123;Home&#125;&gt;&lt;/Route&gt;</span><br><span class="line">      &#123;/* 注意：默认情况下，路由中的规则是模糊匹配的，如果路由可以部分匹配成功，就会展示这个路由对应的组件 */&#125;</span><br><span class="line">      &#123;/* 如果要匹配参数，可以在匹配规则中使用 : 修饰符，表示这个位置匹配到的是参数 */&#125;</span><br><span class="line">      &lt;Route path="/movie/:type/:id" component=&#123;Movie&#125; exact&gt;&lt;/Route&gt;</span><br><span class="line">      &lt;Route path="/about" component=&#123;About&#125;&gt;&lt;/Route&gt;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">HashRouter</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br><span class="line">                </span><br><span class="line">#3.components/Home.jsx    </span><br><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home:FC&lt;&#123;&#125;&gt; = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>主页<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Home;</span><br><span class="line"></span><br><span class="line">#4. components/Movie.jsx </span><br><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; RouteComponentProps &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line">type ParamsProps = &#123;</span><br><span class="line">  type?: string | <span class="literal">undefined</span>,</span><br><span class="line">  id?: string | <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br><span class="line">type IProps = &#123;</span><br><span class="line">  name?: string</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> Movie: FC&lt;IProps &amp; RouteComponentProps&lt;ParamsProps&gt;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>电影--- &#123;props.match.params.type&#125; --- &#123;props.match.params.id&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Movie;</span><br><span class="line"></span><br><span class="line">#5. components/About.jsx</span><br><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> About:FC&lt;&#123;&#125;&gt; = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>关于我们<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> About;</span><br></pre></td></tr></table></figure>

<h2 id="9-4-匹配规则"><a href="#9-4-匹配规则" class="headerlink" title="9.4 匹配规则"></a>9.4 匹配规则</h2><p><strong>默认：</strong></p>
<table>
<thead>
<tr>
<th>路径</th>
<th>location.pathname</th>
<th>是否匹配</th>
</tr>
</thead>
<tbody><tr>
<td>/one</td>
<td>/one</td>
<td>是</td>
</tr>
<tr>
<td>/one</td>
<td>/one/</td>
<td>是</td>
</tr>
<tr>
<td>/one</td>
<td>/one/111</td>
<td>是</td>
</tr>
<tr>
<td>/one</td>
<td>/one/aaa/bbb</td>
<td>是</td>
</tr>
</tbody></table>
<p><strong>exact配置：</strong>exact属性为true时路径中的hash值必须和path完全一致才渲染对应的组件，如果为false则’/‘也可以匹配’/xxx’</p>
<table>
<thead>
<tr>
<th>路径</th>
<th>location.pathname</th>
<th>exact</th>
<th>是否匹配</th>
</tr>
</thead>
<tbody><tr>
<td>/one</td>
<td>/one/two</td>
<td>true</td>
<td>否</td>
</tr>
<tr>
<td>/one</td>
<td>/one/two</td>
<td>false</td>
<td>是</td>
</tr>
</tbody></table>
<p><strong>strict配置：</strong>strict属性主要就是匹配反斜杠，规定是否匹配末尾包含反斜杠的路径，如果strict为true，则如果path中不包含反斜杠结尾，则他也不能匹配包含反斜杠结尾的路径</p>
<table>
<thead>
<tr>
<th>路径</th>
<th>location.pathname</th>
<th>strict</th>
<th>是否匹配</th>
</tr>
</thead>
<tbody><tr>
<td>/one/</td>
<td>/one</td>
<td>true</td>
<td>否</td>
</tr>
<tr>
<td>/one/</td>
<td>/one/</td>
<td>true</td>
<td>是</td>
</tr>
<tr>
<td>/one/</td>
<td>/one/two</td>
<td>true</td>
<td>是</td>
</tr>
</tbody></table>
<h2 id="9-5-Switch和Redirect"><a href="#9-5-Switch和Redirect" class="headerlink" title="9.5 Switch和Redirect"></a>9.5 Switch和Redirect</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; HashRouter, Route, Link, Switch, Redirect &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">HashRouter</span>&gt;</span></span></span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;这是网站的APP根组件&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">      &lt;Link to="/home"&gt;首页&lt;/Link&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">      &lt;Link to="/movie/top250/10"&gt;电影&lt;/Link&gt;&amp;nbsp;&amp;nbsp;</span><br><span class="line">      &lt;Link to="/about"&gt;关于&lt;/Link&gt;</span><br><span class="line"></span><br><span class="line">      &lt;hr /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="xml">      &#123;/*<span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">       Switch表示路由互斥，如果没有Switch，会根据路由找到所有匹配的组件显示</span></span><br><span class="line"><span class="xml">       比如http://localhost:3000/#/user  会找到/、/user所匹配的路由(下面home没有找到是因为精确匹配了)</span></span><br><span class="line"><span class="xml">    */&#125;</span></span><br><span class="line">      &lt;Switch&gt;</span><br><span class="line">        &#123;/*</span><br><span class="line">        path:/ 表示访问根路径的情况下默认载入home组件</span><br><span class="line">        exact精确匹配，为了给其他组件一个机会获取到url改变</span><br><span class="line">        strict 在确定路径是否与当前URL匹配时，将考虑路径后的斜线；</span><br><span class="line">       */&#125;</span><br><span class="line">        &lt;Route path="/home" component=&#123;Home&#125;&gt;&lt;/Route&gt;</span><br><span class="line">        &lt;Route path="/movie/:type/:id" component=&#123;Movie&#125; exact&gt;&lt;/Route&gt;</span><br><span class="line">        &lt;Route path="/about" component=&#123;About&#125;&gt;&lt;/Route&gt;</span><br><span class="line">        &#123;/*没有匹配到路径的时候重定向到根路径*/&#125;</span><br><span class="line">        &lt;Redirect to="/" /&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &lt;<span class="regexp">/HashRouter&gt;)</span></span><br></pre></td></tr></table></figure>

<h2 id="9-6-React中的编程式导航和路由传参"><a href="#9-6-React中的编程式导航和路由传参" class="headerlink" title="9.6 React中的编程式导航和路由传参"></a>9.6 React中的编程式导航和路由传参</h2><h3 id="9-6-1-withRouter的使用"><a href="#9-6-1-withRouter的使用" class="headerlink" title="9.6.1 withRouter的使用"></a>9.6.1 withRouter的使用</h3><p>withRouter可以包装任何自定义组件，将react-router 的 history,location,match 三个对象传入。 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route exact path=<span class="string">"/Home"</span> component=&#123;Home&#125;/&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p> 1.只有包裹在Route组件里的才能使用<code>props.location</code>，<br> 2.假如有个需求，是面包屑或者导航组件里需要拿到<code>props.location</code>（导航组件或者面包屑一般不会包裹在<code>Route</code>里），那么直接这么写显然就不行了。这个时候<code>withRouter</code>修饰一下，就可以这么写了。</p>
</blockquote>
<h3 id="9-6-2-使用withRouter跳转页面"><a href="#9-6-2-使用withRouter跳转页面" class="headerlink" title="9.6.2 使用withRouter跳转页面"></a>9.6.2 使用withRouter跳转页面</h3><blockquote>
<p>只有在 <Route> 包裹的组件中才能在 this.props 属性中找到 history 对象。但有些情况下我们就是希望在一个没被 <Route> 包裹的组件中用到 history 对象，我们可以这样用</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Header.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; FC &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; RouteComponentProps, withRouter &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Header: FC&lt;RouteComponentProps&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> goAbout = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    props.history.push(&#123; <span class="attr">pathname</span>: <span class="string">"/about"</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    网页头</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;goAbout&#125;</span>&gt;</span>点我跳转About页面<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withRouter(Header);</span><br></pre></td></tr></table></figure>

<h3 id="9-6-3-路由传参"><a href="#9-6-3-路由传参" class="headerlink" title="9.6.3 路由传参"></a>9.6.3 路由传参</h3><p>TS 路由接口：RouteComponentProps</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; RouteComponentProps &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> RouterInfo &#123;</span><br><span class="line">  id: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (props: RouteComponentProps&lt;RouterInfo&gt;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1 className=&#123;styles.title&#125;&gt;Page productDetail/index ---&#123;props.match.params.id&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="a-params方式传参"><a href="#a-params方式传参" class="headerlink" title="a) params方式传参"></a>a) params方式传参</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">'/path/:name'</span> component=&#123;Path&#125;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;Link to=<span class="string">"/path/2"</span>&gt;xxx&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">props.history.push(&#123;pathname:"/</span>path/<span class="string">" + name&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">读取参数用:props.match.params.name</span></span><br></pre></td></tr></table></figure>

<p>优势 ： 刷新地址栏，参数依然存在<br>缺点  :   只能传字符串，并且如果传的值太多的话，url会变得长而丑陋。</p>
<h4 id="b-search方式传参"><a href="#b-search方式传参" class="headerlink" title="b) search方式传参"></a>b) search方式传参</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">'/web/departManange '</span> component=&#123;DepartManange&#125;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;link to=<span class="string">"web/departManange?tenantId=12121212"</span>&gt;xxx&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">props.history.push(&#123;pathname:"/</span>web/departManange<span class="string">",search: 'tenantId=12121212'&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">读取参数用: props.location.search</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//search参数的解析</span></span><br><span class="line"><span class="string">yarn add url -S</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">import url from 'url'</span></span><br><span class="line"><span class="string">const httpUrl = props.location.search;</span></span><br><span class="line"><span class="string">url.parse(httpUrl, true).query.tenantId;</span></span><br></pre></td></tr></table></figure>

<p>优势 ： 刷新地址栏，参数依然存在</p>
<p>缺点  :   只能传字符串，并且如果传的值太多的话，url会变得长而丑陋。</p>
<h4 id="c-state方式传参"><a href="#c-state方式传参" class="headerlink" title="c) state方式传参"></a>c) state方式传参</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">'/sort '</span> component=&#123;Sort&#125;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;Link to=&#123;&#123; <span class="attr">pathname</span> : <span class="string">' /sort '</span> , <span class="attr">state</span> : &#123; <span class="attr">name</span> : <span class="string">'sunny'</span> &#125;&#125;&#125;&gt; </span><br><span class="line">props.history.push(&#123;<span class="attr">pathname</span>:<span class="string">"/sort "</span>,<span class="attr">state</span> : &#123; <span class="attr">name</span> : <span class="string">'sunny'</span> &#125;&#125;);</span><br><span class="line"></span><br><span class="line">读取参数用: props.location.state.name</span><br></pre></td></tr></table></figure>

<p>优势：传参优雅，传递参数可传对象，state传的参数是加密的<br>缺点：刷新地址栏，参数丢失</p>
<h2 id="9-7-组件懒加载和基于路由的代码分割"><a href="#9-7-组件懒加载和基于路由的代码分割" class="headerlink" title="9.7 组件懒加载和基于路由的代码分割"></a>9.7 组件懒加载和基于路由的代码分割</h2><p><code>React.lazy</code> 函数能让你像渲染常规组件一样处理动态引入（的组件）。</p>
<p><code>React.lazy</code> 接受一个函数，这个函数需要动态调用 <code>import()</code>。它必须返回一个 <code>Promise</code>，该 Promise 需要 resolve 一个 <code>defalut</code> export 的 React 组件。</p>
<p>然后应在 <code>Suspense</code> 组件中渲染 lazy 组件(Suspense 就是实现所谓的延迟加载效果)，如此使得我们可以使用在等待加载 lazy 组件时做优雅降级（如 loading 指示器等）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; BrowserRouter <span class="keyword">as</span> Router, Route, Switch &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; Suspense, lazy &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./routes/Home'</span>));</span><br><span class="line"><span class="keyword">const</span> About = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./routes/About'</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">  &lt;Router&gt;</span><br><span class="line">    <span class="comment">//fallback 属性接受任何在组件加载过程中你想展示的 React 元素</span></span><br><span class="line">    &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Switch&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Route exact path="/</span><span class="string">" component=&#123;Home&#125;/&gt;</span></span><br><span class="line"><span class="string">        &lt;Route path="</span>/about<span class="string">" component=&#123;About&#125;/&gt;</span></span><br><span class="line"><span class="string">      &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">    &lt;/Suspense&gt;</span></span><br><span class="line"><span class="string">  &lt;/Router&gt;</span></span><br><span class="line"><span class="string">);</span></span><br></pre></td></tr></table></figure>

<h1 id="10-高阶组件"><a href="#10-高阶组件" class="headerlink" title="10.高阶组件"></a>10.高阶组件</h1><h2 id="10-1-高阶函数"><a href="#10-1-高阶函数" class="headerlink" title="10.1 高阶函数"></a>10.1 高阶函数</h2><p><strong>高阶函数是一个函数，它接收函数作为参数或将函数作为输出返回</strong></p>
<ul>
<li><p>举个栗子:</p>
<ul>
<li><p>接收函数作为参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function a(x) &#123;</span><br><span class="line">  x();</span><br><span class="line">&#125;</span><br><span class="line">function b() &#123;</span><br><span class="line">  alert(&#39;hello&#39;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a(b);</span><br></pre></td></tr></table></figure>
</li>
<li><p>将函数作为输出返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function a() &#123;</span><br><span class="line">  function b() &#123;</span><br><span class="line">    alert(&#39;hello&#39;);</span><br><span class="line">  &#125;</span><br><span class="line">  return b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a()();</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>以上函数a就是一个高阶函数, 用法非常简单, 那么实际开发中又有哪些是高阶函数呢？</p>
<ul>
<li>Array 的 map 、reduce 、filter 等方法</li>
<li>Object 的 keys 、values 等方法</li>
</ul>
</li>
</ul>
<h2 id="10-2-高阶组件"><a href="#10-2-高阶组件" class="headerlink" title="10.2 高阶组件"></a>10.2 高阶组件</h2><ul>
<li>概念：<strong>高阶组件就是一个函数，且该函数接受一个组件作为参数，并返回一个新的组件</strong></li>
</ul>
<blockquote>
<p>高阶组件可以看做是装饰器模式(Decorator Pattern)在React的实现。即允许向一个现有的对象添加新的功能，同时又不改变其结构，属于包装模式(Wrapper Pattern)的一种。最大的特点就是重用组件逻辑</p>
</blockquote>
<h3 id="10-2-1-高阶组件的实现方式-属性代理"><a href="#10-2-1-高阶组件的实现方式-属性代理" class="headerlink" title="10.2.1 高阶组件的实现方式-属性代理"></a>10.2.1 高阶组件的实现方式-属性代理</h3><p>属性代理(Props Proxy)：<code>HOC</code>是包裹在普通组件外面的一层高阶函数，任何要传入普通组件内的<code>props</code> 或者 <code>state</code> 首先都要经过 <code>HOC</code>。</p>
<p><code>props</code>和 <code>state</code>等属性原本是要流向 目标组件的腰包的，但是却被 雁过拔毛的<code>HOC</code>拦路打劫，那么最终这些 <code>props</code>和 <code>states</code>数据到底还能不能再到达 目标组件，或者哪些能到达以及到达多少就全由 <code>HOC</code>说了算了，也就是说，<code>HOC</code>拥有了提前对这些属性进行修改的能力。</p>
<p>属性代理的作用：</p>
<ul>
<li>更改prop</li>
<li>通过refs获取组件实例(类组件)</li>
<li>抽象state</li>
<li>把WrappedComponent与其他elements包装在一起</li>
</ul>
<h4 id="a-属性代理-用其他元素包装组件"><a href="#a-属性代理-用其他元素包装组件" class="headerlink" title="a) 属性代理-用其他元素包装组件"></a>a) 属性代理-用其他元素包装组件</h4><p>为了封装样式、布局或别的目的，可以用其它组件和元素包裹 WrappedComponent。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//被包裹组件</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> HocComponent <span class="keyword">from</span> <span class="string">'../HOC/HocComponent'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyComponent: SFC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>被包裹组件<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> HocComponent(MyComponent);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">//高阶组件</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">HocComponent</span>(<span class="params">WrappedComponent: SFC&lt;&#123;&#125;&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> NewComponent: SFC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&#123;&#123;</span> <span class="attr">color:</span> "<span class="attr">red</span>" &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> NewComponent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="b-属性代理-更改props"><a href="#b-属性代理-更改props" class="headerlink" title="b) 属性代理-更改props"></a>b) 属性代理-更改props</h4><p>在高阶组件中添加新的 props，可以在 WrappedComponent 中通过 this.props.name访问到。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyComponent.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> HocComponent <span class="keyword">from</span> <span class="string">'../HOC/HocComponent'</span></span><br><span class="line"><span class="keyword">import</span> &#123; PrametersType &#125; <span class="keyword">from</span> <span class="string">'../HOC/Type'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyComponent: SFC&lt;PrametersType&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Hello React ---- &#123;props.name&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> HocComponent(MyComponent);</span><br><span class="line">    </span><br><span class="line"><span class="comment">//HocComponent.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; PrametersType &#125; <span class="keyword">from</span> <span class="string">'./Type'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">HocComponent</span>(<span class="params">WrappedComponent: SFC&lt;PrametersType&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> NewComponent: SFC&lt;PrametersType&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...props</span>&#125;&gt;</span><span class="tag">&lt;/<span class="name">WrappedComponent</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> NewComponent;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Type.tsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type PrametersType = &#123;</span><br><span class="line">  name?:string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="c-属性代理-抽取公共state"><a href="#c-属性代理-抽取公共state" class="headerlink" title="c) 属性代理-抽取公共state"></a>c) 属性代理-抽取公共state</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyInput.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyInput: SFC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState&lt;string&gt;(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">e: React.ChangeEvent&lt;HTMLInputElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    setValue(e.target.value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyInput;</span><br><span class="line"></span><br><span class="line">          </span><br><span class="line"><span class="comment">//MyTextArea.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyTextArea: SFC&lt;&#123;&#125;&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [value, setValue] = useState&lt;string&gt;(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">e: React.ChangeEvent&lt;HTMLTextAreaElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    setValue(e.target.value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;handleChange&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyTextArea;</span><br><span class="line">          </span><br><span class="line">          </span><br><span class="line"><span class="comment">//index.tsx</span></span><br><span class="line"><span class="keyword">import</span> MyInput <span class="keyword">from</span> <span class="string">'./components7/MyInput'</span></span><br><span class="line"><span class="keyword">import</span> MyTextArea <span class="keyword">from</span> <span class="string">'./components7/MyTextArea'</span></span><br><span class="line">          </span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">MyInput</span>&gt;</span><span class="tag">&lt;/<span class="name">MyInput</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">MyTextArea</span>&gt;</span><span class="tag">&lt;/<span class="name">MyTextArea</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>))        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//这边代码存在的问题：MyInput和MyTextArea组件都有自己的state和change方法，代码重用性太大</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//MyInput.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;TextPrametersType&#125; <span class="keyword">from</span> <span class="string">'../HOC/Type'</span></span><br><span class="line"><span class="keyword">import</span> HocTextComponent <span class="keyword">from</span> <span class="string">'../HOC/HocTextComponent'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyInput: SFC&lt;TextPrametersType&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&#123;props.value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;props.change&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">input</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> HocTextComponent(MyInput);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">//MyTextArea.tsx</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123;TextPrametersType&#125; <span class="keyword">from</span> <span class="string">'../HOC/Type'</span></span><br><span class="line"><span class="keyword">import</span> HocTextComponent <span class="keyword">from</span> <span class="string">'../HOC/HocTextComponent'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MyTextArea: SFC&lt;TextPrametersType&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">textarea</span> <span class="attr">value</span>=<span class="string">&#123;props.value&#125;</span> <span class="attr">onChange</span>=<span class="string">&#123;props.change&#125;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MyTextArea;</span><br><span class="line">      </span><br><span class="line">          </span><br><span class="line"><span class="comment">//HocTextComponent.tsx      </span></span><br><span class="line"><span class="keyword">import</span> React, &#123; SFC, useState &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; TextPrametersType &#125; <span class="keyword">from</span> <span class="string">'./Type'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">HocTextComponent</span>(<span class="params">WrappedComponent: SFC&lt;TextPrametersType&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> NewComponent: React.FC&lt;TextPrametersType&gt; = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> [value, setValue] = useState&lt;string&gt;(<span class="string">""</span>);</span><br><span class="line">    <span class="keyword">const</span> handleChange = <span class="function">(<span class="params">e: React.ChangeEvent&lt;HTMLInputElement|HTMLTextAreaElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">      setValue(e.target.value)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> newProps = &#123;</span><br><span class="line">      value: value,</span><br><span class="line">      change: handleChange</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">WrappedComponent</span> &#123;<span class="attr">...props</span>&#125; &#123;<span class="attr">...newProps</span>&#125;&gt;</span><span class="tag">&lt;/<span class="name">WrappedComponent</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> NewComponent;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//Type.tsx</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type TextPrametersType = &#123;</span><br><span class="line">  value?:string,</span><br><span class="line">  change?(e: React.ChangeEvent):<span class="keyword">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-2-2-高阶组件的实现方式-反向继承"><a href="#10-2-2-高阶组件的实现方式-反向继承" class="headerlink" title="10.2.2 高阶组件的实现方式-反向继承"></a>10.2.2 高阶组件的实现方式-反向继承</h3><p>反向继承( Inheritance Inversion )：返回的 HOC 类（Enhancer）继承了 WrappedComponent。之所以被称为 Inheritance Inversion 是因为 WrappedComponent 被 Enhancer 继承了，而不是 WrappedComponent 继承了 Enhancer。在这种方式中，它们的关系看上去被反转（inverse）了。</p>
<p>通过继承WrappedComponent，除了一些静态方法，包括生命周期，state，各种function，我们都可以得到。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iiHOC</span>(<span class="params">WrappedComponent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">Enhancer</span> <span class="keyword">extends</span> <span class="title">WrappedComponent</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">super</span>.render()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反向继承的作用：</p>
<ul>
<li>渲染劫持</li>
<li>操作state</li>
</ul>
<h4 id="a-反向继承-渲染劫持"><a href="#a-反向继承-渲染劫持" class="headerlink" title="a) 反向继承-渲染劫持"></a>a) 反向继承-渲染劫持</h4><p>之所以被称为渲染劫持是因为 HOC 控制着 WrappedComponent 的渲染输出，可以用它做各种各样的事。通过渲染劫持可以：</p>
<ul>
<li>在由 render输出的任何 React 元素中读取、添加、编辑、删除 props</li>
<li>读取和修改由 render 输出的 React 元素树</li>
<li>有条件地渲染元素树</li>
<li>把样式包裹进元素树（就像在 Props Proxy 中的那样）</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> logo <span class="keyword">from</span> <span class="string">'./logo.svg'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyComponent</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">name</span>=<span class="string">"pp"</span>&gt;</span>被包裹组件<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">iiHOC</span>(<span class="params">WrappedComponent: React.ComponentClass</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">Enhancer</span> <span class="keyword">extends</span> <span class="title">WrappedComponent</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="comment">//super.render() 调用父类的渲染方法  获取到父类的渲染结果</span></span><br><span class="line">      <span class="keyword">const</span> elementsTree = <span class="keyword">super</span>.render();</span><br><span class="line">      <span class="comment">//在父亲的渲染结果上新增一个属性</span></span><br><span class="line">      <span class="keyword">let</span> newProps = &#123; <span class="attr">style</span>: &#123; <span class="attr">color</span>: <span class="string">"red"</span> &#125; &#125;;</span><br><span class="line">      <span class="comment">//elementsTree as ReactElement 类型推导</span></span><br><span class="line">      <span class="keyword">const</span> props = elementsTree &amp;&amp; (elementsTree <span class="keyword">as</span> ReactElement).props;</span><br><span class="line">      <span class="keyword">const</span> p = <span class="built_in">Object</span>.assign(&#123;&#125;, props, newProps);</span><br><span class="line">      <span class="keyword">const</span> newElement = React.cloneElement(</span><br><span class="line">        elementsTree <span class="keyword">as</span> ReactElement,</span><br><span class="line">        p,</span><br><span class="line">        props.children</span><br><span class="line">      );</span><br><span class="line">      <span class="comment">//返回新的页面</span></span><br><span class="line">      <span class="keyword">return</span> newElement;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> NewComponent = iiHOC(MyComponent)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;NewComponent&gt;&lt;<span class="regexp">/NewComponent&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>

<h4 id="b-反向继承-修改state"><a href="#b-反向继承-修改state" class="headerlink" title="b) 反向继承-修改state"></a>b) 反向继承-修改state</h4><p>HOC 可以读取、编辑和删除 WrappedComponent 实例的 state，如果需要，也可以给它添加更多的 state。但是这会搞乱 WrappedComponent 的 state，可能会导致破坏某些东西，通常不建议使用高阶组件修改添加state。</p>
<p>下面通过访问 WrappedComponent 的 props 和 state 来做测试。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">IIHOCDEBUGGER</span>(<span class="params">WrappedComponent: React.ComponentClass</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">II</span> <span class="keyword">extends</span> <span class="title">WrappedComponent</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;h2&gt;HOC Debugger Component&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">          &lt;p&gt;Props&lt;/</span>p&gt; <span class="xml"><span class="tag">&lt;<span class="name">pre</span>&gt;</span>&#123;JSON.stringify(this.props)&#125;<span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span></span><br><span class="line">          &lt;p&gt;State&lt;<span class="regexp">/p&gt;&lt;pre&gt;&#123;JSON.stringify(this.state)&#125;&lt;/</span>pre&gt;</span><br><span class="line">          &#123;<span class="keyword">super</span>.render()&#125;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="11-安装-React-Developer-Tools-调试工具"><a href="#11-安装-React-Developer-Tools-调试工具" class="headerlink" title="11.安装 React Developer Tools 调试工具"></a>11.安装 React Developer Tools 调试工具</h1><p><a href="https://chrome.google.com/webstore/detail/react-developer-tools/fmkadmapgofadopljbjfkapdkoienihi?hl=zh-CN" target="_blank" rel="noopener">React Developer Tools - Chrome 扩展下载安装地址</a></p>
<h1 id="12-相关文章"><a href="#12-相关文章" class="headerlink" title="12. 相关文章"></a>12. 相关文章</h1><ul>
<li><a href="https://mp.weixin.qq.com/s/gV-w_rRfdBVAqsOpBGZaVw" target="_blank" rel="noopener">2018 年，React 将独占前端框架鳌头？</a></li>
<li><a href="https://mp.weixin.qq.com/s/0wXWqKIigaKzMSfy4vJMVw" target="_blank" rel="noopener">前端框架三巨头年度走势对比：Vue 增长率最高</a></li>
</ul>
<ul>
<li><a href="http://www.cnblogs.com/tim100/p/6050514.html" target="_blank" rel="noopener">React数据流和组件间的沟通总结</a></li>
<li><a href="https://segmentfault.com/q/1010000005876655/a-1020000005876751" target="_blank" rel="noopener">单向数据流和双向绑定各有什么优缺点？</a></li>
<li><a href="https://www.zhihu.com/question/29504639?sort=created" target="_blank" rel="noopener">怎么更好的理解虚拟DOM?</a></li>
<li><a href="http://www.css88.com/react/index.html" target="_blank" rel="noopener">React中文文档 - 版本较低</a></li>
<li><a href="http://blog.csdn.net/yczz/article/details/49886061" target="_blank" rel="noopener">React 源码剖析系列 － 不可思议的 react diff</a></li>
<li><a href="http://www.infoq.com/cn/articles/react-dom-diff?from=timeline&isappinstalled=0" target="_blank" rel="noopener">深入浅出React（四）：虚拟DOM Diff算法解析</a></li>
<li><a href="http://www.cocoachina.com/webapp/20150721/12692.html" target="_blank" rel="noopener">一看就懂的ReactJs入门教程（精华版）</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2016/06/css_modules.html" target="_blank" rel="noopener">CSS Modules 用法教程</a></li>
<li><a href="http://blog.csdn.net/itzhongzi/article/details/66045880" target="_blank" rel="noopener">将MarkDown转换为HTML页面</a></li>
<li><a href="https://jingyan.baidu.com/article/0320e2c1c9cf0e1b87507b26.html" target="_blank" rel="noopener">win7命令行 端口占用 查询进程号 杀进程</a></li>
<li><a href="https://facebook.github.io/react/docs/typechecking-with-proptypes.html" target="_blank" rel="noopener">类型校验</a></li>
</ul>
<ul>
<li><a href="https://reactjs.org/docs/animation.html#high-level-api-reactcsstransitiongroup" target="_blank" rel="noopener">Animation Add-Ons</a></li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Wang su</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://ehbhgh.github.io/2020/07/23/react%E5%9F%BA%E7%A1%80/">https://ehbhgh.github.io/2020/07/23/react%E5%9F%BA%E7%A1%80/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/07/23/Dj7mVOJLucTNYet.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/07/23/js%E7%B3%BB%E5%88%97%E4%B8%89%E5%A4%A7%E5%AE%B6%E6%97%8F/"><img class="prev-cover" data-src="https://i.loli.net/2020/07/23/Dj7mVOJLucTNYet.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">js三大家族</div></div></a></div><div class="next-post pull-right"><a href="/2020/06/23/typescript/"><img class="next-cover" data-src="https://i.loli.net/2020/07/23/XARfSvl9oB6MKYm.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">浅谈TypeScript</div></div></a></div></nav></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 <i style="color:#FF6A6A;animation: announ_animation 0.8s linear infinite;" class="fa fa-heartbeat"></i> Wang su</div><div class="framework-info"><span>Driven </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">彼岸花开一千年,花开花落不相见。 若问花开叶落故,彼岸缘起缘又灭。</div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="Increase Font Size"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="Decrease Font Size"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/search/local-search.js"></script><script src="https://cdn.jsdelivr.net/gh/lete114/CDN/Sum/sakura.js"></script><script id="xplayer" src="https://music.m0x.cn/Static/player/player.js" key="5f185cdca3357" ></script><script src="https://cdn.jsdelivr.net/gh/lete114/CDN/js/upjiang.js"></script></body></html>